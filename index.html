<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<!-- ç«™é»åŸºç¤ -->
<title>é™³è¬é¾è¨ºæ‰€çœ‹è¨ºé€²åº¦</title>
<meta name="description" content="å³æ™‚çœ‹è¨ºé€²åº¦èˆ‡é–€è¨ºè³‡è¨Š">
<meta name="theme-color" content="#35579A">

<!-- Open Graph / LINE / FB é è¦½ -->
<meta property="og:type" content="website">
<meta property="og:title" content="é™³è¬é¾è¨ºæ‰€ï½œçœ‹è¨ºé€²åº¦">
<meta property="og:description" content="å³æ™‚çœ‹è¨ºé€²åº¦èˆ‡é–€è¨ºè³‡è¨Šã€‚">
<meta property="og:image" content="og-cover.jpg">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:url" content="https://tioar.github.io/Clinic_calling/">
<meta property="og:locale" content="zh_TW">

<!-- âœ… CSP å®‰å…¨è£œé‡˜ï¼ˆè‹¥èƒ½ç”¨ä¼ºæœå™¨ HTTP æ¨™é ­æ›´å¥½ï¼‰ -->
<meta http-equiv="Content-Security-Policy" content="
  default-src 'self';
  img-src 'self' https://raw.githubusercontent.com data:;
  style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
  font-src https://fonts.gstatic.com;
  script-src 'self' 'unsafe-inline';
  connect-src https://script.google.com https://script.googleusercontent.com;
  frame-ancestors 'none';
  upgrade-insecure-requests">

<!-- Favicon / Touch Iconsï¼ˆéƒ½æ”¾åœ¨ç¶²ç«™æ ¹ç›®éŒ„ï¼‰ -->
<link rel="icon" type="image/png" href="icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="icon-32.png">
<link rel="icon" type="image/png" sizes="16x16" href="icon-16.png">
<link rel="shortcut icon" href="favicon.ico">
<link rel="apple-touch-icon" href="apple-touch-icon.png">

<!-- å­—é«”ï¼ˆå…§æ–‡ï¼šNoto Sans TCï¼›è™Ÿç¢¼ï¼šManropeï¼‰ -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@700;800;900&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">

<style>
  :root{
    --primary:#35579A;   /* æ·±è— */
    --purple:#6B5AAE;    /* è·‘é¦¬ç‡ˆèƒŒæ™¯ */
    --soft:#A5B8D0;      /* æ·ºè— */
    --beige:#D8C0AD;     /* ç±³è†š */
    --accent:#6db337;    /* Popout ç¶  */
    --bg:#F5EFE8;        /* èƒŒæ™¯ */
    --card:#FFFFFF;      /* å¡ç‰‡ç™½ */
    --note:#F2F6FB;      /* èªªæ˜æ¡†æ·¡è— */
    --digit-red:#DC2626; /* è™Ÿç¢¼ç´… */
  }

  *{ box-sizing:border-box; }
  body{
    font-family:'Noto Sans TC',sans-serif;
    -webkit-font-smoothing:antialiased;
    background:var(--bg);
    margin:0;
    padding:clamp(16px,4vw,40px) max(12px,env(safe-area-inset-left)) clamp(24px,6vw,48px) max(12px,env(safe-area-inset-right));
    display:flex; justify-content:center; color:#1c1c1c;
  }
  .container{
    position:relative;               /* è®“ popout ç›¸å°å®šä½æ–¼å®¹å™¨å…§ */
    width:min(860px,96vw);
    background:var(--card);
    border-radius:36px;
    padding:clamp(16px,4vw,32px);
    text-align:center;
    box-shadow:0 10px 30px rgba(53,87,154,0.10);
    border:3px solid var(--primary);
    overflow:visible;
  }

  /* ğŸŸ£ ç„¡ç¸«å¾ªç’°è·‘é¦¬ç‡ˆï¼ˆæ»‘é/é•·æŒ‰æš«åœï¼›å­—é«”è¼ƒå°ï¼‰ */
  .marquee{
    --gap: 2rem;      /* å…©æ®µå…§å®¹é–“è· */
    --speed: 45s;     /* é€Ÿåº¦ï¼šè¶Šå°è¶Šå¿« */
    background:var(--purple);
    color:#fff;
    border-radius:18px;
    padding:10px 0;
    margin:0 auto 10px;
    overflow:hidden;
    white-space:nowrap;
    user-select:none;
    touch-action:manipulation;
    font-size:14px;
  }
  .marquee__track{
    display:inline-flex; align-items:center;
    width:max-content;
    animation:marquee-loop var(--speed) linear infinite;
  }
  .marquee__track > span{ padding-right:var(--gap); flex-shrink:0; }
  .marquee:hover .marquee__track{ animation-play-state:paused; }
  @keyframes marquee-loop{
    from{ transform:translateX(0); }
    to  { transform:translateX(-50%); } /* èµ°ä¸€åŠï¼ç¬¬äºŒæ®µç„¡ç¸«æ¥ä¸Š */
  }

  /* Logoï¼šåŠ å¤§ã€è²¼åˆç™½åº• */
  .logo-wrap{ margin:10px 0 0; }
  .logo{
    height:clamp(120px, 22vw, 200px);
    max-width:82vw; object-fit:contain;
    filter:none; border:none; border-radius:0; background:#fff;
  }

  h1{ margin:12px 0; color:var(--primary); letter-spacing:1px; }
  .now-time{ color:#5f7396; font-weight:700; margin-bottom:18px; }

  /* è™Ÿç¢¼å¡ï¼šç™½åº•ç´…å­—ï¼ˆManrope ç­‰å¯¬æ•¸å­—ï¼‰ */
  .number-display{
    display:flex; justify-content:center; gap:clamp(8px,2vw,16px);
    margin-bottom:16px; flex-wrap:nowrap;
  }
  .digit-card{
    width:clamp(72px, 22vw, 110px);
    height:clamp(92px, 28vw, 140px);
    background:#fff; color:var(--digit-red);
    font-family:'Manrope',sans-serif;
    font-variant-numeric:tabular-nums;
    font-size:clamp(56px,16vw,100px);
    font-weight:800; line-height:1;
    border-radius:28px;
    display:flex; align-items:center; justify-content:center;
    position:relative; perspective:400px; overflow:hidden;
    box-shadow:0 10px 24px rgba(53,87,154,.08), inset 0 0 0 3px var(--soft);
  }
  .digit-card .current, .digit-card .next{
    position:absolute; inset:0; display:flex; align-items:center; justify-content:center; backface-visibility:hidden;
  }
  .digit-card .next{ transform:rotateX(-180deg); }
  .flip .current{ animation:flipTop .5s forwards; }
  .flip .next{ animation:flipBottom .5s forwards; }
  @keyframes flipTop{0%{transform:rotateX(0)}100%{transform:rotateX(180deg)}}
  @keyframes flipBottom{0%{transform:rotateX(-180deg)}100%{transform:rotateX(0)}}

  /* èªªæ˜å€ */
  .note{
    background:var(--note);
    padding:16px 20px;
    border-radius:22px;
    margin:16px auto 12px;
    box-shadow:0 4px 12px rgba(0,0,0,0.06);
    color:#274a6b; font-weight:600;
    width:min(760px,100%); text-align:center;
  }
  .note p{ margin:.35em 0; }

  /* é£„å¸¶ï¼ˆæ³¨æ„äº‹é …ä¸‹æ–¹ï¼‰ */
  .palette{
    height:8px; border-radius:6px; margin:8px auto 16px; width:min(560px,90%);
    background:
      linear-gradient(to right,
        var(--beige) 0 22%,
        var(--accent) 22% 45%,
        var(--primary) 45% 82%,
        var(--soft) 82% 100%);
  }

  .schedule{
    margin-top:6px; max-width:100%;
    border-radius:20px;
    box-shadow:0 4px 12px rgba(0,0,0,0.06);
  }

  /* Popoutï¼šLogo ä¸‹æ–¹å–®è¡Œé¡¯ç¤ºï¼ˆä¸è¶³å¯¬åº¦æ™‚çœç•¥è™Ÿï¼Œä¸æ“‹è·‘é¦¬ç‡ˆï¼‰ */
  .popup{
    position:absolute;                 /* JS æœƒè¨­å®š top ä½ç½® */
    left:50%;
    transform:translateX(-50%);
    background:var(--accent); color:#fff;
    padding:14px 22px; border-radius:999px;
    font-size:20px; z-index:10; font-weight:800;
    opacity:0;                          /* ç”±å‹•ç•«æ·¡å…¥/æ·¡å‡º */
    animation:fadeInOut 3s forwards;
    box-shadow:0 12px 26px rgba(0,0,0,.15);
    pointer-events:none;
    white-space:nowrap;
    max-width:90%; overflow:hidden; text-overflow:ellipsis;
  }
  @keyframes fadeInOut{
    0%{opacity:0; transform:translate(-50%, -6px)}
    10%{opacity:1; transform:translate(-50%, 0)}
    90%{opacity:1; transform:translate(-50%, 0)}
    100%{opacity:0; transform:translate(-50%, -6px)}
  }
</style>
</head>

<body>
  <div class="container">
    <!-- ç„¡ç¸«å¾ªç’°è·‘é¦¬ç‡ˆï¼ˆæ»‘éæˆ–é•·æŒ‰å¯æš«åœï¼‰ -->
    <div class="marquee" aria-label="è¨ºæ‰€è¨Šæ¯è·‘é¦¬ç‡ˆ">
      <div class="marquee__track" id="marqueeTrack">
        <span>âœ¦ é™³è¬é¾è¨ºæ‰€é–€è¨ºæ™‚é–“ï¼šâ˜€ï¸ æ—©è¨º 08:00â€“11:30ï¼ˆæœ‰ç·šä¸Šé ç´„è€…æœ€æ™šå ±åˆ°10:30ï¼‰ï¼›â˜ï¸ åˆè¨º 14:00â€“17:00ï¼ˆæœ‰ç·šä¸Šé ç´„è€…æœ€æ™šå ±åˆ°16:00ï¼‰ï¼›â˜¾ æ™šè¨º 18:00â€“20:30ï¼ˆæœ‰ç·šä¸Šé ç´„è€…æœ€æ™šå ±åˆ°20:00ï¼‰ã€‚æœ‰ç·šä¸Šé ç´„è€…ï¼Œè«‹æ–¼æœ€æ™šå ±åˆ°æ™‚é–“å‰åˆ°å ´ï¼Œé€¾æ™‚è¦–åŒæ”¾æ£„ï¼Œåé¡å°‡é‡‹å‡ºçµ¦ç¾å ´æ›è™Ÿã€‚</span>
        <span aria-hidden="true">âœ¦ é™³è¬é¾è¨ºæ‰€é–€è¨ºæ™‚é–“ï¼šâ˜€ï¸ æ—©è¨º 08:00â€“11:30ï¼ˆæœ‰ç·šä¸Šé ç´„è€…æœ€æ™šå ±åˆ°10:30ï¼‰ï¼›â˜ï¸ åˆè¨º 14:00â€“17:00ï¼ˆæœ‰ç·šä¸Šé ç´„è€…æœ€æ™šå ±åˆ°16:00ï¼‰ï¼›â˜¾ æ™šè¨º 18:00â€“20:30ï¼ˆæœ‰ç·šä¸Šé ç´„è€…æœ€æ™šå ±åˆ°20:00ï¼‰ã€‚æœ‰ç·šä¸Šé ç´„è€…è«‹æ–¼æœ€æ™šå ±åˆ°æ™‚é–“å‰åˆ°å ´ï¼Œé€¾æ™‚è¦–åŒæ”¾æ£„ï¼Œåé¡å°‡é‡‹å‡ºçµ¦ç¾å ´æ›è™Ÿã€‚</span>
      </div>
    </div>

    <!-- Logo -->
    <div class="logo-wrap">
      <img class="logo" id="clinicLogo" src="./logo1.jpg" alt="é™³è¬é¾è¨ºæ‰€ LOGO">
    </div>

    <h1>ç›®å‰çœ‹è¨ºè™Ÿç¢¼</h1>
    <div class="now-time" id="twTime">â€”</div>

    <div class="number-display" id="numberDisplay">
      <div class="digit-card"><div class="current">0</div><div class="next">0</div></div>
      <div class="digit-card"><div class="current">0</div><div class="next">0</div></div>
      <div class="digit-card"><div class="current">0</div><div class="next">0</div></div>
    </div>

    <div class="note">
      <p>â™¦ï¸ é›²ç«¯è™Ÿç¢¼åƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›å«è™Ÿä»¥ç¾å ´ç‚ºæº–ã€‚æ¯å€‹è™Ÿç¢¼ç´„ 3â€“5 åˆ†é˜ï¼Œè«‹æå‰åˆ°å ´åœ¨å¯çœ‹åˆ°ç‡ˆè™Ÿçš„ä½ç½®ç­‰å€™ä»¥å…éè™Ÿã€‚</p>
      <p>â™¦ï¸ è‹¥å·²ç¶“éè™Ÿè«‹å†æ¬¡å‘æ«ƒæª¯å ±åˆ°ï¼Œæœƒä¾ç¾å ´ç­‰å€™äººæ•¸èª¿æ•´å®‰æ’éè™Ÿè€…ã€‚</p>
      <p>â™¦ï¸ é–€è¨ºå¯èƒ½è¦–ç¾å ´ç‹€æ³æå‰åœæ­¢æ›è™Ÿï¼Œå¦‚æœ‰ç–‘å•è«‹ä¾†é›»è¨ºæ‰€(03)5152971ã€‚</p>
    </div>

    <!-- èª¿è‰²å¸¶ -->
    <div class="palette" aria-hidden="true"></div>

    <img class="schedule" id="scheduleImg" src="./schedule.png" alt="é–€è¨ºæ™‚é–“è¡¨">
  </div>

  <script>
    /* è·‘é¦¬ç‡ˆï¼šè¡Œå‹•è£ç½®ã€Œé•·æŒ‰æš«åœã€ */
    (function(){
      const marquee = document.querySelector('.marquee');
      const track = document.getElementById('marqueeTrack');
      const pause = () => track.style.animationPlayState = 'paused';
      const run   = () => track.style.animationPlayState = 'running';
      marquee.addEventListener('pointerdown', pause);
      marquee.addEventListener('pointerup', run);
      marquee.addEventListener('pointerleave', run);
      marquee.addEventListener('pointercancel', run);
    })();

    /* åœ–ç‰‡å‚™æ´ï¼šjpg â†’ png â†’ GitHub Raw */
    (function(){
      const logo = document.getElementById('clinicLogo');
      const logoFallbacks = [
        './logo.png',
        'https://raw.githubusercontent.com/tioar/Clinic_calling/main/logo1.jpg',
        'https://raw.githubusercontent.com/tioar/Clinic_calling/main/logo.png'
      ];
      let li=0;
      logo.onerror = function(){
        if(li < logoFallbacks.length){ this.src = logoFallbacks[li++]; }
        else { this.style.display='none'; }
      };

      const sch = document.getElementById('scheduleImg');
      const schFallbacks = ['https://raw.githubusercontent.com/tioar/Clinic_calling/main/schedule.png'];
      let si=0;
      sch.onerror = function(){
        if(si < schFallbacks.length){ this.src = schFallbacks[si++]; }
        else { this.style.display='none'; }
      };
    })();

    let lastNumber='000';

    /* âœ… å®‰å…¨è£œé‡˜ï¼šå°è™Ÿç¢¼åšå‹åˆ¥èˆ‡ç¯„åœæª¢æŸ¥ */
    async function fetchNumber(){
      try{
        const res = await fetch("https://script.google.com/macros/s/AKfycbxmehGXGH_bPOD9tlOTibLzRuH35Jy3hiShjPlag2rSzpm-9c9VKTduRbc4Bjf6nifd/exec");
        const data = await res.json();

        const n = Number(data.number);
        if (!Number.isFinite(n) || n < 0 || n >= 1000) return;  // ä¸Ÿæ‰ä¸åˆè¦è³‡æ–™

        const current = String(n).padStart(3,'0');
        if(current !== lastNumber){
          animateNumber(current);
          showPopup(`è«‹ ${current} è™Ÿå°±è¨º`);
          lastNumber = current;
        }
      }catch(err){ console.error('æŠ“è™Ÿç¢¼å¤±æ•—', err); }
    }

    const pad2 = n => String(n).padStart(2,'0');

    function animateNumber(newNumber){
      const digits=document.querySelectorAll('#numberDisplay .digit-card');
      newNumber.split('').forEach((d,i)=>{
        const card=digits[i];
        const cur=card.querySelector('.current');
        const nxt=card.querySelector('.next');
        if(cur.innerText!==d){
          nxt.innerText=d;
          card.classList.add('flip');
          setTimeout(()=>{ cur.innerText=d; card.classList.remove('flip'); },500);
        }
      });
    }

    /* å°ç£æ™‚é–“ + æ˜ŸæœŸï¼šYYYY/MM/DD (é€±) HH:MM:SS */
    function updateTWTime(){
      const el=document.getElementById('twTime');
      const now = new Date();
      const tw = new Date(now.toLocaleString('en-US', { timeZone:'Asia/Taipei' }));
      const wMap = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'];
      el.textContent =
        `${tw.getFullYear()}/${pad2(tw.getMonth()+1)}/${pad2(tw.getDate())} (${wMap[tw.getDay()]}) `+
        `${pad2(tw.getHours())}:${pad2(tw.getMinutes())}:${pad2(tw.getSeconds())}`;
    }

    fetchNumber(); setInterval(fetchNumber,5000);
    updateTWTime(); setInterval(updateTWTime,1000);

    /* Popout ç”¢ç”Ÿï¼šLogo ä¸‹æ–¹ï¼ˆå–®è¡Œï¼›éé•·çœç•¥è™Ÿï¼‰ */
    function showPopup(msg){
      const container=document.querySelector('.container');
      const logo=document.getElementById('clinicLogo');

      const popup=document.createElement('div');
      popup.className='popup';
      popup.textContent=msg;

      container.appendChild(popup);

      // ä½ç½®åœ¨ Logo åº•éƒ¨å†å¾€ä¸‹ 8px
      const top = logo.offsetTop + logo.offsetHeight + 8;
      popup.style.top = top + 'px';

      // 5 ç§’å¾Œç§»é™¤
      setTimeout(()=>popup.remove(),5000);
    }
  </script>
</body>
</html>
