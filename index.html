<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>陳萬龍診所叫號系統</title>
<style>
body {
  font-family:"Microsoft JhengHei",sans-serif;
  background:#1e3a8a; /* 藍色背景 */
  text-align:center;
  margin:0;
  padding:20px;
  color:white;
}
h1 {
  font-size:32px;
  margin-bottom:20px;
}

/* 翻頁號碼卡片 */
.number-card {
  display:flex;
  justify-content:center;
  gap:20px;
}
.digit {
  position: relative;
  width:80px;
  height:100px;
  background:white;
  color:#e63946; /* 紅字 */
  font-size:72px;
  font-weight:bold;
  border-radius:16px;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
}
.digit.flip .top, .digit.flip .bottom {
  transition: transform 0.5s ease-in-out;
}
.digit .top, .digit .bottom {
  position:absolute;
  left:0; right:0;
  height:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  backface-visibility:hidden;
}
.digit .top { top:0; border-bottom:1px solid #ccc; }
.digit .bottom { bottom:0; transform:rotateX(180deg); }

/* 跑馬燈 */
.marquee {
  margin:20px auto;
  padding:10px;
  background:#2563eb;
  color:white;
  border-radius:12px;
  width:90%;
  overflow:hidden;
  white-space:nowrap;
}
.marquee span {
  display:inline-block;
  padding-left:100%;
  animation:marquee 12s linear infinite;
}
@keyframes marquee {0%{transform:translateX(0);}100%{transform:translateX(-100%);}}

/* 按鈕 */
.btn {display:inline-block;margin-top:30px;padding:15px 30px;border-radius:25px;background:#22c55e;color:white;font-size:20px;text-decoration:none;}

/* 注意事項 */
.note-box {margin:30px auto;padding:20px;background:#3b82f6;border-radius:16px;width:90%;font-size:18px;line-height:1.6;}

/* 門診表 */
.schedule {margin-top:30px;max-width:90%;border-radius:16px;box-shadow:0 4px 12px rgba(0,0,0,0.3);}
</style>
</head>
<body>

<h1>陳萬龍診所叫號系統</h1>

<div id="number" class="number-card">
  <div class="digit">0</div>
  <div class="digit">0</div>
  <div class="digit">0</div>
</div>

<div class="marquee">
  <span>公告：此號碼僅供參考，實際叫號以現場為主，每位患者預估三到五分鐘，請提前到場等候以免過號。｜謝謝您的配合</span>
</div>

<a href="https://tioar.github.io/clinic-reservation/index.html" target="_blank" class="btn">線上預約</a>

<div class="note-box">
此號碼僅供參考，實際叫號以現場為主，每位患者預估三到五分鐘，請提前到場等候以免過號。
</div>

<img src="images/schedule.png" alt="門診時間表" class="schedule">

<script>
let lastNumber = '000';
let canSpeak = false;

// 點擊頁面啟用語音
document.body.addEventListener('click',()=>{canSpeak=true;}, {once:true});

function speakNumber(number){
  if(canSpeak && 'speechSynthesis' in window){
    const msg = new SpeechSynthesisUtterance(number + '號請進診間');
    window.speechSynthesis.speak(msg);
  }
}

// 翻頁動畫
function animateDigit(digitElem, newNum){
  if(digitElem.innerText === newNum) return;
  const top = document.createElement('div');
  top.className='top';
  top.innerText=digitElem.innerText;
  const bottom = document.createElement('div');
  bottom.className='bottom';
  bottom.innerText=newNum;
  digitElem.innerText='';
  digitElem.appendChild(top);
  digitElem.appendChild(bottom);
  setTimeout(()=>{
    top.style.transform='rotateX(-180deg)';
    bottom.style.transform='rotateX(0deg)';
  },50);
  setTimeout(()=>{
    digitElem.innerText=newNum;
  },550);
}

// 更新整個號碼
function updateNumber(newNumber){
  const digits = document.querySelectorAll('#number .digit');
  newNumber.split('').forEach((n,i)=>{
    animateDigit(digits[i], n);
  });
}

// 格式化數字
function formatNumber(num){ return String(num).padStart(3,'0'); }

// 抓號碼
async function fetchNumber(){
  try{
    // 你的只讀 GAS 網址
    const res = await fetch("https://script.google.com/macros/s/AKfycbxmehGXGH_bPOD9tlOTibLzRuH35Jy3hiShjPlag2rSzpm-9c9VKTduRbc4Bjf6nifd/exec");
    const data = await res.json();
    const currentNumber = formatNumber(data.number);
    if(currentNumber!==lastNumber){
      updateNumber(currentNumber);
      speakNumber(currentNumber);
      lastNumber = currentNumber;
    }
  }catch(e){console.error('抓號碼失敗', e);}
}

setInterval(fetchNumber,5000);
fetchNumber();
</script>

</body>
</html>
