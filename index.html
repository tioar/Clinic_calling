<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>診所叫號系統</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root {
  --main:#3e6d8e;
  --hover:#335a75;
  --danger:#dc3545;
  --card-bg:#ffffff;
  --page-bg:#f4f6f8;
  --line:#e7e9ee;
}
body{
  font-family:'Noto Sans TC','Microsoft JhengHei',sans-serif;
  background:var(--page-bg);
  margin:0; padding:20px;
}
.card{
  max-width:600px; margin:0 auto;
  background:var(--card-bg);
  border-radius:24px;
  padding:32px;
  box-shadow:0 12px 28px rgba(0,0,0,0.08);
  text-align:center;
}
h1{ font-weight:700; color:var(--main); margin-bottom:24px; }

.number-card{
  display:flex; justify-content:center; gap:12px; margin-bottom:20px;
}
.digit{
  width:80px; height:100px;
  background:#fff;
  color:var(--danger);
  font-size:64px;
  font-weight:700;
  border-radius:16px;
  display:flex; align-items:center; justify-content:center;
  position:relative; overflow:hidden;
}
.digit.flip .top, .digit.flip .bottom{
  transition: transform 0.5s ease-in-out;
}
.digit .top, .digit .bottom{
  position:absolute; left:0; right:0;
  height:50%; display:flex; align-items:center; justify-content:center;
  backface-visibility:hidden;
}
.digit .top{ top:0; border-bottom:1px solid #ccc; }
.digit .bottom{ bottom:0; transform:rotateX(180deg); }

.marquee{
  margin:20px auto; padding:10px;
  background:#e7f0fa;
  color:#2e3b4e;
  border-radius:12px;
  width:90%; overflow:hidden; white-space:nowrap;
}
.marquee span{
  display:inline-block;
  padding-left:100%;
  animation:marquee 12s linear infinite;
}
@keyframes marquee{0%{transform:translateX(0);}100%{transform:translateX(-100%);}}

/* 按鈕膠囊風格 */
.btn{
  display:inline-block;
  margin:10px 8px;
  padding:12px 28px;
  border-radius:50rem;
  background:var(--main);
  color:#fff;
  font-weight:700;
  font-size:16px;
  border:none; cursor:pointer;
}
.btn:hover{ background:var(--hover); }
.note-box{
  margin:20px auto;
  padding:16px;
  background:#e7f0fa;
  color:#2e3b4e;
  border-radius:16px;
  font-size:16px;
  line-height:1.5;
}
.schedule{
  margin-top:20px;
  max-width:90%;
  border-radius:16px;
  box-shadow:0 4px 12px rgba(0,0,0,0.1);
}
</style>
</head>
<body>
<div class="card">
  <h1>陳萬龍診所叫號系統</h1>

  <div id="number" class="number-card">
    <div class="digit">0</div>
    <div class="digit">0</div>
    <div class="digit">0</div>
  </div>

  <div class="marquee">
    <span>公告：此號碼僅供參考，實際叫號以現場為主，每位患者預估三到五分鐘，請提前到場等候以免過號。</span>
  </div>

  <div>
    <button class="btn" id="voiceBtn">開啟語音提醒</button>
    <a href="https://tioar.github.io/clinic-reservation/index.html" class="btn">線上預約</a>
  </div>

  <div class="note-box">
    此號碼僅供參考，實際叫號以現場為主，每位患者預估三到五分鐘，請提前到場等候以免過號。
  </div>

  <img src="images/schedule.png" alt="門診時間表" class="schedule">
</div>

<script>
let lastNumber='000';
let canSpeak=false;

document.getElementById('voiceBtn').addEventListener('click',()=>{
  canSpeak=true;
  alert('語音提醒已啟用！');
});

// 翻頁動畫
function animateDigit(digitElem,newNum){
  if(digitElem.innerText===newNum) return;
  const top=document.createElement('div'); top.className='top'; top.innerText=digitElem.innerText;
  const bottom=document.createElement('div'); bottom.className='bottom'; bottom.innerText=newNum;
  digitElem.innerText=''; digitElem.appendChild(top); digitElem.appendChild(bottom);
  setTimeout(()=>{ top.style.transform='rotateX(-180deg)'; bottom.style.transform='rotateX(0deg)'; },50);
  setTimeout(()=>{ digitElem.innerText=newNum; },550);
}

function updateNumber(newNumber){
  const digits=document.querySelectorAll('#number .digit');
  newNumber.split('').forEach((n,i)=>{ animateDigit(digits[i],n); });
}

function formatNumber(num){ return String(num).padStart(3,'0'); }
function speakNumber(number){
  if(canSpeak && 'speechSynthesis' in window){
    const msg=new SpeechSynthesisUtterance(number+'號請進診間');
    window.speechSynthesis.speak(msg);
  }
}

async function fetchNumber(){
  try{
    const res=await fetch("https://script.google.com/macros/s/AKfycbxmehGXGH_bPOD9tlOTibLzRuH35Jy3hiShjPlag2rSzpm-9c9VKTduRbc4Bjf6nifd/exec");
    const data=await res.json();
    const currentNumber=formatNumber(data.number);
    if(currentNumber!==lastNumber){
      updateNumber(currentNumber);
      speakNumber(currentNumber);
      lastNumber=currentNumber;
    }
  }catch(e){console.error('抓號碼失敗',e);}
}

setInterval(fetchNumber,5000);
fetchNumber();
</script>
</body>
</html>
