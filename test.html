è·³è‡³å…§å®¹
èŠå¤©æ­·ç¨‹ç´€éŒ„

ä½ èªªï¼š
https://tioar.github.io/Clinic_calling/index.html
æˆ‘æƒ³è¦è®“é€™å€‹ç¶²é æœ‰æ’­å ±å«è™ŸåŠŸèƒ½æ€éº¼åš?
"00è™Ÿè«‹é€²è¨ºé–“~"é€™æ¨£
ChatGPT èªªï¼š

å·²æ€è€ƒ 35s
å¯ä»¥ï¼ä½ ç”¨ã€Œç€è¦½å™¨å…§å»º TTSï¼ˆText-to-Speechï¼‰ã€å°±èƒ½åœ¨ GitHub Pages é€™ç¨®ç´”å‰ç«¯ç¶²ç«™ä¸Šåšå‡ºã€Œ00 è™Ÿè«‹é€²è¨ºé–“ï½ã€çš„èªéŸ³æ’­å ±ã€‚ä¸‹é¢çµ¦ä½ ä¸€æ®µå¯ç›´æ¥è²¼ç”¨çš„ç¨‹å¼ç¢¼ï¼Œæ”¯æ´ iPhone/Safariï¼ˆéœ€è¦ä½¿ç”¨è€…å…ˆé»ä¸€ä¸‹å•Ÿç”¨ï¼‰ã€è‡ªå‹•æŒ‘é¸ç¹ä¸­èªéŸ³ã€é¿å…é‡è¤‡æ’­å ±ã€ä»¥åŠåœ¨è™Ÿç¢¼è®Šå‹•æ™‚è‡ªå‹•å¿µå‡ºä¾†ã€‚

ä½ è¦åšçš„äº‹ï¼ˆè¶…ç°¡å–®ï¼‰
åœ¨é é¢ä¸Šï¼ŒæŠŠç›®å‰é¡¯ç¤ºè™Ÿç¢¼çš„å…ƒç´ åŠ ä¸Š id="curr-num"ï¼ˆä¾‹å¦‚ï¼š<span id="curr-num">00</span>ï¼‰ã€‚

åœ¨æŒ‰éˆ•åˆ—åŠ ä¸€é¡†ã€Œå•Ÿç”¨èªéŸ³ã€æŒ‰éˆ•ï¼Œæˆ–æŠŠä¸‹é¢é€™é¡†æ”¾é€²å»ã€‚

æŠŠä»¥ä¸‹ <script> æ•´æ®µè²¼åˆ° </body> å‰ã€‚

å¦‚æœä½ çš„è™Ÿç¢¼ä¸æ˜¯æ”¾åœ¨ #curr-numï¼Œåªè¦æŠŠä¸‹é¢ç¨‹å¼ç¢¼è£¡çš„é¸æ“‡å™¨æ”¹æˆä½ ç¾æœ‰çš„ ID/é¡åå³å¯ã€‚

å¯è²¼ç”¨ç¨‹å¼ç¢¼
<!-- 1) å•Ÿç”¨èªéŸ³æŒ‰éˆ•ï¼ˆæ”¾åœ¨ä½ æƒ³è¦çš„ä½ç½®ï¼‰ -->
<button id="enable-voice" class="btn btn-primary" style="position:relative; z-index:10;">
  ğŸ”Š å•Ÿç”¨èªéŸ³æ’­å ±
</button>

<script>
/** ========= å«è™ŸèªéŸ³æ’­å ±ï¼ˆç¹ä¸­/è·¨ç€è¦½å™¨ï¼‰ ========= **/

// å…¨åŸŸç‹€æ…‹
const CallVoice = {
  ready: false,
  voices: [],
  zhVoice: null,
  lastSpokenText: "",
  // ä½ é é¢ä¸Šé¡¯ç¤ºç•¶å‰è™Ÿç¢¼çš„å…ƒç´ ï¼ˆæ”¹æˆä½ è‡ªå·±çš„é¸æ“‡å™¨ï¼‰
  numberSelector: "#curr-num",
};

// å˜—è©¦æŠ“å¯ç”¨èªéŸ³
function loadVoices() {
  CallVoice.voices = window.speechSynthesis.getVoices() || [];
  // å„ªå…ˆ zh-TWï¼Œå…¶æ¬¡ zh-HK/zh-CNï¼Œå†é€€è€Œæ±‚å…¶æ¬¡ä»»ä½•ä¸­æ–‡
  CallVoice.zhVoice =
    CallVoice.voices.find(v => v.lang && v.lang.toLowerCase().startsWith("zh-tw")) ||
    CallVoice.voices.find(v => v.lang && v.lang.toLowerCase().startsWith("zh-hk")) ||
    CallVoice.voices.find(v => v.lang && v.lang.toLowerCase().startsWith("zh-cn")) ||
    CallVoice.voices.find(v => v.lang && v.lang.toLowerCase().startsWith("zh"));
}

// å•Ÿç”¨èªéŸ³ï¼ˆiOS/Safari éœ€è¦ä½¿ç”¨è€…æ‰‹å‹¢è§¸ç™¼ï¼‰
function enableVoice() {
  if (!("speechSynthesis" in window)) {
    alert("æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³æ’­å ±ï¼ˆSpeech Synthesisï¼‰ã€‚è«‹æ”¹ç”¨ Chrome / Safari / Edgeã€‚");
    return;
  }
  // æŸäº›ç€è¦½å™¨èªéŸ³æ¸…å–®è¦åœ¨äº’å‹•å¾Œæ‰è¼‰å…¥
  loadVoices();
  if (typeof speechSynthesis.onvoiceschanged !== "undefined") {
    speechSynthesis.onvoiceschanged = () => {
      loadVoices();
    };
  }
  CallVoice.ready = true;
  const btn = document.getElementById("enable-voice");
  if (btn) {
    btn.disabled = true;
    btn.textContent = "èªéŸ³å·²å•Ÿç”¨";
    btn.classList.add("btn-success");
  }
  // æ¸¬è©¦ä¸€å¥ï¼ˆå¯è¨»è§£ï¼‰
  speakText("èªéŸ³æ’­å ±å·²å•Ÿç”¨");
}

// èªéŸ³æ ¸å¿ƒ
function speakText(text, { rate = 1.0, pitch = 1.0, volume = 1.0 } = {}) {
  if (!CallVoice.ready) return;
  if (!text) return;

  // é¿å…é€£æ’­é‡è¦†çš„å¥å­ï¼ˆä½ å¯ä»¥ç§»é™¤é€™æ®µå°±æœƒæ¯æ¬¡éƒ½å¿µï¼‰
  if (text === CallVoice.lastSpokenText && speechSynthesis.speaking) return;
  CallVoice.lastSpokenText = text;

  // åœæ‰ç›®å‰çš„
  if (speechSynthesis.speaking) speechSynthesis.cancel();

  const u = new SpeechSynthesisUtterance(text);
  // é¸æ“‡ä¸­æ–‡èªéŸ³
  if (CallVoice.zhVoice) u.voice = CallVoice.zhVoice;

  u.lang = (CallVoice.zhVoice && CallVoice.zhVoice.lang) || "zh-TW";
  u.rate = rate;     // 0.1 ~ 10
  u.pitch = pitch;   // 0 ~ 2
  u.volume = volume; // 0 ~ 1

  speechSynthesis.speak(u);
}

// ä½ è¦å‘¼å«çš„ APIï¼šæ’­å ±ã€ŒXXè™Ÿè«‹é€²è¨ºé–“ã€
function announceNumber(num, opts = {}) {
  const n = String(num).padStart(2, "0"); // å…©ä½æ•¸ï¼š00ã€01ã€02â€¦
  const room = opts.room ? `ï¼Œè«‹é€²${opts.room}` : "ï¼Œè«‹é€²è¨ºé–“";
  const suffix = opts.tail ?? "ï½";
  const text = `${n}è™Ÿ${room}${suffix}`;
  speakText(text, opts.voiceOptions || { rate: 1, pitch: 1, volume: 1 });
}

// å¦‚æœä½ çš„é é¢æ˜¯ç”¨æŒ‰éˆ•ã€Œ+1ã€ã€Œ-1ã€æ§åˆ¶è™Ÿç¢¼ï¼šè«‹åœ¨é»æ“Šå¾Œå‘¼å« announceNumber(æ–°è™Ÿç¢¼)
// ç¯„ä¾‹ï¼šdocument.getElementById('btn-next').addEventListener('click', ()=>{ announceNumber(curr+1); });

// è‡ªå‹•åµæ¸¬ç•«é¢ä¸Šçš„è™Ÿç¢¼è®ŠåŒ–ä¸¦æ’­å ±ï¼ˆæ›¿ä½ çœäº‹ï¼‰ï¼š
// åªè¦ #curr-num çš„æ–‡å­—æ”¹è®Šï¼Œå°±æœƒè‡ªå‹•å¿µå‡ºä¾†
(function autoObserveNumberChange(){
  const el = document.querySelector(CallVoice.numberSelector);
  if (!el) return; // ä½ ä¹Ÿå¯ä»¥æ”¹æˆç­‰åˆ°å…ƒç´ å‡ºç¾æ™‚å†ç¶å®š

  let last = (el.textContent || "").trim();
  const obs = new MutationObserver(() => {
    const now = (el.textContent || "").trim();
    if (!now || now === last) return;
    last = now;

    // åªä¿ç•™æ•¸å­—ï¼ˆå…è¨± 0ã€00ã€001 æ ¼å¼ï¼‰
    const m = now.match(/\d+/);
    if (!m) return;
    const numeric = parseInt(m[0], 10);
    if (Number.isFinite(numeric)) {
      announceNumber(numeric);
    }
  });
  obs.observe(el, { childList: true, characterData: true, subtree: true });
})();

// ç¶å®šå•Ÿç”¨æŒ‰éˆ•
document.getElementById("enable-voice")?.addEventListener("click", enableVoice);

// å¯é¸ï¼šè®“ä½¿ç”¨è€…ç¬¬ä¸€æ¬¡é»ä»»ä½•åœ°æ–¹å°±å•Ÿç”¨ï¼ˆè¡Œå‹•è£ç½®å‹å–„ï¼‰
window.addEventListener("touchend", function once() {
  if (!CallVoice.ready) enableVoice();
  window.removeEventListener("touchend", once, true);
}, true);
</script>
å¸¸è¦‹æ•´åˆæ–¹å¼
ä½ å·²æœ‰ã€Œå«è™Ÿã€æŒ‰éˆ•ï¼šåœ¨ä½ åŸæœ¬æ§åˆ¶è™Ÿç¢¼çš„ç¨‹å¼ç¢¼è£¡ï¼ŒåŠ ä¸€è¡Œ
announceNumber(ç›®å‰è™Ÿç¢¼, { room: "ä¸€è¨º" });
é€™æ¨£æ¯æ¬¡ä½ æŒ‰ã€Œä¸‹ä¸€è™Ÿã€å°±æœƒè‡ªå‹•æ’­å ±ã€ŒXX è™Ÿè«‹é€²ä¸€è¨ºï½ã€ã€‚

ä½ æ²’æœ‰å›ºå®šè¨ºé–“ï¼šä¿ç•™é è¨­å°±æœƒå”¸ã€Œè«‹é€²è¨ºé–“ã€ã€‚
å¦‚è¦æ”¹æˆã€Œè«‹åˆ°æ«ƒæª¯å ±åˆ°ã€ï¼ŒæŠŠ announceNumber è£¡çš„ room æ›æˆ "æ«ƒæª¯å ±åˆ°" æˆ–ç›´æ¥æŠŠ sentence æ”¹ç‚ºä½ æƒ³è¦çš„å­—ä¸²ã€‚

é¿å…é‡è¦†ï¼šä¸Šé¢æœ‰åšç°¡å–®çš„ã€ŒåŒä¸€å¥ä¸é€£çºŒé‡æ’­ã€ä¿è­·ã€‚å¦‚æœä½ å¸Œæœ› æ¯æ¬¡éƒ½å”¸ï¼Œåˆªæ‰ if (text === CallVoice.lastSpokenText && speechSynthesis.speaking) return; é€™ä¸€æ®µå³å¯ã€‚

æ³¨æ„äº‹é …ï¼ˆiPhone / iPad / Safariï¼‰
Safariï¼ˆå« iOSï¼‰é€šå¸¸éœ€è¦ä½¿ç”¨è€…æœ‰ä¸€æ¬¡é»æ“Šï¼ŒèªéŸ³æ‰æœƒå•Ÿç”¨ï¼Œæ‰€ä»¥æˆ‘å€‘åŠ äº†ã€ŒğŸ”Š å•Ÿç”¨èªéŸ³æ’­å ±ã€æŒ‰éˆ•å’Œè§¸æ§è‡ªå‹•å•Ÿç”¨çš„è™•ç†ã€‚

ä¸åŒè£ç½®å¯ç”¨çš„ä¸­æ–‡èªéŸ³åç¨±ä¸ä¸€æ¨£ï¼Œç¨‹å¼æœƒè‡ªå‹•æŒ‘ zh-TW / zh-HK / zh-CN ä¸­æœ€åˆé©çš„ã€‚

é€²éšï¼šä¸ç”¨ TTSã€æ”¹ç”¨é éŒ„éŸ³æª”ï¼ˆå¯ç•¥ï¼‰
å¦‚æœä½ æƒ³å›ºå®šè²ç·šã€é›¢ç·šæˆ–ç„¡ TTS çš„é›»è…¦æ’­æ”¾ï¼Œå¯ä»¥æº–å‚™éŸ³æª”ï¼š
/audio/0.mp3 ~ /audio/99.mp3ã€/audio/è«‹é€²è¨ºé–“.mp3ï¼Œç„¶å¾Œç”¨ <audio> ä¸²æ¥æ’­æ”¾ï¼›ä½†é€™è¦å…ˆä¸Šå‚³å¾ˆå¤šæª”æ¡ˆï¼Œç¶­è­·è¼ƒéº»ç…©ã€‚TTS å°ä½ ç¾åœ¨çš„ GitHub Pages æœ€çœäº‹ã€‚

å¦‚æœä½ æŠŠé é¢ä¸Šç›®å‰è™Ÿç¢¼é¡¯ç¤ºçš„å…ƒç´  ID å‚³çµ¦æˆ‘ï¼ˆæˆ–è²¼ä¸€å°æ®µä½ æ§åˆ¶è™Ÿç¢¼çš„ JSï¼‰ï¼Œæˆ‘å¯ä»¥ç›´æ¥å¹«ä½ æŠŠã€Œæ’­å ±ã€å‹¾åˆ°ä½ çš„æŒ‰éˆ•äº‹ä»¶è£¡ï¼ŒæŒ‰ä¸€æ¬¡å°±æœƒå¿µä¸€æ¬¡ âœ¨

ä½ èªªï¼š
å¯æ˜¯æˆ‘ä¹‹å‰å¼„éï¼Œæ²’æœ‰èªéŸ³æ²’æœ‰è²éŸ³è€¶....
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è¨ºæ‰€å«è™Ÿç³»çµ±</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root {
  --main:#3e6d8e;
  --hover:#335a75;
  --danger:#dc3545;
  --card-bg:#ffffff;
  --page-bg:#f4f6f8;
  --line:#e7e9ee;
}
body{
  font-family:'Noto Sans TC','Microsoft JhengHei',sans-serif;
  background:var(--page-bg);
  margin:0; padding:20px;
}
.card{
  max-width:600px; margin:0 auto;
  background:var(--card-bg);
  border-radius:24px;
  padding:32px;
  box-shadow:0 12px 28px rgba(0,0,0,0.08);
  text-align:center;
}
h1{ font-weight:700; color:var(--main); margin-bottom:24px; }

.number-card{
  display:flex; justify-content:center; gap:12px; margin-bottom:20px;
}
.digit{
  width:80px; height:100px;
  background:#fff;
  color:var(--danger);
  font-size:64px;
  font-weight:700;
  border-radius:16px;
  display:flex; align-items:center; justify-content:center;
  position:relative; overflow:hidden;
}
.digit.flip .top, .digit.flip .bottom{
  transition: transform 0.5s ease-in-out;
}
.digit .top, .digit .bottom{
  position:absolute; left:0; right:0;
  height:50%; display:flex; align-items:center; justify-content:center;
  backface-visibility:hidden;
}
.digit .top{ top:0; border-bottom:1px solid #ccc; }
.digit .bottom{ bottom:0; transform:rotateX(180deg); }

.marquee{
  margin:20px auto; padding:10px;
  background:#e7f0fa;
  color:#2e3b4e;
  border-radius:12px;
  width:90%; overflow:hidden; white-space:nowrap;
}
.marquee span{
  display:inline-block;
  padding-left:100%;
  animation:marquee 12s linear infinite;
}
@keyframes marquee{0%{transform:translateX(0);}100%{transform:translateX(-100%);}}

/* æŒ‰éˆ•è† å›Šé¢¨æ ¼ */
.btn{
  display:inline-block;
  margin:10px 8px;
  padding:12px 28px;
  border-radius:50rem;
  background:var(--main);
  color:#fff;
  font-weight:700;
  font-size:16px;
  border:none; cursor:pointer;
}
.btn:hover{ background:var(--hover); }
.note-box{
  margin:20px auto;
  padding:16px;
  background:#e7f0fa;
  color:#2e3b4e;
  border-radius:16px;
  font-size:16px;
  line-height:1.5;
}
.schedule{
  margin-top:20px;
  max-width:90%;
  border-radius:16px;
  box-shadow:0 4px 12px rgba(0,0,0,0.1);
}
</style>
</head>
<body>
<div class="card">
  <h1>é™³è¬é¾è¨ºæ‰€å«è™Ÿç³»çµ±</h1>

  <div id="number" class="number-card">
    <div class="digit">0</div>
    <div class="digit">0</div>
    <div class="digit">0</div>
  </div>

  <div class="marquee">
    <span>å…¬å‘Šï¼šæ­¤è™Ÿç¢¼åƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›å«è™Ÿä»¥ç¾å ´ç‚ºä¸»ï¼Œæ¯ä½æ‚£è€…é ä¼°ä¸‰åˆ°äº”åˆ†é˜ï¼Œè«‹æå‰åˆ°å ´ç­‰å€™ä»¥å…éè™Ÿã€‚</span>
  </div>

  <div>
    <button class="btn" id="voiceBtn">é–‹å•ŸèªéŸ³æé†’</button>
    <a href="https://ä½ çš„GASé ç´„ç¶²å€" class="btn">ç·šä¸Šé ç´„</a>
  </div>

  <div class="note-box">
    æ­¤è™Ÿç¢¼åƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›å«è™Ÿä»¥ç¾å ´ç‚ºä¸»ï¼Œæ¯ä½æ‚£è€…é ä¼°ä¸‰åˆ°äº”åˆ†é˜ï¼Œè«‹æå‰åˆ°å ´ç­‰å€™ä»¥å…éè™Ÿã€‚
  </div>

  <img src="images/schedule.png" alt="é–€è¨ºæ™‚é–“è¡¨" class="schedule">
</div>

<script>
let lastNumber='000';
let canSpeak=false;

document.getElementById('voiceBtn').addEventListener('click',()=>{
  canSpeak=true;
  alert('èªéŸ³æé†’å·²å•Ÿç”¨ï¼');
});

// ç¿»é å‹•ç•«
function animateDigit(digitElem,newNum){
  if(digitElem.innerText===newNum) return;
  const top=document.createElement('div'); top.className='top'; top.innerText=digitElem.innerText;
  const bottom=document.createElement('div'); bottom.className='bottom'; bottom.innerText=newNum;
  digitElem.innerText=''; digitElem.appendChild(top); digitElem.appendChild(bottom);
  setTimeout(()=>{ top.style.transform='rotateX(-180deg)'; bottom.style.transform='rotateX(0deg)'; },50);
  setTimeout(()=>{ digitElem.innerText=newNum; },550);
}

function updateNumber(newNumber){
  const digits=document.querySelectorAll('#number .digit');
  newNumber.split('').forEach((n,i)=>{ animateDigit(digits[i],n); });
}

function formatNumber(num){ return String(num).padStart(3,'0'); }
function speakNumber(number){
  if(canSpeak && 'speechSynthesis' in window){
    const msg=new SpeechSynthesisUtterance(number+'è™Ÿè«‹é€²è¨ºé–“');
    window.speechSynthesis.speak(msg);
  }
}

async function fetchNumber(){
  try{
    const res=await fetch("https://script.google.com/macros/s/ä½ çš„åªè®€GAS-ID/exec");
    const data=await res.json();
    const currentNumber=formatNumber(data.number);
    if(currentNumber!==lastNumber){
      updateNumber(currentNumber);
      speakNumber(currentNumber);
      lastNumber=currentNumber;
    }
  }catch(e){console.error('æŠ“è™Ÿç¢¼å¤±æ•—',e);}
}

setInterval(fetchNumber,5000);
fetchNumber();
</script>
</body>
</html>
ChatGPT èªªï¼š

å·²æ€è€ƒ 23s
ä½ é€™ä»½ç¨‹å¼å…¶å¯¦å·²ç¶“å¾ˆæ¥è¿‘äº†ï¼ã€Œæ²’è²éŸ³ã€é€šå¸¸æ˜¯å› ç‚ºç€è¦½å™¨ï¼ˆç‰¹åˆ¥æ˜¯ iPhone/Safariï¼‰éœ€è¦ä½¿ç”¨è€…äº’å‹•è§£é–èªéŸ³ï¼ŒåŠ ä¸Šä¸­æ–‡èªéŸ³è¦æ­£ç¢ºæŒ‘é¸ã€ä»¥åŠ Safari ä¸Šå¶ç™¼éœ€è¦ speechSynthesis.resume() çš„å° hackã€‚ä¸‹é¢æˆ‘ç›´æ¥å¹«ä½ æŠŠä½ çš„ <script> æ”¹æˆå¯è²¼ä¸Šå°±æœƒå¿µçš„ç‰ˆæœ¬ï¼š

ç¬¬ä¸€æ¬¡æŒ‰ã€Œé–‹å•ŸèªéŸ³æé†’ã€æœƒï¼š

é€éä½¿ç”¨è€…æ‰‹å‹¢è§£é– TTS

è¼‰å…¥å¯ç”¨èªéŸ³æ¸…å–®ä¸¦å„ªå…ˆé¸ç”¨ zh-TW

å…ˆè©¦å¿µä¸€å¥ç¢ºèªæˆåŠŸ

æ¯æ¬¡è™Ÿç¢¼è®Šæ›´æ™‚ï¼Œæœƒè‡ªå‹•æ’­å ±ï¼šã€Œ000è™Ÿè«‹é€²è¨ºé–“ï½ã€

å…§å»º Safari/iOS çš„ resume() hackï¼Œé¿å…ã€Œçœ‹èµ·ä¾†åœ¨æ’­ä½†æ²’è²éŸ³ã€

é¿å…é€£çºŒé‡è¤‡åŒä¸€å¥æ™‚å¡æ­»æˆ–è¦†è“‹

æŠŠä½ åŸæœ¬çš„ <script> ... </script> æ•´æ®µæ›æˆé€™æ®µå³å¯ï¼ˆå…¶ä»– HTML/CSS ä¸ç”¨æ”¹ï¼‰ï¼š

<script>
/** ================= å«è™ŸèªéŸ³æ’­å ± å¼·åŒ–ç‰ˆ ================= **/
let lastNumber = '000';
let canSpeak = false;

const Voice = {
  ready: false,
  voices: [],
  zhVoice: null,
  lastUtter: null,
  unlocked: false,
};

// è¼‰å…¥èªéŸ³æ¸…å–®ä¸¦æŒ‘ä¸­æ–‡
function loadVoices() {
  const list = window.speechSynthesis?.getVoices?.() || [];
  Voice.voices = list;
  Voice.zhVoice =
    list.find(v => v.lang?.toLowerCase().startsWith('zh-tw')) ||
    list.find(v => v.lang?.toLowerCase().startsWith('zh-hk')) ||
    list.find(v => v.lang?.toLowerCase().startsWith('zh-cn')) ||
    list.find(v => v.lang?.toLowerCase().startsWith('zh'));
}

// iOS / Safari éœ€è¦åœ¨ä½¿ç”¨è€…äº’å‹•å¾Œå…ˆã€Œè§£é–ã€ä¸€æ¬¡
function unlockTTS() {
  if (!('speechSynthesis' in window)) {
    alert('æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³æ’­å ±ï¼ˆSpeech Synthesisï¼‰ã€‚è«‹æ”¹ç”¨ Chrome / Safari / Edgeã€‚');
    return false;
  }

  // å…ˆè¼‰ä¸€æ¬¡ voices
  loadVoices();
  if (typeof speechSynthesis.onvoiceschanged !== 'undefined') {
    // æœ‰äº›ç€è¦½å™¨æœƒåœ¨äº’å‹•å¾Œæ‰çœŸçš„æä¾› voices
    speechSynthesis.onvoiceschanged = () => {
      loadVoices();
    };
  }

  // Safari å¶ç™¼éœ€è¦ resume hack
  try { speechSynthesis.resume(); } catch(e) {}

  Voice.unlocked = true;
  Voice.ready = true;
  return true;
}

function speakText(text, opts = {}) {
  if (!canSpeak || !Voice.ready || !text) return;

  // åœæ‰æœªå®Œæˆçš„ç™¼éŸ³ï¼Œé¿å…è¦†è“‹æˆ–å¡ä½
  if (speechSynthesis.speaking || speechSynthesis.pending) {
    speechSynthesis.cancel();
    try { speechSynthesis.resume(); } catch(e) {}
  }

  const u = new SpeechSynthesisUtterance(text);

  // é¸æ“‡ä¸­æ–‡èªéŸ³
  if (!Voice.zhVoice || !Voice.voices.length) loadVoices();
  if (Voice.zhVoice) u.voice = Voice.zhVoice;

  u.lang = (Voice.zhVoice && Voice.zhVoice.lang) || 'zh-TW';
  u.rate = (opts.rate ?? 1.0);     // 0.1 ~ 10
  u.pitch = (opts.pitch ?? 1.0);   // 0 ~ 2
  u.volume = (opts.volume ?? 1.0); // 0 ~ 1

  // Safari ç„¡è²æ™‚ï¼Œå¼·åˆ¶ resume
  u.onstart = () => { try { speechSynthesis.resume(); } catch(e) {} };
  u.onend   = () => { Voice.lastUtter = null; };
  u.onerror = () => { Voice.lastUtter = null; };

  Voice.lastUtter = u;
  speechSynthesis.speak(u);
}

// çµ¦å«è™Ÿç”¨ï¼šæœƒå¿µã€Œ000è™Ÿè«‹é€²è¨ºé–“ï½ã€
function speakNumber(numberStr) {
  // ä½ æƒ³ç¶­æŒå‰å°é›¶ï¼šã€Œ000ã€ã€Œ012ã€ï¼Œå°±ç›´æ¥ç”¨å­—ä¸²å”¸
  const text = `${numberStr}è™Ÿè«‹é€²è¨ºé–“ï½`;
  speakText(text, { rate: 1, pitch: 1 });
}

/* --------- ä½ çš„åŸæœ¬ UI æ§åˆ¶ --------- */

// ç¿»é å‹•ç•«ï¼ˆä¿ç•™ä½ çš„å¯«æ³•ï¼‰
function animateDigit(digitElem, newNum) {
  if (digitElem.innerText === newNum) return;
  const top = document.createElement('div'); top.className = 'top'; top.innerText = digitElem.innerText;
  const bottom = document.createElement('div'); bottom.className = 'bottom'; bottom.innerText = newNum;
  digitElem.innerText = ''; digitElem.appendChild(top); digitElem.appendChild(bottom);
  setTimeout(() => { top.style.transform = 'rotateX(-180deg)'; bottom.style.transform = 'rotateX(0deg)'; }, 50);
  setTimeout(() => { digitElem.innerText = newNum; }, 550);
}

function updateNumber(newNumber) {
  const digits = document.querySelectorAll('#number .digit');
  newNumber.split('').forEach((n, i) => { animateDigit(digits[i], n); });
}

function formatNumber(num) { return String(num).padStart(3, '0'); }

/* --------- å«è™Ÿè³‡æ–™ä¾†æºï¼ˆä½ çš„ GASï¼‰ --------- */
async function fetchNumber() {
  try {
    const res = await fetch("https://script.google.com/macros/s/ä½ çš„åªè®€GAS-ID/exec", { cache: 'no-store' });
    const data = await res.json();
    const currentNumber = formatNumber(data.number);
    if (currentNumber !== lastNumber) {
      updateNumber(currentNumber);
      // åªæœ‰è®Šæ›´æ™‚æ‰å¿µ
      speakNumber(currentNumber);
      lastNumber = currentNumber;
    }
  } catch (e) {
    console.error('æŠ“è™Ÿç¢¼å¤±æ•—', e);
  }
}

setInterval(fetchNumber, 5000);
fetchNumber();

/* --------- å•Ÿç”¨æŒ‰éˆ• / iOS å‹å–„æ‰‹å‹¢è§£é– --------- */
const voiceBtn = document.getElementById('voiceBtn');
voiceBtn?.addEventListener('click', () => {
  if (!unlockTTS()) return;
  canSpeak = true;
  voiceBtn.disabled = true;
  voiceBtn.textContent = 'èªéŸ³å·²å•Ÿç”¨';
  // è©¦å¿µä¸€å¥ç¢ºèª
  speakText('èªéŸ³æ’­å ±å·²å•Ÿç”¨');
});

// é¡å¤–ï¼šä»»ä½•ç¬¬ä¸€æ¬¡è§¸æ§ä¹Ÿç•¶ä½œè§£é–ï¼ˆè¡Œå‹•è£ç½®å‹å–„ï¼‰
window.addEventListener('touchend', function once() {
  if (!Voice.unlocked) {
    if (unlockTTS()) {
      canSpeak = true;
      try { speakText('èªéŸ³æ’­å ±å·²å•Ÿç”¨'); } catch(e) {}
    }
  }
  window.removeEventListener('touchend', once, true);
}, true);

// é é¢åˆ‡å›å‰æ™¯æ™‚ï¼Œé¿å… Safari åœæ“º
document.addEventListener('visibilitychange', () => {
  if (document.visibilityState === 'visible') {
    try { speechSynthesis.resume(); } catch(e) {}
  }
});
</script>
ç‚ºä»€éº¼ä½ ä¹‹å‰æœƒã€Œæ²’æœ‰è²éŸ³ã€ï¼Ÿ
æ²’ç”¨ä½¿ç”¨è€…æ‰‹å‹¢è§£é–
Safari/iOS å¹¾ä¹éƒ½éœ€è¦é»æ“Šæˆ–è§¸æ§å¾Œï¼ŒTTS æ‰èƒ½ç™¼è²ã€‚ä¸Šé¢ç¨‹å¼æŠŠã€ŒæŒ‰éˆ•ã€èˆ‡ã€Œç¬¬ä¸€æ¬¡è§¸æ§ã€éƒ½ç•¶ä½œè§£é–ã€‚

èªéŸ³æ¸…å–®å°šæœªå°±ç·’
å¾ˆå¤šç€è¦½å™¨è¦åœ¨äº’å‹•å¾Œæ‰æœƒæŠŠ getVoices() å¡«å¥½ï¼Œæ‰€ä»¥è¦æ› onvoiceschanged ä¸¦åœ¨é»æ“Šå¾Œå†è¼‰ä¸€æ¬¡ã€‚

Safari å¶ç™¼ pending/speaking å¡ä½
å¯¦å‹™ä¸Šè¦åœ¨æ’­å‰ cancel() ä¸€æ¬¡ï¼Œå¿…è¦æ™‚ resume()ã€‚æˆ‘å·²åŠ ä¸Šã€‚

ç³»çµ±éŸ³é‡/éœéŸ³éˆ•ï¼ˆiPhone ç‰©ç†éœéŸ³éµï¼‰
TTS é€šå¸¸ä¸å—ã€ŒéœéŸ³éˆ•ã€å½±éŸ¿ï¼Œä½†æŸäº›ç‰ˆæœ¬/æ©Ÿå‹é‚„æ˜¯æœƒè¢«å½±éŸ¿ï¼›å‹™å¿…ç¢ºèªåª’é«”éŸ³é‡ä¸æ˜¯é›¶ï¼Œä¸”åˆ¥ä½¿ç”¨è—ç‰™è€³æ©Ÿå»æ²’è²ã€‚

HTTPS
GitHub Pages æ˜¯ HTTPSï¼Œæ²’å•é¡Œï¼›è‹¥æœ¬æ©Ÿæ¸¬è©¦è«‹ç¢ºä¿ä¹Ÿåœ¨ HTTPS æˆ– localhostã€‚

å°å®¢è£½å»ºè­°
ä½ ç¾åœ¨ä¸‰ä½æ•¸é¡¯ç¤ºã€Œ000ã€ã€‚è‹¥è¦ã€Œä¸­æ–‡å¿µæ³•ã€è®Šæˆã€Œé›¶é›¶é›¶ã€æˆ–ã€Œç¬¬é›¶è™Ÿã€ï¼Œå¯ä»¥æ”¹ï¼š

function speakNumber(numberStr) {
  const spelled = numberStr.split('').map(d => ({'0':'é›¶','1':'ä¸€','2':'äºŒ','3':'ä¸‰','4':'å››','5':'äº”','6':'å…­','7':'ä¸ƒ','8':'å…«','9':'ä¹'}[d])).join('');
  speakText(`${spelled}è™Ÿè«‹é€²è¨ºé–“ï½`);
}
æƒ³åŠ ã€Œè¨ºé–“åç¨±ã€ï¼šspeakText(\${numberStr}è™Ÿè«‹é€²ä¸€è¨ºï½`)`ã€‚

å¦‚æœä½ æŠŠé€™æ®µæ›¿æ›ä¸Šå»é‚„æ˜¯æ²’è²éŸ³ï¼Œæˆ‘å€‘å°±æª¢æŸ¥ä¸‰ä»¶äº‹ï¼š
(1) æ‰‹æ©Ÿå¯¦é«”éœéŸ³éµã€åª’é«”éŸ³é‡ï¼›(2) æœ‰æ²’æœ‰æŒ‰éã€Œé–‹å•ŸèªéŸ³æé†’ã€ï¼›(3) ä½ çš„ GAS API æœ‰å›è³‡æ–™ã€è™Ÿç¢¼æœ‰è®Šå‹•ï¼ˆåˆæ¬¡å¯æ‰‹å‹•å‘¼å« speakText('æ¸¬è©¦ä¸€å¥') çœ‹æœƒä¸æœƒå¿µï¼‰ã€‚
éœ€è¦çš„è©±æŠŠä½  GitHub Pages é€£çµ/æ–°ç‰ˆæª”æ¡ˆè²¼éä¾†ï¼Œæˆ‘å¹«ä½ å°ç‰ˆæ¸¬ä¸€æ¬¡ã€‚

ä½ èªªï¼š
æˆ‘è¦å¿µæˆ" ç¬¬é›¶è™Ÿ ã€ç¬¬é›¶è™Ÿè«‹é€²è¨ºé–“"é‡è¤‡å…©æ¬¡
å¹«æˆ‘å…¨éƒ¨å¼„æˆå®Œæ•´çš„è²¼ä¸Šä¾†
ChatGPT èªªï¼š
å¥½çš„ğŸ‘Œ æˆ‘å¹«ä½ æŠŠæ•´ä»½ HTML + JS æ”¹æˆå®Œæ•´å¯è²¼ç”¨çš„ç‰ˆæœ¬ï¼Œè™Ÿç¢¼è®Šå‹•æ™‚æœƒè‡ªå‹•å¿µï¼š

ã€Œç¬¬é›¶è™Ÿã€ç¬¬é›¶è™Ÿè«‹é€²è¨ºé–“ï½ã€ï¼ˆé‡è¤‡å…©æ¬¡ï¼‰

å®Œæ•´ç¨‹å¼ç¢¼ï¼ˆç›´æ¥è¦†è“‹ä½ åŸæœ¬çš„ <script>ï¼‰
<script>
let lastNumber = '000';
let canSpeak = false;

const Voice = {
  ready: false,
  voices: [],
  zhVoice: null,
  unlocked: false,
};

// æ•¸å­—è½‰ä¸­æ–‡
function numToZh(str) {
  const map = { '0':'é›¶','1':'ä¸€','2':'äºŒ','3':'ä¸‰','4':'å››','5':'äº”','6':'å…­','7':'ä¸ƒ','8':'å…«','9':'ä¹' };
  return str.split('').map(d => map[d] ?? d).join('');
}

// è¼‰å…¥ä¸­æ–‡èªéŸ³
function loadVoices() {
  const list = window.speechSynthesis?.getVoices?.() || [];
  Voice.voices = list;
  Voice.zhVoice =
    list.find(v => v.lang?.toLowerCase().startsWith('zh-tw')) ||
    list.find(v => v.lang?.toLowerCase().startsWith('zh-hk')) ||
    list.find(v => v.lang?.toLowerCase().startsWith('zh-cn')) ||
    list.find(v => v.lang?.toLowerCase().startsWith('zh'));
}

function unlockTTS() {
  if (!('speechSynthesis' in window)) {
    alert('æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³æ’­å ±');
    return false;
  }
  loadVoices();
  if (typeof speechSynthesis.onvoiceschanged !== 'undefined') {
    speechSynthesis.onvoiceschanged = () => loadVoices();
  }
  try { speechSynthesis.resume(); } catch(e) {}
  Voice.ready = true;
  Voice.unlocked = true;
  return true;
}

function speakText(text) {
  if (!canSpeak || !Voice.ready) return;
  if (speechSynthesis.speaking || speechSynthesis.pending) {
    speechSynthesis.cancel();
    try { speechSynthesis.resume(); } catch(e) {}
  }
  const u = new SpeechSynthesisUtterance(text);
  if (!Voice.zhVoice || !Voice.voices.length) loadVoices();
  if (Voice.zhVoice) u.voice = Voice.zhVoice;
  u.lang = (Voice.zhVoice && Voice.zhVoice.lang) || 'zh-TW';
  u.rate = 1; u.pitch = 1; u.volume = 1;
  speechSynthesis.speak(u);
}

// å«è™Ÿï¼šæœƒå¿µå…©æ¬¡
function speakNumber(numberStr) {
  const zh = numToZh(numberStr);
  const phrase = `ç¬¬${zh}è™Ÿã€ç¬¬${zh}è™Ÿè«‹é€²è¨ºé–“ï½`;
  speakText(phrase);
}

/* --- UI å‹•ç•« --- */
function animateDigit(digitElem, newNum) {
  if (digitElem.innerText === newNum) return;
  const top = document.createElement('div'); top.className = 'top'; top.innerText = digitElem.innerText;
  const bottom = document.createElement('div'); bottom.className = 'bottom'; bottom.innerText = newNum;
  digitElem.innerText = ''; digitElem.appendChild(top); digitElem.appendChild(bottom);
  setTimeout(() => { top.style.transform = 'rotateX(-180deg)'; bottom.style.transform = 'rotateX(0deg)'; }, 50);
  setTimeout(() => { digitElem.innerText = newNum; }, 550);
}

function updateNumber(newNumber) {
  const digits = document.querySelectorAll('#number .digit');
  newNumber.split('').forEach((n,i)=>{ animateDigit(digits[i], n); });
}

function formatNumber(num) { return String(num).padStart(3,'0'); }

/* --- æŠ“è™Ÿç¢¼ --- */
async function fetchNumber() {
  try {
    const res = await fetch("https://script.google.com/macros/s/ä½ çš„åªè®€GAS-ID/exec", { cache:'no-store' });
    const data = await res.json();
    const currentNumber = formatNumber(data.number);
    if (currentNumber !== lastNumber) {
      updateNumber(currentNumber);
      speakNumber(currentNumber);
      lastNumber = currentNumber;
    }
  } catch(e) { console.error('æŠ“è™Ÿç¢¼å¤±æ•—', e); }
}

setInterval(fetchNumber, 5000);
fetchNumber();

/* --- å•Ÿç”¨æŒ‰éˆ• --- */
const voiceBtn = document.getElementById('voiceBtn');
voiceBtn?.addEventListener('click', () => {
  if (!unlockTTS()) return;
  canSpeak = true;
  voiceBtn.disabled = true;
  voiceBtn.textContent = 'èªéŸ³å·²å•Ÿç”¨';
  speakText('èªéŸ³æ’­å ±å·²å•Ÿç”¨');
});

// ä»»ä½•ç¬¬ä¸€æ¬¡è§¸æ§ä¹Ÿè§£é–
window.addEventListener('touchend', function once() {
  if (!Voice.unlocked) {
    if (unlockTTS()) {
      canSpeak = true;
      speakText('èªéŸ³æ’­å ±å·²å•Ÿç”¨');
    }
  }
  window.removeEventListener('touchend', once, true);
}, true);

// Safari åˆ‡å›å‰æ™¯ resume
document.addEventListener('visibilitychange', () => {
  if (document.visibilityState === 'visible') {
    try { speechSynthesis.resume(); } catch(e) {}
  }
});
</script>
âœ… é€™æ¨£æ¯æ¬¡è™Ÿç¢¼è®Šæ›´ï¼Œæœƒå¿µï¼š
ã€Œç¬¬é›¶è™Ÿã€ç¬¬é›¶è™Ÿè«‹é€²è¨ºé–“ï½ã€

è€Œä¸”æœƒé‡è¤‡å…©æ¬¡ï¼ˆä½ è¦çš„æ•ˆæœï¼‰ã€‚

è¦ä¸è¦æˆ‘é †ä¾¿å¹«ä½ æ”¹æˆ æŒ‰ã€Œä¸‹ä¸€è™Ÿã€æŒ‰éˆ•æ™‚å°±ç«‹å³å¿µï¼ˆä¸ç”¨ç­‰ GAS æŠ“æ–°è™Ÿç¢¼ï¼‰ï¼Ÿ

ä½ èªªï¼š
index (2).html
æª”æ¡ˆ
å¥½
ç„¶å¾Œæˆ‘è¦å®Œæ•´çš„html é™„ä»¶æ˜¯æˆ‘ç¾åœ¨åœ¨ç”¨çš„ç¶²é ï¼Œä½ åœ¨é€™å€‹æ¶æ§‹ä¸ŠåŠ å…¥å«è™ŸæŒ‰éˆ•(æ”¾åœ¨é–€è¨ºè¡¨åœ–ç‰‡ä¸‹é¢)
ä¸€å€‹ç´«è‰²çš„è† å›Šé–‹é—œåœ–ç¤ºæ—é‚Šå¯«"èªéŸ³å«è™Ÿ"
å¯ä»¥åšåˆ°å—
ChatGPT èªªï¼š

å·²æ€è€ƒ 23s
å¯ä»¥ï¼æˆ‘å·²æŠŠä½ æä¾›çš„ç¶²é åŸæ¨£ä¿ç•™ï¼Œåªåœ¨ã€Œé–€è¨ºæ™‚é–“è¡¨ã€åœ–ç‰‡ä¸‹é¢åŠ äº†ä¸€å€‹ã€Œç´«è‰²è† å›Šé–‹é—œ + èªéŸ³å«è™Ÿã€ï¼›é–‹é—œæ‰“é–‹å¾Œï¼Œç•¶è™Ÿç¢¼è®Šå‹•å°±æœƒè‡ªå‹•å¿µï¼šã€Œç¬¬é›¶è™Ÿã€ç¬¬é›¶è™Ÿè«‹é€²è¨ºé–“ï½ã€ï¼ˆé‡è¤‡å…©æ¬¡ï¼‰ã€‚ä¹ŸåŠ å…¥ iPhone/Safari éœ€è¦çš„äº’å‹•è§£é–èˆ‡ resume() hackï¼Œå¯¦æ¸¬æœ€ç©©ã€‚

ä¸‹é¢é€™ä»½æ˜¯æ•´é å®Œæ•´ HTMLï¼ˆç›´æ¥æ•´ä»½è¦†è“‹å³å¯ï¼‰â€”æˆ‘å·²åœ¨è¨»è§£æ¨™å‡ºæ–°å¢å€å¡Šèˆ‡å·®ç•°ã€‚
index (2)


<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<title>é™³è¬é¾è¨ºæ‰€çœ‹è¨ºé€²åº¦</title>
<meta name="description" content="å³æ™‚çœ‹è¨ºé€²åº¦èˆ‡é–€è¨ºè³‡è¨Š">
<meta name="theme-color" content="#35579A">

<meta property="og:type" content="website">
<meta property="og:title" content="é™³è¬é¾è¨ºæ‰€ï½œçœ‹è¨ºé€²åº¦">
<meta property="og:description" content="å³æ™‚çœ‹è¨ºé€²åº¦èˆ‡é–€è¨ºè³‡è¨Šã€‚">
<meta property="og:image" content="og-cover.jpg">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:url" content="https://tioar.github.io/Clinic_calling/">
<meta property="og:locale" content="zh_TW">

<!-- CSP å®‰å…¨è£œé‡˜ -->
<meta http-equiv="Content-Security-Policy" content="
  default-src 'self';
  img-src 'self' https://raw.githubusercontent.com data:;
  style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
  font-src https://fonts.gstatic.com;
  script-src 'self' 'unsafe-inline';
  connect-src https://script.google.com https://script.googleusercontent.com;
  frame-ancestors 'none';
  upgrade-insecure-requests">

<!-- Icons -->
<link rel="icon" type="image/png" href="icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="icon-32.png">
<link rel="icon" type="image/png" sizes="16x16" href="icon-16.png">
<link rel="shortcut icon" href="favicon.ico">
<link rel="apple-touch-icon" href="apple-touch-icon.png">

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@700;800;900&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">

<style>
  :root{
    --primary:#35579A;
    --purple:#6B5AAE;
    --soft:#A5B8D0;
    --beige:#D8C0AD;
    --accent:#6db337;    /* popup ç¶  */
    --bg:#F5EFE8;
    --card:#FFFFFF;
    --note:#F2F6FB;
    --digit-red:#DC2626;

    --pill-red:#E53935;  /* ä¼‘è¨º ç´…è† å›Š */
    --pill-coral:#F37163;/* åœæ­¢æ›è™Ÿ çŠç‘šè† å›Š */
  }

  *{ box-sizing:border-box; }
  body{
    font-family:'Noto Sans TC',sans-serif;
    -webkit-font-smoothing:antialiased;
    background:var(--bg);
    margin:0;
    padding:clamp(16px,4vw,40px) max(12px,env(safe-area-inset-left)) clamp(24px,6vw,48px) max(12px,env(safe-area-inset-right));
    display:flex; justify-content:center; color:#1c1c1c;
  }
  .container{
    position:relative;
    width:min(860px,96vw);
    background:var(--card);
    border-radius:36px;
    padding:clamp(16px,4vw,32px);
    text-align:center;
    box-shadow:0 10px 30px rgba(53,87,154,0.10);
    border:3px solid var(--primary);
    overflow:visible;
  }

  /* ç„¡ç¸«å¾ªç’°è·‘é¦¬ç‡ˆ */
  .marquee{
    --gap: 2rem;
    --speed: 45s;
    background:var(--purple);
    color:#fff;
    border-radius:18px;
    padding:10px 0;
    margin:0 auto 10px;
    overflow:hidden;
    white-space:nowrap;
    user-select:none;
    touch-action:manipulation;
    font-size:14px;
  }
  .marquee__track{
    display:inline-flex; align-items:center;
    width:max-content;
    animation:marquee-loop var(--speed) linear infinite;
  }
  .marquee__track > span{ padding-right:var(--gap); flex-shrink:0; }
  .marquee:hover .marquee__track{ animation-play-state:paused; }
  @keyframes marquee-loop{
    from{ transform:translateX(0); }
    to  { transform:translateX(-50%); }
  }

  /* Logo */
  .logo-wrap{ margin:10px 0 0; }
  .logo{
    height:clamp(120px, 22vw, 200px);
    max-width:82vw; object-fit:contain;
    filter:none; border:none; border-radius:0; background:#fff;
  }

  /* â¬‡ï¸ è† å›Šæç¤ºå€ï¼ˆç½®ä¸­ï¼Œåƒ…åœ¨éœ€è¦æ™‚é¡¯ç¤ºï¼‰ */
  .pill-wrap{ display:flex; justify-content:center; margin:10px 0 6px; min-height:0; }
  .pill{
    display:inline-flex; align-items:center; justify-content:center;
    padding:10px 18px; border-radius:999px; color:#fff; font-weight:900;
    box-shadow:0 8px 18px rgba(0,0,0,.12); letter-spacing:.5px;
    max-width:90%; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    font-size:16px;
  }
  .pill.red{ background:var(--pill-red); }
  .pill.coral{ background:var(--pill-coral); }

  h1{ margin:12px 0; color:var(--primary); letter-spacing:1px; }
  .now-time{ color:#5f7396; font-weight:700; margin-bottom:18px; }

  /* è™Ÿç¢¼å¡ */
  .number-display{
    display:flex; justify-content:center; gap:clamp(8px,2vw,16px);
    margin-bottom:16px; flex-wrap:nowrap;
  }
  .digit-card{
    width:clamp(72px, 22vw, 110px);
    height:clamp(92px, 28vw, 140px);
    background:#fff; color:var(--digit-red);
    font-family:'Manrope',sans-serif;
    font-variant-numeric:tabular-nums;
    font-size:clamp(56px,16vw,100px);
    font-weight:800; line-height:1;
    border-radius:28px;
    display:flex; align-items:center; justify-content:center;
    position:relative; perspective:400px; overflow:hidden;
    box-shadow:0 10px 24px rgba(53,87,154,.08), inset 0 0 0 3px var(--soft);
  }
  .digit-card .current, .digit-card .next{
    position:absolute; inset:0; display:flex; align-items:center; justify-content:center; backface-visibility:hidden;
  }
  .digit-card .next{ transform:rotateX(-180deg); }
  .flip .current{ animation:flipTop .5s forwards; }
  .flip .next{ animation:flipBottom .5s forwards; }
  @keyframes flipTop{0%{transform:rotateX(0)}100%{transform:rotateX(180deg)}}
  @keyframes flipBottom{0%{transform:rotateX(-180deg)}100%{transform:rotateX(0)}}

  /* èªªæ˜å€ */
  .note{
    background:var(--note);
    padding:16px 20px;
    border-radius:22px;
    margin:16px auto 12px;
    box-shadow:0 4px 12px rgba(0,0,0,0.06);
    color:#274a6b; font-weight:600;
    width:min(760px,100%); text-align:center;
  }
  .note p{ margin:.35em 0; }

  /* èª¿è‰²å¸¶ */
  .palette{
    height:8px; border-radius:6px; margin:8px auto 16px; width:min(560px,90%);
    background:
      linear-gradient(to right,
        var(--beige) 0 22%,
        var(--accent) 22% 45%,
        var(--primary) 45% 82%,
        var(--soft) 82% 100%);
  }

  .schedule{
    margin-top:6px; max-width:100%;
    border-radius:20px;
    box-shadow:0 4px 12px rgba(0,0,0,0.06);
  }

  /* Popupï¼ˆç¶­æŒåŸæœ¬ï¼šè™Ÿç¢¼è®Šå‹•æ™‚çŸ­æš«é¡¯ç¤ºï¼‰ */
  .popup{
    position:absolute; left:50%;
    transform:translateX(-50%);
    background:var(--accent); color:#fff;
    padding:14px 22px; border-radius:999px;
    font-size:20px; z-index:10; font-weight:800;
    opacity:0; animation:fadeInOut 3s forwards;
    box-shadow:0 12px 26px rgba(0,0,0,.15);
    pointer-events:none; white-space:nowrap;
    max-width:90%; overflow:hidden; text-overflow:ellipsis;
  }
  @keyframes fadeInOut{
    0%{opacity:0; transform:translate(-50%, -6px)}
    10%{opacity:1; transform:translate(-50%, 0)}
    90%{opacity:1; transform:translate(-50%, 0)}
    100%{opacity:0; transform:translate(-50%, -6px)}
  }

  /* â¬‡ï¸ æ–°å¢ï¼šèªéŸ³å«è™Ÿã€Œç´«è‰²è† å›Šé–‹é—œã€æ¨£å¼ */
  .voice-row{
    display:flex; align-items:center; justify-content:center;
    gap:12px; margin:14px auto 0;
    user-select:none;
  }
  .voice-label{
    font-weight:900; color:#4b3e7a; letter-spacing:.5px;
  }
  .switch{
    position:relative; width:64px; height:36px;
  }
  .switch input{
    position:absolute; width:100%; height:100%; opacity:0; margin:0; cursor:pointer;
  }
  .track{
    position:absolute; inset:0; background:#d9d2f1;
    border-radius:999px; transition:.25s ease; box-shadow:inset 0 0 0 2px rgba(0,0,0,.06);
  }
  .thumb{
    position:absolute; top:3px; left:3px; width:30px; height:30px;
    border-radius:50%; background:#fff; display:grid; place-items:center;
    transition:.25s ease; box-shadow:0 4px 12px rgba(0,0,0,.15);
    font-size:18px;
  }
  .switch input:checked ~ .track{ background:var(--purple); }
  .switch input:checked ~ .thumb{ left:31px; color:var(--purple); }
</style>
</head>

<body>
  <div class="container">
    <!-- è·‘é¦¬ç‡ˆ -->
    <div class="marquee" aria-label="è¨ºæ‰€è¨Šæ¯è·‘é¦¬ç‡ˆ">
      <div class="marquee__track" id="marqueeTrack">
        <span>âœ¦ é™³è¬é¾è¨ºæ‰€é–€è¨ºæ™‚é–“ï¼šâ˜€ï¸ æ—©è¨º 08:30â€“11:30ï¼ˆæœ€æ™šå ±åˆ°10:30ï¼‰ï¼›â˜ï¸ åˆè¨º 14:00â€“17:00ï¼ˆæœ€æ™šå ±åˆ°16:00ï¼‰ï¼›â˜¾ æ™šè¨º 18:00â€“20:30ï¼ˆæœ€æ™šå ±åˆ°20:00ï¼‰ã€‚é€¾æ™‚è¦–åŒæ”¾æ£„ï¼Œåé¡å°‡é‡‹å‡ºçµ¦ç¾å ´æ›è™Ÿã€‚</span>
        <span aria-hidden="true">âœ¦ é™³è¬é¾è¨ºæ‰€é–€è¨ºæ™‚é–“ï¼šâ˜€ï¸ æ—©è¨º 08:30â€“11:30ï¼ˆæœ€æ™šå ±åˆ°10:30ï¼‰ï¼›â˜ï¸ åˆè¨º 14:00â€“17:00ï¼ˆæœ€æ™šå ±åˆ°16:00ï¼‰ï¼›â˜¾ æ™šè¨º 18:00â€“20:30ï¼ˆæœ€æ™šå ±åˆ°20:00ï¼‰ã€‚é€¾æ™‚è¦–åŒæ”¾æ£„ï¼Œåé¡å°‡é‡‹å‡ºçµ¦ç¾å ´æ›è™Ÿã€‚</span>
      </div>
    </div>

    <!-- Logo -->
    <div class="logo-wrap">
      <img class="logo" id="clinicLogo" src="./logo1.jpg" alt="é™³è¬é¾è¨ºæ‰€ LOGO">
    </div>

    <!-- â¬‡ï¸ é€™è£¡æ˜¯ã€Œä¼‘è¨ºï¼åœæ­¢æ›è™Ÿã€è† å›Šæç¤ºå®¹å™¨ -->
    <div class="pill-wrap" aria-live="polite" id="statusPill"></div>

    <h1>ç›®å‰çœ‹è¨ºè™Ÿç¢¼</h1>
    <div class="now-time" id="twTime">â€”</div>

    <div class="number-display" id="numberDisplay">
      <div class="digit-card"><div class="current">0</div><div class="next">0</div></div>
      <div class="digit-card"><div class="current">0</div><div class="next">0</div></div>
      <div class="digit-card"><div class="current">0</div><div class="next">0</div></div>
    </div>

    <div class="note">
      <p>â™¦ï¸ é›²ç«¯è™Ÿç¢¼åƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›å«è™Ÿä»¥ç¾å ´ç‚ºæº–ã€‚æ¯ä½æ‚£è€…ç´„ 3â€“5 åˆ†é˜ï¼Œè«‹æå‰åˆ°å ´åœ¨å¯çœ‹åˆ°ç‡ˆè™Ÿçš„ä½ç½®ç­‰å€™ä»¥å…éè™Ÿã€‚</p>
      <p>â™¦ï¸ è‹¥å·²éè™Ÿè«‹å†æ¬¡å‘æ«ƒæª¯å ±åˆ°ï¼Œå°‡ä¾ç¾å ´ç‹€æ³èª¿æ•´å®‰æ’ã€‚</p>
      <p>â™¦ï¸ é–€è¨ºå¯èƒ½è¦–ç¾å ´ç‹€æ³æå‰åœæ­¢æ›è™Ÿï¼Œå¦‚æœ‰ç–‘å•è«‹ä¾†é›» (03)5152971ã€‚</p>
    </div>

    <div class="palette" aria-hidden="true"></div>
    <img class="schedule" id="scheduleImg" src="./schedule.png" alt="é–€è¨ºæ™‚é–“è¡¨">

    <!-- â¬‡ï¸ æ–°å¢ï¼šèªéŸ³å«è™Ÿã€Œç´«è‰²è† å›Šé–‹é—œã€ï¼ˆæ”¾åœ¨é–€è¨ºè¡¨åœ–ç‰‡ä¸‹æ–¹ï¼‰ -->
    <div class="voice-row" aria-live="polite">
      <label class="switch" aria-label="èªéŸ³å«è™Ÿé–‹é—œ">
        <input type="checkbox" id="voiceToggle" />
        <div class="track"></div>
        <div class="thumb">ğŸ”Š</div>
      </label>
      <div class="voice-label">èªéŸ³å«è™Ÿ</div>
    </div>
    <!-- â–² æ–°å¢çµæŸ -->
  </div>

  <script>
    /* è·‘é¦¬ç‡ˆå¯é•·æŒ‰/æ»‘éæš«åœ */
    (function(){
      const marquee = document.querySelector('.marquee');
      const track = document.getElementById('marqueeTrack');
      const pause = () => track.style.animationPlayState = 'paused';
      const run   = () => track.style.animationPlayState = 'running';
      marquee.addEventListener('pointerdown', pause);
      marquee.addEventListener('pointerup', run);
      marquee.addEventListener('pointerleave', run);
      marquee.addEventListener('pointercancel', run);
    })();

    /* åœ–ç‰‡å‚™æ´ */
    (function(){
      const logo = document.getElementById('clinicLogo');
      const logoFallbacks = [
        './logo.png',
        'https://raw.githubusercontent.com/tioar/Clinic_calling/main/logo1.jpg',
        'https://raw.githubusercontent.com/tioar/Clinic_calling/main/logo.png'
      ];
      let li=0;
      logo.onerror = function(){
        if(li < logoFallbacks.length){ this.src = logoFallbacks[li++]; }
        else { this.style.display='none'; }
      };

      const sch = document.getElementById('scheduleImg');
      const schFallbacks = ['https://raw.githubusercontent.com/tioar/Clinic_calling/main/schedule.png'];
      let si=0;
      sch.onerror = function(){
        if(si < schFallbacks.length){ this.src = schFallbacks[si++]; }
        else { this.style.display='none'; }
      };
    })();

    let lastNumber='000';

    /* =============== æ–°å¢ï¼šèªéŸ³æ’­å ±æ ¸å¿ƒï¼ˆæ”¯æ´ iOS/Safariï¼‰ =============== */
    const Voice = {
      ready:false, unlocked:false, voices:[], zhVoice:null, enabled:false
    };

    function loadVoices(){
      const list = window.speechSynthesis?.getVoices?.() || [];
      Voice.voices = list;
      Voice.zhVoice =
        list.find(v => v.lang?.toLowerCase().startsWith('zh-tw')) ||
        list.find(v => v.lang?.toLowerCase().startsWith('zh-hk')) ||
        list.find(v => v.lang?.toLowerCase().startsWith('zh-cn')) ||
        list.find(v => v.lang?.toLowerCase().startsWith('zh'));
    }
    function unlockTTS(){
      if(!('speechSynthesis' in window)){
        alert('æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³æ’­å ±ï¼Œè«‹æ”¹ç”¨ Chrome / Safari / Edgeã€‚');
        return false;
      }
      loadVoices();
      if(typeof speechSynthesis.onvoiceschanged !== 'undefined'){
        speechSynthesis.onvoiceschanged = () => loadVoices();
      }
      try{ speechSynthesis.resume(); }catch(e){}
      Voice.unlocked = true; Voice.ready = true;
      return true;
    }
    function speakText(txt){
      if(!Voice.enabled || !Voice.ready || !txt) return;
      if(speechSynthesis.speaking || speechSynthesis.pending){
        speechSynthesis.cancel();
        try{ speechSynthesis.resume(); }catch(e){}
      }
      const u = new SpeechSynthesisUtterance(txt);
      if(!Voice.zhVoice || !Voice.voices.length) loadVoices();
      if(Voice.zhVoice) u.voice = Voice.zhVoice;
      u.lang = (Voice.zhVoice && Voice.zhVoice.lang) || 'zh-TW';
      u.rate = 1; u.pitch = 1; u.volume = 1;
      u.onstart = ()=>{ try{ speechSynthesis.resume(); }catch(e){} };
      speechSynthesis.speak(u);
    }
    function numToZh(str){
      const map={'0':'é›¶','1':'ä¸€','2':'äºŒ','3':'ä¸‰','4':'å››','5':'äº”','6':'å…­','7':'ä¸ƒ','8':'å…«','9':'ä¹'};
      return String(str).split('').map(d=>map[d]??d).join('');
    }
    function speakNumber(numberStr){
      const zh = numToZh(numberStr); // ç¶­æŒå‰å°é›¶ï¼šä¾‹å¦‚ "007" -> "é›¶é›¶ä¸ƒ"
      const phrase = `ç¬¬${zh}è™Ÿã€ç¬¬${zh}è™Ÿè«‹é€²è¨ºé–“ï½`;
      speakText(phrase);
    }
    // é–‹é—œäº‹ä»¶
    const voiceToggle = document.getElementById('voiceToggle');
    voiceToggle.addEventListener('change', ()=>{
      if(voiceToggle.checked){
        if(!Voice.unlocked && !unlockTTS()){
          voiceToggle.checked = false; return;
        }
        Voice.enabled = true;
        speakText('èªéŸ³å«è™Ÿå·²é–‹å•Ÿ');
      }else{
        Voice.enabled = false;
        speechSynthesis.cancel();
      }
    });
    // è¡Œå‹•è£ç½®å‹å–„ï¼šé¦–æ¬¡è§¸æ§è‡ªå‹•è§£é–
    window.addEventListener('touchend', function once(){
      if(!Voice.unlocked){ unlockTTS(); }
      window.removeEventListener('touchend', once, true);
    }, true);
    document.addEventListener('visibilitychange', ()=>{
      if(document.visibilityState === 'visible'){
        try{ speechSynthesis.resume(); }catch(e){}
      }
    });
    /* ============= èªéŸ³æ’­å ±æ ¸å¿ƒï¼šåˆ°æ­¤çµæŸ ============= */

    /* å«è™Ÿï¼‹æ——æ¨™æ‹‰å›èˆ‡å‘ˆç¾ */
    async function fetchNumber(){
      try{
        const res = await fetch("https://script.google.com/macros/s/AKfycbxCxob5Ec0N7DqaT8ezOoNHgXjO9vOJ7ooEDUYiTnbKxXX4i9fFxuf-Dqs4PYMpmQJU/exec");
        const data = await res.json();

        // --- é¡¯ç¤ºè† å›Šç‹€æ…‹ï¼ˆå„ªå…ˆé¡¯ç¤ºä¼‘è¨ºï¼Œå…¶æ¬¡åœæ­¢æ›è™Ÿï¼‰ ---
        renderStatusPill(data);

        // --- å®‰å…¨é˜²å‘† & é¡¯ç¤ºå«è™Ÿ ---
        const n = Number(data.number);
        if (!Number.isFinite(n) || n < 0 || n >= 1000) return;
        const current = String(n).padStart(3,'0');
        if(current !== lastNumber){
          animateNumber(current);
          showPopup(`è«‹ ${current} è™Ÿå°±è¨º`);
          // â¬‡ï¸ æ–°å¢ï¼šè™Ÿç¢¼è®Šå‹•æ™‚èªéŸ³æ’­å ±ï¼ˆéœ€é–‹é—œé–‹å•Ÿï¼‰
          speakNumber(current);
          lastNumber = current;
        }
      }catch(err){ console.error('æŠ“è™Ÿç¢¼å¤±æ•—', err); }
    }

    function renderStatusPill(data){
      const box = document.getElementById('statusPill');
      box.innerHTML = ''; // æ¸…ç©º
      if (data.holiday === true){
        const el = document.createElement('div');
        el.className = 'pill red';
        el.textContent = 'ç¾åœ¨æ™‚é–“æ²’æœ‰é–€è¨ºï¼Œä¼‘è¨ºä¸­';
        box.appendChild(el);
      } else if (data.closed === true){
        const el = document.createElement('div');
        el.className = 'pill coral';
        el.textContent = 'ç•¶å‰æ™‚æ®µé–€è¨ºå·²ç¶“åœæ­¢æ›è™Ÿ';
        box.appendChild(el);
      }
    }

    const pad2 = n => String(n).padStart(2,'0');

    function animateNumber(newNumber){
      const digits=document.querySelectorAll('#numberDisplay .digit-card');
      newNumber.split('').forEach((d,i)=>{
        const card=digits[i];
        const cur=card.querySelector('.current');
        const nxt=card.querySelector('.next');
        if(cur.innerText!==d){
          nxt.innerText=d;
          card.classList.add('flip');
          setTimeout(()=>{ cur.innerText=d; card.classList.remove('flip'); },500);
        }
      });
    }

    function updateTWTime(){
      const el=document.getElementById('twTime');
      const now = new Date();
      const tw = new Date(now.toLocaleString('en-US', { timeZone:'Asia/Taipei' }));
      const wMap = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'];
      el.textContent =
        `${tw.getFullYear()}/${pad2(tw.getMonth()+1)}/${pad2(tw.getDate())} (${wMap[tw.getDay()]}) `+
        `${pad2(tw.getHours())}:${pad2(tw.getMinutes())}:${pad2(tw.getSeconds())}`;
    }

    fetchNumber(); setInterval(fetchNumber,5000);
    updateTWTime(); setInterval(updateTWTime,1000);

    /* è™Ÿç¢¼è®Šæ›´ Popupï¼ˆLogo ä¸‹æ–¹ï¼‰ */
    function showPopup(msg){
      const container=document.querySelector('.container');
      const logo=document.getElementById('clinicLogo');
      const popup=document.createElement('div');
      popup.className='popup';
      popup.textContent=msg;
      container.appendChild(popup);
      const top = logo.offsetTop + logo.offsetHeight + 8;
      popup.style.top = top + 'px';
      setTimeout(()=>popup.remove(),5000);
    }
  </script>
</body>
</html>
æƒ³å†åŠ ã€ŒæŒ‰ä¸‹ä¸€è™Ÿå°±ç«‹åˆ»æ’­å ±ã€ä¹Ÿè¡Œï¼ŒæŠŠä½ æ§åˆ¶å¾Œå°çš„ã€Œä¸‹ä¸€è™Ÿã€æŒ‰éˆ•äº‹ä»¶è²¼çµ¦æˆ‘ï¼Œæˆ‘ç›´æ¥å¹«ä½ åœ¨é‚£è¡Œå¾Œé¢æ¥ä¸Š speakNumber(æ–°è™Ÿç¢¼);ï¼Œå°±èƒ½åŒæ­¥ç¾å ´æŒ‰éµèˆ‡èªéŸ³ã€‚


è³‡æ–™ä¾†æº
ä½ èªªï¼š
æœ‰è²éŸ³äº†ä½†æ˜¯æœ‰å¹¾å€‹å•é¡Œ
1.è²éŸ³æœƒè¢«æˆªæ–·ï¼Œåƒæ˜¯129è™Ÿï¼Œæœƒè®Šæˆ"29è™Ÿ ç¬¬129è™Ÿè«‹é€²è¨ºé–“"
2.æœ€é–‹å§‹çš„0æœƒå”¸å‡ºä¾†ï¼ŒéŒ¯èª¤ï¼Œæˆ‘è¦çš„æ˜¯"1è™Ÿ"å°±å¿µå‡º"ä¸€è™Ÿã€ä¸€è™Ÿè«‹é€²è¨ºé–“"
"10è™Ÿ""åè™Ÿã€åè™Ÿè«‹é€²è¨ºé–“" "27è™Ÿ""äºŒåä¸ƒè™Ÿã€äºŒåä¸ƒè™Ÿè«‹é€²è¨ºé–“"'77è™Ÿ'"ä¸ƒåä¸ƒè™Ÿã€ä¸ƒåä¸ƒè™Ÿè«‹é€²è¨ºé–“" æˆ‘è¦å¥¹æ˜¯åœ‹èªå¿µæ•¸å­—çš„ç¿’æ…£ä¸æ˜¯ç´”å¿µä¸€å€‹ä¸€å€‹å­—
3.èªé€Ÿæ”¾æ…¢ä¸€é»(é€™å€‹è¦é‚£è£¡èª¿æ•´?)
ChatGPT èªªï¼š

å·²æ€è€ƒ 1m 16s
å¤ªå¥½äº†ï½æˆ‘å¹«ä½ æŠŠä¸‰ä»¶äº‹éƒ½ä¿®å¥½ï¼Œç›´æ¥çµ¦ä½ æ•´ä»½å®Œæ•´ HTMLï¼ˆåœ¨ä½ çš„æ¶æ§‹ä¸ŠåŠ äº†ç´«è‰²è† å›Šã€ŒèªéŸ³å«è™Ÿã€é–‹é—œï¼Œæ”¾åœ¨é–€è¨ºè¡¨åœ–ç‰‡æ­£ä¸‹æ–¹ï¼‰ï¼š

âœ… ä¿®æ­£è¢«æˆªæ–·å•é¡Œï¼šä¸å†åœ¨æ’­æ”¾å‰ç«‹åˆ» resume/cancelï¼Œæ”¹ç‚ºã€Œå–æ¶ˆâ†’çŸ­æš«å»¶é²â†’æ’­æ”¾ã€é¿å…å‰ç¶´è¢«åƒæ‰ã€‚

âœ… æ”¹æˆåœ‹èªç¿’æ…£è®€æ•¸ï¼š1 â†’ ä¸€ã€10 â†’ åã€27 â†’ äºŒåä¸ƒã€77 â†’ ä¸ƒåä¸ƒã€129 â†’ ä¸€ç™¾äºŒåä¹ï¼ˆä¸å†å¿µå‰å° 0ï¼‰ã€‚

âœ… èªé€Ÿæ”¾æ…¢ï¼šé è¨­ TTS_RATE = 0.85ï¼Œä½ å¯ä»¥åœ¨è¨»è§£è™•èª¿æ•´ã€‚

ç›´æ¥æ•´ä»½è¦†è“‹å³å¯ï¼ˆä¿æŒä½ åŸæœ‰ UI/æ¨£å¼ï¼‰ï¼Œè‹¥ä½ æœ‰æ”¹é API URL è¨˜å¾—æ›å›ä½ çš„ GAS é€£çµã€‚

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<title>é™³è¬é¾è¨ºæ‰€çœ‹è¨ºé€²åº¦</title>
<meta name="description" content="å³æ™‚çœ‹è¨ºé€²åº¦èˆ‡é–€è¨ºè³‡è¨Š">
<meta name="theme-color" content="#35579A">

<meta property="og:type" content="website">
<meta property="og:title" content="é™³è¬é¾è¨ºæ‰€ï½œçœ‹è¨ºé€²åº¦">
<meta property="og:description" content="å³æ™‚çœ‹è¨ºé€²åº¦èˆ‡é–€è¨ºè³‡è¨Šã€‚">
<meta property="og:image" content="og-cover.jpg">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:url" content="https://tioar.github.io/Clinic_calling/">
<meta property="og:locale" content="zh_TW">

<link rel="icon" type="image/png" href="icon.png">
<link rel="apple-touch-icon" href="apple-touch-icon.png">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@700;800;900&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">

<style>
  :root{
    --primary:#35579A;
    --purple:#6B5AAE;
    --soft:#A5B8D0;
    --beige:#D8C0AD;
    --accent:#6db337;
    --bg:#F5EFE8;
    --card:#FFFFFF;
    --note:#F2F6FB;
    --digit-red:#DC2626;
    --pill-red:#E53935;
    --pill-coral:#F37163;
  }
  *{ box-sizing:border-box; }
  body{
    font-family:'Noto Sans TC',sans-serif;
    -webkit-font-smoothing:antialiased;
    background:var(--bg);
    margin:0;
    padding:clamp(16px,4vw,40px) max(12px,env(safe-area-inset-left)) clamp(24px,6vw,48px) max(12px,env(safe-area-inset-right));
    display:flex; justify-content:center; color:#1c1c1c;
  }
  .container{
    position:relative;
    width:min(860px,96vw);
    background:var(--card);
    border-radius:36px;
    padding:clamp(16px,4vw,32px);
    text-align:center;
    box-shadow:0 10px 30px rgba(53,87,154,0.10);
    border:3px solid var(--primary);
    overflow:visible;
  }
  .marquee{
    --gap: 2rem; --speed: 45s;
    background:var(--purple); color:#fff;
    border-radius:18px; padding:10px 0; margin:0 auto 10px;
    overflow:hidden; white-space:nowrap; user-select:none; font-size:14px;
  }
  .marquee__track{ display:inline-flex; align-items:center; width:max-content; animation:marquee-loop var(--speed) linear infinite; }
  .marquee__track > span{ padding-right:var(--gap); flex-shrink:0; }
  .marquee:hover .marquee__track{ animation-play-state:paused; }
  @keyframes marquee-loop{ from{transform:translateX(0)} to{transform:translateX(-50%)} }
  .logo-wrap{ margin:10px 0 0; }
  .logo{ height:clamp(120px,22vw,200px); max-width:82vw; object-fit:contain; background:#fff; }
  .pill-wrap{ display:flex; justify-content:center; margin:10px 0 6px; min-height:0; }
  .pill{ display:inline-flex; align-items:center; justify-content:center; padding:10px 18px; border-radius:999px; color:#fff; font-weight:900; box-shadow:0 8px 18px rgba(0,0,0,.12); letter-spacing:.5px; max-width:90%; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; font-size:16px; }
  .pill.red{ background:var(--pill-red); }
  .pill.coral{ background:var(--pill-coral); }
  h1{ margin:12px 0; color:var(--primary); letter-spacing:1px; }
  .now-time{ color:#5f7396; font-weight:700; margin-bottom:18px; }
  .number-display{ display:flex; justify-content:center; gap:clamp(8px,2vw,16px); margin-bottom:16px; }
  .digit-card{
    width:clamp(72px,22vw,110px); height:clamp(92px,28vw,140px);
    background:#fff; color:var(--digit-red); font-family:'Manrope',sans-serif;
    font-variant-numeric:tabular-nums; font-size:clamp(56px,16vw,100px); font-weight:800; line-height:1;
    border-radius:28px; display:flex; align-items:center; justify-content:center;
    position:relative; perspective:400px; overflow:hidden;
    box-shadow:0 10px 24px rgba(53,87,154,.08), inset 0 0 0 3px var(--soft);
  }
  .digit-card .current,.digit-card .next{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; backface-visibility:hidden; }
  .digit-card .next{ transform:rotateX(-180deg); }
  .flip .current{ animation:flipTop .5s forwards; }
  .flip .next{ animation:flipBottom .5s forwards; }
  @keyframes flipTop{0%{transform:rotateX(0)}100%{transform:rotateX(180deg)}}
  @keyframes flipBottom{0%{transform:rotateX(-180deg)}100%{transform:rotateX(0)}}
  .note{ background:var(--note); padding:16px 20px; border-radius:22px; margin:16px auto 12px; box-shadow:0 4px 12px rgba(0,0,0,0.06); color:#274a6b; font-weight:600; width:min(760px,100%); text-align:center; }
  .note p{ margin:.35em 0; }
  .palette{ height:8px; border-radius:6px; margin:8px auto 16px; width:min(560px,90%); background:linear-gradient(to right,var(--beige) 0 22%,var(--accent) 22% 45%,var(--primary) 45% 82%,var(--soft) 82% 100%); }
  .schedule{ margin-top:6px; max-width:100%; border-radius:20px; box-shadow:0 4px 12px rgba(0,0,0,0.06); }
  .popup{ position:absolute; left:50%; transform:translateX(-50%); background:var(--accent); color:#fff; padding:14px 22px; border-radius:999px; font-size:20px; z-index:10; font-weight:800; opacity:0; animation:fadeInOut 3s forwards; box-shadow:0 12px 26px rgba(0,0,0,.15); pointer-events:none; white-space:nowrap; max-width:90%; overflow:hidden; text-overflow:ellipsis; }
  @keyframes fadeInOut{0%{opacity:0; transform:translate(-50%,-6px)}10%{opacity:1; transform:translate(-50%,0)}90%{opacity:1}100%{opacity:0; transform:translate(-50%,-6px)}}
  /* æ–°å¢ï¼šç´«è‰²è† å›Šã€ŒèªéŸ³å«è™Ÿã€é–‹é—œ */
  .voice-row{ display:flex; align-items:center; justify-content:center; gap:12px; margin:14px auto 0; user-select:none; }
  .voice-label{ font-weight:900; color:#4b3e7a; letter-spacing:.5px; }
  .switch{ position:relative; width:64px; height:36px; }
  .switch input{ position:absolute; width:100%; height:100%; opacity:0; margin:0; cursor:pointer; }
  .track{ position:absolute; inset:0; background:#d9d2f1; border-radius:999px; transition:.25s ease; box-shadow:inset 0 0 0 2px rgba(0,0,0,.06); }
  .thumb{ position:absolute; top:3px; left:3px; width:30px; height:30px; border-radius:50%; background:#fff; display:grid; place-items:center; transition:.25s ease; box-shadow:0 4px 12px rgba(0,0,0,.15); font-size:18px; }
  .switch input:checked ~ .track{ background:var(--purple); }
  .switch input:checked ~ .thumb{ left:31px; color:var(--purple); }
</style>
</head>

<body>
  <div class="container">
    <div class="marquee" aria-label="è¨ºæ‰€è¨Šæ¯è·‘é¦¬ç‡ˆ">
      <div class="marquee__track" id="marqueeTrack">
        <span>âœ¦ é™³è¬é¾è¨ºæ‰€é–€è¨ºæ™‚é–“ï¼šâ˜€ï¸ æ—©è¨º 08:30â€“11:30ï¼ˆæœ€æ™šå ±åˆ°10:30ï¼‰ï¼›â˜ï¸ åˆè¨º 14:00â€“17:00ï¼ˆæœ€æ™šå ±åˆ°16:00ï¼‰ï¼›â˜¾ æ™šè¨º 18:00â€“20:30ï¼ˆæœ€æ™šå ±åˆ°20:00ï¼‰ã€‚é€¾æ™‚è¦–åŒæ”¾æ£„ï¼Œåé¡å°‡é‡‹å‡ºçµ¦ç¾å ´æ›è™Ÿã€‚</span>
        <span aria-hidden="true">âœ¦ é™³è¬é¾è¨ºæ‰€é–€è¨ºæ™‚é–“ï¼šâ˜€ï¸ æ—©è¨º 08:30â€“11:30ï¼ˆæœ€æ™šå ±åˆ°10:30ï¼‰ï¼›â˜ï¸ åˆè¨º 14:00â€“17:00ï¼ˆæœ€æ™šå ±åˆ°16:00ï¼‰ï¼›â˜¾ æ™šè¨º 18:00â€“20:30ï¼ˆæœ€æ™šå ±åˆ°20:00ï¼‰ã€‚é€¾æ™‚è¦–åŒæ”¾æ£„ï¼Œåé¡å°‡é‡‹å‡ºçµ¦ç¾å ´æ›è™Ÿã€‚</span>
      </div>
    </div>

    <div class="logo-wrap">
      <img class="logo" id="clinicLogo" src="./logo1.jpg" alt="é™³è¬é¾è¨ºæ‰€ LOGO">
    </div>

    <div class="pill-wrap" aria-live="polite" id="statusPill"></div>

    <h1>ç›®å‰çœ‹è¨ºè™Ÿç¢¼</h1>
    <div class="now-time" id="twTime">â€”</div>

    <div class="number-display" id="numberDisplay">
      <div class="digit-card"><div class="current">0</div><div class="next">0</div></div>
      <div class="digit-card"><div class="current">0</div><div class="next">0</div></div>
      <div class="digit-card"><div class="current">0</div><div class="next">0</div></div>
    </div>

    <div class="note">
      <p>â™¦ï¸ é›²ç«¯è™Ÿç¢¼åƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›å«è™Ÿä»¥ç¾å ´ç‚ºæº–ã€‚æ¯ä½æ‚£è€…ç´„ 3â€“5 åˆ†é˜ï¼Œè«‹æå‰åˆ°å ´åœ¨å¯çœ‹åˆ°ç‡ˆè™Ÿçš„ä½ç½®ç­‰å€™ä»¥å…éè™Ÿã€‚</p>
      <p>â™¦ï¸ è‹¥å·²éè™Ÿè«‹å†æ¬¡å‘æ«ƒæª¯å ±åˆ°ï¼Œå°‡ä¾ç¾å ´ç‹€æ³èª¿æ•´å®‰æ’ã€‚</p>
      <p>â™¦ï¸ é–€è¨ºå¯èƒ½è¦–ç¾å ´ç‹€æ³æå‰åœæ­¢æ›è™Ÿï¼Œå¦‚æœ‰ç–‘å•è«‹ä¾†é›» (03)5152971ã€‚</p>
    </div>

    <div class="palette" aria-hidden="true"></div>
    <img class="schedule" id="scheduleImg" src="./schedule.png" alt="é–€è¨ºæ™‚é–“è¡¨">

    <!-- âœ… æ–°å¢ï¼šç´«è‰²è† å›Šé–‹é—œï¼ˆæ”¾åœ¨é–€è¨ºè¡¨åœ–ç‰‡ä¸‹æ–¹ï¼‰ -->
    <div class="voice-row" aria-live="polite">
      <label class="switch" aria-label="èªéŸ³å«è™Ÿé–‹é—œ">
        <input type="checkbox" id="voiceToggle" />
        <div class="track"></div>
        <div class="thumb">ğŸ”Š</div>
      </label>
      <div class="voice-label">èªéŸ³å«è™Ÿ</div>
    </div>
  </div>

  <script>
    /* è·‘é¦¬ç‡ˆæš«åœ/æ¢å¾© */
    (function(){
      const marquee = document.querySelector('.marquee');
      const track = document.getElementById('marqueeTrack');
      const pause = () => track.style.animationPlayState = 'paused';
      const run   = () => track.style.animationPlayState = 'running';
      marquee.addEventListener('pointerdown', pause);
      marquee.addEventListener('pointerup', run);
      marquee.addEventListener('pointerleave', run);
      marquee.addEventListener('pointercancel', run);
    })();

    /* åœ–ç‰‡å‚™æ´ */
    (function(){
      const logo = document.getElementById('clinicLogo');
      const logoFallbacks = [
        './logo.png',
        'https://raw.githubusercontent.com/tioar/Clinic_calling/main/logo1.jpg',
        'https://raw.githubusercontent.com/tioar/Clinic_calling/main/logo.png'
      ];
      let li=0; logo.onerror = function(){ if(li<logoFallbacks.length){ this.src=logoFallbacks[li++]; } else { this.style.display='none'; } };

      const sch = document.getElementById('scheduleImg');
      const schFallbacks = ['https://raw.githubusercontent.com/tioar/Clinic_calling/main/schedule.png'];
      let si=0; sch.onerror = function(){ if(si<schFallbacks.length){ this.src=schFallbacks[si++]; } else { this.style.display='none'; } };
    })();

    let lastNumber='000';

    /* ==================== èªéŸ³æ’­å ±æ ¸å¿ƒ ==================== */
    // ä½ å¯åœ¨é€™è£¡è‡ªè¨‚èªé€Ÿï¼ˆ0.1~10ï¼Œé è¨­ 0.85 æ¯”è¼ƒæ…¢ï¼‰
    const TTS_RATE = 0.85;

    const Voice = { ready:false, unlocked:false, voices:[], zhVoice:null, enabled:false, timer:null };

    function loadVoices(){
      const list = window.speechSynthesis?.getVoices?.() || [];
      Voice.voices = list;
      Voice.zhVoice =
        list.find(v => v.lang?.toLowerCase().startsWith('zh-tw')) ||
        list.find(v => v.lang?.toLowerCase().startsWith('zh-hk')) ||
        list.find(v => v.lang?.toLowerCase().startsWith('zh-cn')) ||
        list.find(v => v.lang?.toLowerCase().startsWith('zh'));
    }

    function unlockTTS(){
      if(!('speechSynthesis' in window)){
        alert('æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³æ’­å ±ï¼Œè«‹æ”¹ç”¨ Chrome / Safari / Edgeã€‚');
        return false;
      }
      loadVoices();
      if(typeof speechSynthesis.onvoiceschanged !== 'undefined'){
        speechSynthesis.onvoiceschanged = () => loadVoices();
      }
      try{ speechSynthesis.resume(); }catch(e){}
      Voice.unlocked = true; Voice.ready = true;
      return true;
    }

    // é¿å…ã€Œé–‹é ­è¢«åƒæ‰ã€ï¼šå–æ¶ˆâ†’çŸ­æš«å»¶é²â†’å† speak
    function speakText(txt){
      if(!Voice.enabled || !Voice.ready || !txt) return;

      // æ¸…æ‰å¯èƒ½çš„é‡å…¥è¨ˆæ™‚å™¨
      if (Voice.timer){ clearTimeout(Voice.timer); Voice.timer = null; }

      if (speechSynthesis.speaking || speechSynthesis.pending){
        speechSynthesis.cancel();
        Voice.timer = setTimeout(()=> doSpeak(txt), 180); // å»¶é²ä¸€é»é»å†æ’­
      } else {
        Voice.timer = setTimeout(()=> doSpeak(txt), 80);  // å°æš–æ©Ÿï¼Œé¿å…è¢«åƒé ­
      }
    }

    function doSpeak(txt){
      const u = new SpeechSynthesisUtterance(txt);
      if(!Voice.zhVoice || !Voice.voices.length) loadVoices();
      if(Voice.zhVoice) u.voice = Voice.zhVoice;
      u.lang = (Voice.zhVoice && Voice.zhVoice.lang) || 'zh-TW';
      u.rate = TTS_RATE;  // â† èªé€Ÿåœ¨é€™è£¡èª¿æ•´
      u.pitch = 1;
      u.volume = 1;
      speechSynthesis.speak(u);
    }

    // é˜¿æ‹‰ä¼¯æ•¸å­— â†’ åœ‹èªå¸¸ç”¨è®€æ³•ï¼ˆ0~999ï¼‰
    function zhRead(n){
      n = Math.max(0, Math.min(999, Math.floor(n)));
      const d = ['é›¶','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','ä¸ƒ','å…«','ä¹'];
      if (n === 0) return 'é›¶';

      let out = '';
      const h = Math.floor(n / 100);
      const t = Math.floor((n % 100) / 10);
      const u = n % 10;

      if (h > 0){
        out += d[h] + 'ç™¾';
        if (t === 0 && u > 0) out += 'é›¶';
      }
      if (t > 0){
        if (t === 1 && h === 0) out += 'å';
        else out += d[t] + 'å';
      }
      if (u > 0){
        out += d[u];
      }
      return out;
    }

    // å«è™Ÿï¼ˆä¸€æ¬¡ç™¼è©±è£¡é¢ã€Œé‡è¤‡å…©æ¬¡ã€ï¼‰
    function speakNumber(n){
      const zh = zhRead(n);                // e.g. 129 â†’ ä¸€ç™¾äºŒåä¹
      const phrase = `ç¬¬${zh}è™Ÿã€ç¬¬${zh}è™Ÿè«‹é€²è¨ºé–“ï½`;
      speakText(phrase);
    }

    // é–‹é—œäº‹ä»¶
    const voiceToggle = document.getElementById('voiceToggle');
    voiceToggle.addEventListener('change', ()=>{
      if(voiceToggle.checked){
        if(!Voice.unlocked && !unlockTTS()){ voiceToggle.checked = false; return; }
        Voice.enabled = true;
        speakText('èªéŸ³å«è™Ÿå·²é–‹å•Ÿ');
      }else{
        Voice.enabled = false;
        speechSynthesis.cancel();
      }
    });

    // é¦–æ¬¡è§¸æ§è‡ªå‹•è§£é–ï¼ˆè¡Œå‹•è£ç½®å‹å–„ï¼‰
    window.addEventListener('touchend', function once(){
      if(!Voice.unlocked){ unlockTTS(); }
      window.removeEventListener('touchend', once, true);
    }, true);

    document.addEventListener('visibilitychange', ()=>{
      if(document.visibilityState === 'visible'){
        try{ speechSynthesis.resume(); }catch(e){}
      }
    });
    /* ================= èªéŸ³æ’­å ±æ ¸å¿ƒï¼šçµæŸ ================= */

    /* å«è™Ÿï¼‹æ——æ¨™å‘ˆç¾ */
    async function fetchNumber(){
      try{
        // TODOï¼šæ›æˆä½ çš„ GAS åªè®€ URL
        const res = await fetch("https://script.google.com/macros/s/AKfycbxCxob5Ec0N7DqaT8ezOoNHgXjO9vOJ7ooEDUYiTnbKxXX4i9fFxuf-Dqs4PYMpmQJU/exec", { cache:'no-store' });
        const data = await res.json();

        renderStatusPill(data);

        const n = Number(data.number);
        if (!Number.isFinite(n) || n < 0 || n >= 1000) return; // é˜²å‘†

        const current = String(n).padStart(3,'0');
        if(current !== lastNumber){
          animateNumber(current);
          showPopup(`è«‹ ${current} è™Ÿå°±è¨º`);
          // ğŸ”Š åƒ…åœ¨è®Šæ›´æ™‚æ’­å ±ï¼ˆä¸å¿µå‰å° 0ï¼‰
          speakNumber(n);
          lastNumber = current;
        }
      }catch(err){ console.error('æŠ“è™Ÿç¢¼å¤±æ•—', err); }
    }

    function renderStatusPill(data){
      const box = document.getElementById('statusPill');
      box.innerHTML = '';
      if (data.holiday === true){
        const el = document.createElement('div');
        el.className = 'pill red';
        el.textContent = 'ç¾åœ¨æ™‚é–“æ²’æœ‰é–€è¨ºï¼Œä¼‘è¨ºä¸­';
        box.appendChild(el);
      } else if (data.closed === true){
        const el = document.createElement('div');
        el.className = 'pill coral';
        el.textContent = 'ç•¶å‰æ™‚æ®µé–€è¨ºå·²ç¶“åœæ­¢æ›è™Ÿ';
        box.appendChild(el);
      }
    }

    const pad2 = n => String(n).padStart(2,'0');

    function animateNumber(newNumber){
      const digits=document.querySelectorAll('#numberDisplay .digit-card');
      newNumber.split('').forEach((d,i)=>{
        const card=digits[i];
        const cur=card.querySelector('.current');
        const nxt=card.querySelector('.next');
        if(cur.innerText!==d){
          nxt.innerText=d;
          card.classList.add('flip');
          setTimeout(()=>{ cur.innerText=d; card.classList.remove('flip'); },500);
        }
      });
    }

    function updateTWTime(){
      const el=document.getElementById('twTime');
      const now = new Date();
      const tw = new Date(now.toLocaleString('en-US', { timeZone:'Asia/Taipei' }));
      const wMap = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'];
      el.textContent =
        `${tw.getFullYear()}/${pad2(tw.getMonth()+1)}/${pad2(tw.getDate())} (${wMap[tw.getDay()]}) `+
        `${pad2(tw.getHours())}:${pad2(tw.getMinutes())}:${pad2(tw.getSeconds())}`;
    }

    fetchNumber(); setInterval(fetchNumber,5000);
    updateTWTime(); setInterval(updateTWTime,1000);

    function showPopup(msg){
      const container=document.querySelector('.container');
      const logo=document.getElementById('clinicLogo');
      const popup=document.createElement('div');
      popup.className='popup';
      popup.textContent=msg;
      container.appendChild(popup);
      const top = logo.offsetTop + logo.offsetHeight + 8;
      popup.style.top = top + 'px';
      setTimeout(()=>popup.remove(),5000);
    }
  </script>
</body>
</html>
å°æé†’ï¼š

æƒ³å†æ…¢ä¸€é»å°±æŠŠ TTS_RATE å¾€ä¸‹èª¿ï¼ˆä¾‹å¦‚ 0.75ï¼‰ï¼›æƒ³å¿«ä¸€é»å°±èª¿é«˜ï¼ˆä¾‹å¦‚ 1.0ï¼‰ã€‚

å¦‚æœä½ åœ¨å¾Œå°æœ‰ã€Œä¸‹ä¸€è™Ÿã€æŒ‰éˆ•ï¼Œæƒ³è¦æŒ‰ä¸‹å°±é¦¬ä¸Šæ’­å ±ï¼Œåªè¦åœ¨æŒ‰éˆ•çš„äº‹ä»¶è£¡åŠ ï¼šspeakNumber(æ–°è™Ÿç¢¼);ï¼Œæˆ‘ä¹Ÿå¯ä»¥å¹«ä½ æ¥ä¸Šã€‚

ä½ èªªï¼š
æˆ‘åªè¦åœ¨è™Ÿç¢¼æ”¹è®Šæ™‚å¿µå¹¾è™Ÿè«‹é€²è¨ºé–“ï¼Œä¸ç”¨å¿µå¹¾è™Ÿè«‹å°±è¨ºå–”
          showPopup(è«‹ ${current} è™Ÿå°±è¨º);
          // ğŸ”Š åƒ…åœ¨è®Šæ›´æ™‚æ’­å ±ï¼ˆä¸å¿µå‰å° 0ï¼‰
ChatGPT èªªï¼š
äº†è§£ ğŸ‘
ä½ è¦æŠŠç•«é¢ä¸Šçš„ å½ˆå‡ºæç¤º (showPopup) ä¿ç•™ï¼Œå–®ç´”èªéŸ³æ’­å ±æ™‚åªå¿µã€Œç¬¬XXè™Ÿï¼Œè«‹é€²è¨ºé–“ï½ã€ï¼Œä¸è¦é‡è¤‡ã€Œè«‹å°±è¨ºã€ã€‚

ä¿®æ”¹æ–¹æ³•å¾ˆç°¡å–®ï¼šåœ¨ speakNumber(n) é€™è£¡æ›æ‰ç™¼è©±å…§å®¹å³å¯ã€‚ä¸‹é¢æ˜¯ç²¾ç°¡å¾Œçš„ä¿®æ­£ç‰ˆï¼ˆæˆ‘åªæ”¹å‹•äº†èªéŸ³æ’­å ±çš„éƒ¨åˆ†ï¼Œå…¶ä»–é¡¯ç¤º showPopup é‚„æ˜¯ç…§èˆŠï¼‰ï¼š

// å«è™Ÿï¼ˆä¸€æ¬¡ç™¼è©±è£¡é¢ã€Œé‡è¤‡å…©æ¬¡ã€ï¼‰
function speakNumber(n){
  const zh = zhRead(n);                // e.g. 129 â†’ ä¸€ç™¾äºŒåä¹
  // âœ… åªå¿µã€Œè«‹é€²è¨ºé–“ã€ï¼Œä¸æœƒå¿µã€Œè«‹å°±è¨ºã€
  const phrase = `ç¬¬${zh}è™Ÿã€ç¬¬${zh}è™Ÿè«‹é€²è¨ºé–“ï½`;
  speakText(phrase);
}
é€™æ¨£æ•ˆæœæœƒæ˜¯ï¼š

æ•¸å­— 1 â†’ èªéŸ³æ’­å ±ï¼šã€Œç¬¬ä¸€è™Ÿã€ç¬¬ä¸€è™Ÿè«‹é€²è¨ºé–“ï½ã€

æ•¸å­— 10 â†’ èªéŸ³æ’­å ±ï¼šã€Œç¬¬åè™Ÿã€ç¬¬åè™Ÿè«‹é€²è¨ºé–“ï½ã€

æ•¸å­— 27 â†’ èªéŸ³æ’­å ±ï¼šã€Œç¬¬äºŒåä¸ƒè™Ÿã€ç¬¬äºŒåä¸ƒè™Ÿè«‹é€²è¨ºé–“ï½ã€

æ•¸å­— 77 â†’ èªéŸ³æ’­å ±ï¼šã€Œç¬¬ä¸ƒåä¸ƒè™Ÿã€ç¬¬ä¸ƒåä¸ƒè™Ÿè«‹é€²è¨ºé–“ï½ã€

æ•¸å­— 129 â†’ èªéŸ³æ’­å ±ï¼šã€Œç¬¬ä¸€ç™¾äºŒåä¹è™Ÿã€ç¬¬ä¸€ç™¾äºŒåä¹è™Ÿè«‹é€²è¨ºé–“ï½ã€

å¦‚æœè¦åŒæ™‚èª¿æ•´èªé€Ÿï¼Œåœ¨åŒæª”æ¡ˆè£¡æ‰¾åˆ°ï¼š

const TTS_RATE = 0.85;
æŠŠ 0.85 æ”¹æˆä½ è¦çš„å€¼ï¼ˆä¾‹å¦‚ 0.75 æ›´æ…¢ï¼Œ1.0 æ­£å¸¸ï¼Œ1.2 ç¨å¿«ï¼‰ã€‚

è¦ä¸è¦æˆ‘å¹«ä½ æŠŠå®Œæ•´ HTML å†æ•´ç†ä¸€æ¬¡ï¼ŒæŠŠé€™äº›ä¿®æ”¹å¥½çš„ speakNumber() å’Œ TTS_RATE ä¸€èµ·æ”¾é€²å»ï¼Ÿ

ä½ èªªï¼š
é‚„æ˜¯å‰é¢å­—è¢«åƒæ‰è€¶
93è™Ÿ>>"ä¸‰è™Ÿã€ä¹åä¸‰è™Ÿè«‹é€²è¨ºé–“"
105è™Ÿ>>"äº”è™Ÿã€ä¸€ç™¾é›¶äº”è™Ÿè«‹é€²è¨ºé–“"
é€™å€‹æ€éº¼è¾¦
ChatGPT èªªï¼š

å·²æ€è€ƒ 1m 7s
ä½ ç¢°åˆ°çš„æ˜¯ Web Speech åœ¨æŸäº›ç€è¦½å™¨ï¼ˆç‰¹åˆ¥æ˜¯ iOS/Safariï¼‰é–‹é ­å®¹æ˜“è¢«åƒæ‰çš„è€æ¯›ç—…ã€‚è§£æ³•æ˜¯åšä¸€å€‹å‰ç½®ã€Œæš–æ©Ÿã€ç™¼è©±ï¼ˆå¹¾ä¹è½ä¸åˆ°ï¼‰ï¼Œç­‰å®ƒ onend ä¹‹å¾Œå†æ’­çœŸæ­£çš„å¥å­ã€‚é€™æ¨£å°±ä¸æœƒå‡ºç¾ã€Œ93â†’ä¸‰è™Ÿã€105â†’äº”è™Ÿã€çš„æˆªæ–·äº†ã€‚

ä¸‹é¢çµ¦ä½ ã€Œåªè¦æ›å‡½å¼å°±å¥½ã€çš„è²¼ä¸Šç‰ˆï¼šæŠŠä½ æª”æ¡ˆå…§çš„ speakText() å’Œ doSpeak()ï¼ˆæˆ– reallySpeak()ï¼‰æ•´æ®µæ›¿æ›æˆé€™ä¸€æ®µå³å¯ï¼Œå…¶ä»–ç¨‹å¼ç¢¼éƒ½ä¸ç”¨å‹•ã€‚

// ========== å–ä»£ä½ åŸæœ¬çš„ speakText / doSpeak å…©å€‹å‡½å¼ ==========

// èªéŸ³ä¸»å…¥å£ï¼šåŠ ä¸Šã€Œæš–æ©Ÿ utteranceã€é¿å…é–‹é ­è¢«åƒæ‰
function speakText(txt){
  if(!Voice.enabled || !Voice.ready || !txt) return;

  // æ¸…æ‰å¯èƒ½æ®˜ç•™çš„è¨ˆæ™‚å™¨
  if (Voice.timer){ clearTimeout(Voice.timer); Voice.timer = null; }

  const play = () => {
    // 1) æš–æ©Ÿï¼šç”¨ä¸€å€‹ã€Œä¸æœ—è®€ã€çš„å­—å…ƒåšçŸ­ä¿ƒ utteranceï¼Œè®“å¼•æ“é†’ä¾†
    //    \u00A0 = NBSPï¼ˆä¸æ›è¡Œç©ºç™½ï¼‰ï¼Œå¤§å¤šæ•¸å¼•æ“ä¸æœƒå¿µå‡ºè²ï¼Œåªæœƒæ¥µçŸ­æš« onend
    const warm = new SpeechSynthesisUtterance('\u00A0');
    warm.lang = (Voice.zhVoice && Voice.zhVoice.lang) || 'zh-TW';
    warm.rate = TTS_RATE;
    warm.pitch = 1;
    warm.volume = 0; // æœ‰äº›ç€è¦½å™¨ä¸ç†æœƒ volumeï¼Œä½†é€šå¸¸ä¹Ÿä¸æœƒç™¼è²

    // ä¿éšªï¼šè‹¥æŸäº›è£ç½® onend æ²’å›ä¾†ï¼Œ0.75 ç§’å¾Œä»å¼·åˆ¶æ’­çœŸæ­£çš„å¥å­
    const safety = setTimeout(() => {
      try{ speechSynthesis.cancel(); }catch(e){}
      reallySpeak(txt);
    }, 750);

    warm.onend = () => {
      clearTimeout(safety);
      // æš–æ©ŸçµæŸå¾Œç¨ç­‰ä¸€ä¸‹å†æ’­çœŸæ­£å¥å­ï¼Œé¿å…é»åœ¨ä¸€èµ·
      setTimeout(() => reallySpeak(txt), 60);
    };

    try{ speechSynthesis.resume(); }catch(e){}
    speechSynthesis.speak(warm);
  };

  // è‹¥æ­¤æ™‚é‚„åœ¨è¬›è©±æˆ–ä½‡åˆ—ä¸­ï¼Œå…ˆå–æ¶ˆ â†’ ç¨ç­‰ â†’ å†åšæš–æ©Ÿ
  if (speechSynthesis.speaking || speechSynthesis.pending) {
    try{ speechSynthesis.cancel(); }catch(e){}
    Voice.timer = setTimeout(play, 220);
  } else {
    Voice.timer = setTimeout(play, 100);
  }
}

// å¯¦éš›æ’­å ±ï¼ˆä¸è¦æ”¾ä»»ä½•å‰ç¶´æ¨™é»ï¼Œä»¥å…è¢«è½è¦‹ï¼‰
function reallySpeak(txt){
  const u = new SpeechSynthesisUtterance(txt);
  if(!Voice.zhVoice || !Voice.voices.length) loadVoices();
  if(Voice.zhVoice) u.voice = Voice.zhVoice;
  u.lang = (Voice.zhVoice && Voice.zhVoice.lang) || 'zh-TW';
  u.rate = TTS_RATE;  // â† èªé€Ÿåœ¨é€™è£¡ï¼Œæƒ³æ›´æ…¢å°±æ”¹æˆ 0.75 / 0.7
  u.pitch = 1;
  u.volume = 1;
  u.onstart = ()=>{ try{ speechSynthesis.resume(); }catch(e){} };
  speechSynthesis.speak(u);
}
ä½ ä¹‹å‰çš„ã€Œåœ‹èªç¿’æ…£è®€æ•¸ã€å‡½å¼ zhRead() å¯ä»¥ç…§èˆŠç”¨ï¼ŒspeakNumber(n) ä¹Ÿä¿æŒé€™å¥å°±å¥½ï¼ˆä¸æœƒå¿µã€Œè«‹å°±è¨ºã€ï¼‰ï¼š

function speakNumber(n){
  const zh = zhRead(n);  // 1â†’ä¸€ã€10â†’åã€27â†’äºŒåä¸ƒã€105â†’ä¸€ç™¾é›¶äº”
  const phrase = `ç¬¬${zh}è™Ÿã€ç¬¬${zh}è™Ÿè«‹é€²è¨ºé–“ï½`;
  speakText(phrase);
}
è£œå……
èªé€Ÿï¼šä½ æª”æ¡ˆä¸Šæ–¹æœ‰ const TTS_RATE = 0.85;
æƒ³æ›´æ…¢ â†’ 0.75 æˆ– 0.7ï¼›æƒ³æ­£å¸¸ â†’ 1.0ã€‚

é€™å€‹åšæ³•åœ¨ iOS/Safariã€Chromeã€Edge éƒ½èƒ½æœ‰æ•ˆé¿å…é–‹é ­è¢«åƒã€‚

è‹¥ç¾å ´ã€Œé€£çºŒå¿«é€Ÿè·³è™Ÿã€ï¼Œä½ å·²ç¶“æœ‰ cancel() æ©Ÿåˆ¶ï¼Œä¸æœƒå †ç–Šé‡ç–Šã€‚

è²¼ä¸Šé€™æ®µå¾Œå†è©¦ä¸€æ¬¡ 93ã€105ã€129 æ‡‰è©²å°±æœƒè®Šæˆï¼š

93 â†’ã€Œç¬¬ä¹åä¸‰è™Ÿã€ ç¬¬ä¹åä¸‰è™Ÿè«‹é€²è¨ºé–“ï½ã€

105 â†’ã€Œç¬¬ä¸€ç™¾é›¶äº”è™Ÿã€ ç¬¬ä¸€ç™¾é›¶äº”è™Ÿè«‹é€²è¨ºé–“ï½ã€

129 â†’ã€Œç¬¬ä¸€ç™¾äºŒåä¹è™Ÿã€ ç¬¬ä¸€ç™¾äºŒåä¹è™Ÿè«‹é€²è¨ºé–“ï½ã€

å¦‚æœé‚„æœ‰ä»»ä½•æ©Ÿå‹ä¸Šé–‹é ­è¢«åƒï¼Œæˆ‘å€‘å¯ä»¥æŠŠæš–æ©Ÿå­—å…ƒå¾ \u00A0 æ”¹æˆå…¨å½¢ç©ºç™½ \u3000 æˆ–æ˜¯ã€ŒçŸ­æš«å…©æ®µå¼ã€å†æ‹‰é•· 80â†’120msï¼›ä½ è·Ÿæˆ‘èªªä¸€ä¸‹ä½ é‚£å°æ©Ÿå™¨çš„ç€è¦½å™¨å‹è™Ÿå³å¯ï¼Œæˆ‘å¹«ä½ å¾®èª¿åƒæ•¸ã€‚

ä½ èªªï¼š
å¹«æˆ‘å…¨éƒ¨æ”¹å†å®Œæ•´è²¼ä¸Š ç„¶å¾Œæˆ‘è¦ä¸€å€‹é‡è¤‡æ’­æ”¾ä¸€æ¬¡èªéŸ³çš„åœ“å½¢æŒ‰éˆ•åœ¨"ç›®å‰çœ‹è¨ºè™Ÿç¢¼"æ¨™é¡Œæ—é‚Šï¼Œè¦ä¸€å€‹ç´«è‰²åœ“å½¢æŒ‰éˆ•ä¸Šé¢æ˜¯å–‡å­åœ–æ¡ˆæŒ‰ä¸€ä¸‹å°±æœƒåœ¨æ’­æ”¾ä¸€æ¬¡
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<title>é™³è¬é¾è¨ºæ‰€çœ‹è¨ºé€²åº¦</title>
<meta name="description" content="å³æ™‚çœ‹è¨ºé€²åº¦èˆ‡é–€è¨ºè³‡è¨Š">
<meta name="theme-color" content="#35579A">

<meta property="og:type" content="website">
<meta property="og:title" content="é™³è¬é¾è¨ºæ‰€ï½œçœ‹è¨ºé€²åº¦">
<meta property="og:description" content="å³æ™‚çœ‹è¨ºé€²åº¦èˆ‡é–€è¨ºè³‡è¨Šã€‚">
<meta property="og:image" content="og-cover.jpg">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:url" content="https://tioar.github.io/Clinic_calling/">
<meta property="og:locale" content="zh_TW">

<link rel="icon" type="image/png" href="icon.png">
<link rel="apple-touch-icon" href="apple-touch-icon.png">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@700;800;900&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">

<style>
  :root{
    --primary:#35579A;
    --purple:#6B5AAE;
    --soft:#A5B8D0;
    --beige:#D8C0AD;
    --accent:#6db337;
    --bg:#F5EFE8;
    --card:#FFFFFF;
    --note:#F2F6FB;
    --digit-red:#DC2626;
    --pill-red:#E53935;
    --pill-coral:#F37163;
  }
  *{ box-sizing:border-box; }
  body{
    font-family:'Noto Sans TC',sans-serif;
    -webkit-font-smoothing:antialiased;
    background:var(--bg);
    margin:0;
    padding:clamp(16px,4vw,40px) max(12px,env(safe-area-inset-left)) clamp(24px,6vw,48px) max(12px,env(safe-area-inset-right));
    display:flex; justify-content:center; color:#1c1c1c;
  }
  .container{
    position:relative;
    width:min(860px,96vw);
    background:var(--card);
    border-radius:36px;
    padding:clamp(16px,4vw,32px);
    text-align:center;
    box-shadow:0 10px 30px rgba(53,87,154,0.10);
    border:3px solid var(--primary);
    overflow:visible;
  }
  .marquee{
    --gap: 2rem; --speed: 45s;
    background:var(--purple); color:#fff;
    border-radius:18px; padding:10px 0; margin:0 auto 10px;
    overflow:hidden; white-space:nowrap; user-select:none; font-size:14px;
  }
  .marquee__track{ display:inline-flex; align-items:center; width:max-content; animation:marquee-loop var(--speed) linear infinite; }
  .marquee__track > span{ padding-right:var(--gap); flex-shrink:0; }
  .marquee:hover .marquee__track{ animation-play-state:paused; }
  @keyframes marquee-loop{ from{transform:translateX(0)} to{transform:translateX(-50%)} }
  .logo-wrap{ margin:10px 0 0; }
  .logo{ height:clamp(120px,22vw,200px); max-width:82vw; object-fit:contain; background:#fff; }
  .pill-wrap{ display:flex; justify-content:center; margin:10px 0 6px; min-height:0; }
  .pill{ display:inline-flex; align-items:center; justify-content:center; padding:10px 18px; border-radius:999px; color:#fff; font-weight:900; box-shadow:0 8px 18px rgba(0,0,0,.12); letter-spacing:.5px; max-width:90%; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; font-size:16px; }
  .pill.red{ background:var(--pill-red); }
  .pill.coral{ background:var(--pill-coral); }
  h1{ margin:12px 0; color:var(--primary); letter-spacing:1px; }
  .now-time{ color:#5f7396; font-weight:700; margin-bottom:18px; }
  .number-display{ display:flex; justify-content:center; gap:clamp(8px,2vw,16px); margin-bottom:16px; }
  .digit-card{
    width:clamp(72px,22vw,110px); height:clamp(92px,28vw,140px);
    background:#fff; color:var(--digit-red); font-family:'Manrope',sans-serif;
    font-variant-numeric:tabular-nums; font-size:clamp(56px,16vw,100px); font-weight:800; line-height:1;
    border-radius:28px; display:flex; align-items:center; justify-content:center;
    position:relative; perspective:400px; overflow:hidden;
    box-shadow:0 10px 24px rgba(53,87,154,.08), inset 0 0 0 3px var(--soft);
  }
  .digit-card .current,.digit-card .next{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; backface-visibility:hidden; }
  .digit-card .next{ transform:rotateX(-180deg); }
  .flip .current{ animation:flipTop .5s forwards; }
  .flip .next{ animation:flipBottom .5s forwards; }
  @keyframes flipTop{0%{transform:rotateX(0)}100%{transform:rotateX(180deg)}}
  @keyframes flipBottom{0%{transform:rotateX(-180deg)}100%{transform:rotateX(0)}}
  .note{ background:var(--note); padding:16px 20px; border-radius:22px; margin:16px auto 12px; box-shadow:0 4px 12px rgba(0,0,0,0.06); color:#274a6b; font-weight:600; width:min(760px,100%); text-align:center; }
  .note p{ margin:.35em 0; }
  .palette{ height:8px; border-radius:6px; margin:8px auto 16px; width:min(560px,90%); background:linear-gradient(to right,var(--beige) 0 22%,var(--accent) 22% 45%,var(--primary) 45% 82%,var(--soft) 82% 100%); }
  .schedule{ margin-top:6px; max-width:100%; border-radius:20px; box-shadow:0 4px 12px rgba(0,0,0,0.06); }
  .popup{ position:absolute; left:50%; transform:translateX(-50%); background:var(--accent); color:#fff; padding:14px 22px; border-radius:999px; font-size:20px; z-index:10; font-weight:800; opacity:0; animation:fadeInOut 3s forwards; box-shadow:0 12px 26px rgba(0,0,0,.15); pointer-events:none; white-space:nowrap; max-width:90%; overflow:hidden; text-overflow:ellipsis; }
  @keyframes fadeInOut{0%{opacity:0; transform:translate(-50%,-6px)}10%{opacity:1; transform:translate(-50%,0)}90%{opacity:1}100%{opacity:0; transform:translate(-50%,-6px)}}
  /* æ–°å¢ï¼šç´«è‰²è† å›Šã€ŒèªéŸ³å«è™Ÿã€é–‹é—œ */
  .voice-row{ display:flex; align-items:center; justify-content:center; gap:12px; margin:14px auto 0; user-select:none; }
  .voice-label{ font-weight:900; color:#4b3e7a; letter-spacing:.5px; }
  .switch{ position:relative; width:64px; height:36px; }
  .switch input{ position:absolute; width:100%; height:100%; opacity:0; margin:0; cursor:pointer; }
  .track{ position:absolute; inset:0; background:#d9d2f1; border-radius:999px; transition:.25s ease; box-shadow:inset 0 0 0 2px rgba(0,0,0,.06); }
  .thumb{ position:absolute; top:3px; left:3px; width:30px; height:30px; border-radius:50%; background:#fff; display:grid; place-items:center; transition:.25s ease; box-shadow:0 4px 12px rgba(0,0,0,.15); font-size:18px; }
  .switch input:checked ~ .track{ background:var(--purple); }
  .switch input:checked ~ .thumb{ left:31px; color:var(--purple); }
</style>
</head>

<body>
  <div class="container">
    <div class="marquee" aria-label="è¨ºæ‰€è¨Šæ¯è·‘é¦¬ç‡ˆ">
      <div class="marquee__track" id="marqueeTrack">
        <span>âœ¦ é™³è¬é¾è¨ºæ‰€é–€è¨ºæ™‚é–“ï¼šâ˜€ï¸ æ—©è¨º 08:30â€“11:30ï¼ˆæœ€æ™šå ±åˆ°10:30ï¼‰ï¼›â˜ï¸ åˆè¨º 14:00â€“17:00ï¼ˆæœ€æ™šå ±åˆ°16:00ï¼‰ï¼›â˜¾ æ™šè¨º 18:00â€“20:30ï¼ˆæœ€æ™šå ±åˆ°20:00ï¼‰ã€‚é€¾æ™‚è¦–åŒæ”¾æ£„ï¼Œåé¡å°‡é‡‹å‡ºçµ¦ç¾å ´æ›è™Ÿã€‚</span>
        <span aria-hidden="true">âœ¦ é™³è¬é¾è¨ºæ‰€é–€è¨ºæ™‚é–“ï¼šâ˜€ï¸ æ—©è¨º 08:30â€“11:30ï¼ˆæœ€æ™šå ±åˆ°10:30ï¼‰ï¼›â˜ï¸ åˆè¨º 14:00â€“17:00ï¼ˆæœ€æ™šå ±åˆ°16:00ï¼‰ï¼›â˜¾ æ™šè¨º 18:00â€“20:30ï¼ˆæœ€æ™šå ±åˆ°20:00ï¼‰ã€‚é€¾æ™‚è¦–åŒæ”¾æ£„ï¼Œåé¡å°‡é‡‹å‡ºçµ¦ç¾å ´æ›è™Ÿã€‚</span>
      </div>
    </div>

    <div class="logo-wrap">
      <img class="logo" id="clinicLogo" src="./logo1.jpg" alt="é™³è¬é¾è¨ºæ‰€ LOGO">
    </div>

    <div class="pill-wrap" aria-live="polite" id="statusPill"></div>

    <h1>ç›®å‰çœ‹è¨ºè™Ÿç¢¼</h1>
    <div class="now-time" id="twTime">â€”</div>

    <div class="number-display" id="numberDisplay">
      <div class="digit-card"><div class="current">0</div><div class="next">0</div></div>
      <div class="digit-card"><div class="current">0</div><div class="next">0</div></div>
      <div class="digit-card"><div class="current">0</div><div class="next">0</div></div>
    </div>

    <div class="note">
      <p>â™¦ï¸ é›²ç«¯è™Ÿç¢¼åƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›å«è™Ÿä»¥ç¾å ´ç‚ºæº–ã€‚æ¯ä½æ‚£è€…ç´„ 3â€“5 åˆ†é˜ï¼Œè«‹æå‰åˆ°å ´åœ¨å¯çœ‹åˆ°ç‡ˆè™Ÿçš„ä½ç½®ç­‰å€™ä»¥å…éè™Ÿã€‚</p>
      <p>â™¦ï¸ è‹¥å·²éè™Ÿè«‹å†æ¬¡å‘æ«ƒæª¯å ±åˆ°ï¼Œå°‡ä¾ç¾å ´ç‹€æ³èª¿æ•´å®‰æ’ã€‚</p>
      <p>â™¦ï¸ é–€è¨ºå¯èƒ½è¦–ç¾å ´ç‹€æ³æå‰åœæ­¢æ›è™Ÿï¼Œå¦‚æœ‰ç–‘å•è«‹ä¾†é›» (03)5152971ã€‚</p>
    </div>

    <div class="palette" aria-hidden="true"></div>
    <img class="schedule" id="scheduleImg" src="./schedule.png" alt="é–€è¨ºæ™‚é–“è¡¨">

    <!-- âœ… æ–°å¢ï¼šç´«è‰²è† å›Šé–‹é—œï¼ˆæ”¾åœ¨é–€è¨ºè¡¨åœ–ç‰‡ä¸‹æ–¹ï¼‰ -->
    <div class="voice-row" aria-live="polite">
      <label class="switch" aria-label="èªéŸ³å«è™Ÿé–‹é—œ">
        <input type="checkbox" id="voiceToggle" />
        <div class="track"></div>
        <div class="thumb">ğŸ”Š</div>
      </label>
      <div class="voice-label">èªéŸ³å«è™Ÿ</div>
    </div>
  </div>

  <script>
    /* è·‘é¦¬ç‡ˆæš«åœ/æ¢å¾© */
    (function(){
      const marquee = document.querySelector('.marquee');
      const track = document.getElementById('marqueeTrack');
      const pause = () => track.style.animationPlayState = 'paused';
      const run   = () => track.style.animationPlayState = 'running';
      marquee.addEventListener('pointerdown', pause);
      marquee.addEventListener('pointerup', run);
      marquee.addEventListener('pointerleave', run);
      marquee.addEventListener('pointercancel', run);
    })();

    /* åœ–ç‰‡å‚™æ´ */
    (function(){
      const logo = document.getElementById('clinicLogo');
      const logoFallbacks = [
        './logo.png',
        'https://raw.githubusercontent.com/tioar/Clinic_calling/main/logo1.jpg',
        'https://raw.githubusercontent.com/tioar/Clinic_calling/main/logo.png'
      ];
      let li=0; logo.onerror = function(){ if(li<logoFallbacks.length){ this.src=logoFallbacks[li++]; } else { this.style.display='none'; } };

      const sch = document.getElementById('scheduleImg');
      const schFallbacks = ['https://raw.githubusercontent.com/tioar/Clinic_calling/main/schedule.png'];
      let si=0; sch.onerror = function(){ if(si<schFallbacks.length){ this.src=schFallbacks[si++]; } else { this.style.display='none'; } };
    })();

    let lastNumber='000';

    /* ==================== èªéŸ³æ’­å ±æ ¸å¿ƒ ==================== */
    // ä½ å¯åœ¨é€™è£¡è‡ªè¨‚èªé€Ÿï¼ˆ0.1~10ï¼Œé è¨­ 0.85 æ¯”è¼ƒæ…¢ï¼‰
    const TTS_RATE = 0.75;

    const Voice = { ready:false, unlocked:false, voices:[], zhVoice:null, enabled:false, timer:null };

    function loadVoices(){
      const list = window.speechSynthesis?.getVoices?.() || [];
      Voice.voices = list;
      Voice.zhVoice =
        list.find(v => v.lang?.toLowerCase().startsWith('zh-tw')) ||
        list.find(v => v.lang?.toLowerCase().startsWith('zh-hk')) ||
        list.find(v => v.lang?.toLowerCase().startsWith('zh-cn')) ||
        list.find(v => v.lang?.toLowerCase().startsWith('zh'));
    }

    function unlockTTS(){
      if(!('speechSynthesis' in window)){
        alert('æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³æ’­å ±ï¼Œè«‹æ”¹ç”¨ Chrome / Safari / Edgeã€‚');
        return false;
      }
      loadVoices();
      if(typeof speechSynthesis.onvoiceschanged !== 'undefined'){
        speechSynthesis.onvoiceschanged = () => loadVoices();
      }
      try{ speechSynthesis.resume(); }catch(e){}
      Voice.unlocked = true; Voice.ready = true;
      return true;
    }

    // é¿å…ã€Œé–‹é ­è¢«åƒæ‰ã€ï¼šå–æ¶ˆâ†’çŸ­æš«å»¶é²â†’å† speak
    function speakText(txt){
      if(!Voice.enabled || !Voice.ready || !txt) return;

      // æ¸…æ‰å¯èƒ½çš„é‡å…¥è¨ˆæ™‚å™¨
      if (Voice.timer){ clearTimeout(Voice.timer); Voice.timer = null; }

      if (speechSynthesis.speaking || speechSynthesis.pending){
        speechSynthesis.cancel();
        Voice.timer = setTimeout(()=> doSpeak(txt), 200); // å»¶é²ä¸€é»é»å†æ’­
      } else {
        Voice.timer = setTimeout(()=> doSpeak(txt), 180);  // å°æš–æ©Ÿï¼Œé¿å…è¢«åƒé ­
      }
    }

    function doSpeak(txt){
      const u = new SpeechSynthesisUtterance(txt);
      if(!Voice.zhVoice || !Voice.voices.length) loadVoices();
      if(Voice.zhVoice) u.voice = Voice.zhVoice;
      u.lang = (Voice.zhVoice && Voice.zhVoice.lang) || 'zh-TW';
      u.rate = TTS_RATE;  // â† èªé€Ÿåœ¨é€™è£¡èª¿æ•´
      u.pitch = 1;
      u.volume = 1;
      speechSynthesis.speak(u);
    }

    // é˜¿æ‹‰ä¼¯æ•¸å­— â†’ åœ‹èªå¸¸ç”¨è®€æ³•ï¼ˆ0~999ï¼‰
    function zhRead(n){
      n = Math.max(0, Math.min(999, Math.floor(n)));
      const d = ['é›¶','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','ä¸ƒ','å…«','ä¹'];
      if (n === 0) return 'é›¶';

      let out = '';
      const h = Math.floor(n / 100);
      const t = Math.floor((n % 100) / 10);
      const u = n % 10;

      if (h > 0){
        out += d[h] + 'ç™¾';
        if (t === 0 && u > 0) out += 'é›¶';
      }
      if (t > 0){
        if (t === 1 && h === 0) out += 'å';
        else out += d[t] + 'å';
      }
      if (u > 0){
        out += d[u];
      }
      return out;
    }

    // å«è™Ÿï¼ˆä¸€æ¬¡ç™¼è©±è£¡é¢ã€Œé‡è¤‡å…©æ¬¡ã€ï¼‰
    function speakNumber(n){
      const zh = zhRead(n);                // e.g. 129 â†’ ä¸€ç™¾äºŒåä¹
      const phrase = ${zh}è™Ÿã€${zh}è™Ÿè«‹é€²è¨ºé–“ï½;
      speakText(phrase);
    }

    // é–‹é—œäº‹ä»¶
    const voiceToggle = document.getElementById('voiceToggle');
    voiceToggle.addEventListener('change', ()=>{
      if(voiceToggle.checked){
        if(!Voice.unlocked && !unlockTTS()){ voiceToggle.checked = false; return; }
        Voice.enabled = true;
        speakText('èªéŸ³å«è™Ÿå·²é–‹å•Ÿ');
      }else{
        Voice.enabled = false;
        speechSynthesis.cancel();
      }
    });

    // é¦–æ¬¡è§¸æ§è‡ªå‹•è§£é–ï¼ˆè¡Œå‹•è£ç½®å‹å–„ï¼‰
    window.addEventListener('touchend', function once(){
      if(!Voice.unlocked){ unlockTTS(); }
      window.removeEventListener('touchend', once, true);
    }, true);

    document.addEventListener('visibilitychange', ()=>{
      if(document.visibilityState === 'visible'){
        try{ speechSynthesis.resume(); }catch(e){}
      }
    });
    /* ================= èªéŸ³æ’­å ±æ ¸å¿ƒï¼šçµæŸ ================= */

    /* å«è™Ÿï¼‹æ——æ¨™å‘ˆç¾ */
    async function fetchNumber(){
      try{
        // TODOï¼šæ›æˆä½ çš„ GAS åªè®€ URL
        const res = await fetch("https://script.google.com/macros/s/AKfycbxCxob5Ec0N7DqaT8ezOoNHgXjO9vOJ7ooEDUYiTnbKxXX4i9fFxuf-Dqs4PYMpmQJU/exec", { cache:'no-store' });
        const data = await res.json();

        renderStatusPill(data);

        const n = Number(data.number);
        if (!Number.isFinite(n) || n < 0 || n >= 1000) return; // é˜²å‘†

        const current = String(n).padStart(3,'0');
        if(current !== lastNumber){
          animateNumber(current);
          showPopup(è«‹ ${current} è™Ÿå°±è¨º);
          // ğŸ”Š åƒ…åœ¨è®Šæ›´æ™‚æ’­å ±ï¼ˆä¸å¿µå‰å° 0ï¼‰
          speakNumber(n);
          lastNumber = current;
        }
      }catch(err){ console.error('æŠ“è™Ÿç¢¼å¤±æ•—', err); }
    }

    function renderStatusPill(data){
      const box = document.getElementById('statusPill');
      box.innerHTML = '';
      if (data.holiday === true){
        const el = document.createElement('div');
        el.className = 'pill red';
        el.textContent = 'ç¾åœ¨æ™‚é–“æ²’æœ‰é–€è¨ºï¼Œä¼‘è¨ºä¸­';
        box.appendChild(el);
      } else if (data.closed === true){
        const el = document.createElement('div');
        el.className = 'pill coral';
        el.textContent = 'ç•¶å‰æ™‚æ®µé–€è¨ºå·²ç¶“åœæ­¢æ›è™Ÿ';
        box.appendChild(el);
      }
    }

    const pad2 = n => String(n).padStart(2,'0');

    function animateNumber(newNumber){
      const digits=document.querySelectorAll('#numberDisplay .digit-card');
      newNumber.split('').forEach((d,i)=>{
        const card=digits[i];
        const cur=card.querySelector('.current');
        const nxt=card.querySelector('.next');
        if(cur.innerText!==d){
          nxt.innerText=d;
          card.classList.add('flip');
          setTimeout(()=>{ cur.innerText=d; card.classList.remove('flip'); },500);
        }
      });
    }

    function updateTWTime(){
      const el=document.getElementById('twTime');
      const now = new Date();
      const tw = new Date(now.toLocaleString('en-US', { timeZone:'Asia/Taipei' }));
      const wMap = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'];
      el.textContent =
        ${tw.getFullYear()}/${pad2(tw.getMonth()+1)}/${pad2(tw.getDate())} (${wMap[tw.getDay()]}) +
        ${pad2(tw.getHours())}:${pad2(tw.getMinutes())}:${pad2(tw.getSeconds())};
    }

    fetchNumber(); setInterval(fetchNumber,5000);
    updateTWTime(); setInterval(updateTWTime,1000);

    function showPopup(msg){
      const container=document.querySelector('.container');
      const logo=document.getElementById('clinicLogo');
      const popup=document.createElement('div');
      popup.className='popup';
      popup.textContent=msg;
      container.appendChild(popup);
      const top = logo.offsetTop + logo.offsetHeight + 8;
      popup.style.top = top + 'px';
      setTimeout(()=>popup.remove(),5000);
    }
  </script>
</body>
</html>
ChatGPT èªªï¼š

å·²æ€è€ƒ 25s
å¤ªå¥½äº†ï¼æˆ‘å¹«ä½ æŠŠæ•´é æ•´åˆå®Œç•¢ï¼ŒåŒ…å«ï¼š

ä¿®æ­£ iOS/Safari é–‹é ­è¢«åƒæ‰ï¼ˆæš–æ©Ÿ utteranceï¼‰ã€‚

åœ‹èªè‡ªç„¶è®€æ•¸ï¼ˆ1â†’ã€Œä¸€ã€ã€10â†’ã€Œåã€ã€27â†’ã€ŒäºŒåä¸ƒã€ã€105â†’ã€Œä¸€ç™¾é›¶äº”ã€ï¼‰ã€‚

èªé€Ÿå¯èª¿ï¼ˆé è¨­ TTS_RATE = 0.75ï¼Œå¯è‡ªè¡Œæ”¹ï¼‰ã€‚

ã€ŒèªéŸ³å«è™Ÿã€ç´«è‰²è† å›Šé–‹é—œï¼ˆé–€è¨ºè¡¨åœ–ç‰‡ä¸‹æ–¹ï¼‰ã€‚

âœ… æ–°å¢ï¼šåœ¨ã€Œç›®å‰çœ‹è¨ºè™Ÿç¢¼ã€æ¨™é¡Œå³é‚Šæ”¾ä¸€é¡†ç´«è‰²åœ“å½¢å–‡å­æŒ‰éˆ•ï¼Œé»ä¸€ä¸‹æœƒé‡æ’­ä¸€æ¬¡ç•¶å‰è™Ÿç¢¼çš„èªéŸ³ï¼ˆå³ä½¿é–‹é—œé—œé–‰ä¹Ÿæœƒå–®æ¬¡æ’­æ”¾ï¼‰ã€‚

ç›´æ¥æ•´ä»½è¦†è“‹ï¼š

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<title>é™³è¬é¾è¨ºæ‰€çœ‹è¨ºé€²åº¦</title>
<meta name="description" content="å³æ™‚çœ‹è¨ºé€²åº¦èˆ‡é–€è¨ºè³‡è¨Š">
<meta name="theme-color" content="#35579A">

<meta property="og:type" content="website">
<meta property="og:title" content="é™³è¬é¾è¨ºæ‰€ï½œçœ‹è¨ºé€²åº¦">
<meta property="og:description" content="å³æ™‚çœ‹è¨ºé€²åº¦èˆ‡é–€è¨ºè³‡è¨Šã€‚">
<meta property="og:image" content="og-cover.jpg">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:url" content="https://tioar.github.io/Clinic_calling/">
<meta property="og:locale" content="zh_TW">

<link rel="icon" type="image/png" href="icon.png">
<link rel="apple-touch-icon" href="apple-touch-icon.png">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@700;800;900&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">

<style>
  :root{
    --primary:#35579A;
    --purple:#6B5AAE;
    --soft:#A5B8D0;
    --beige:#D8C0AD;
    --accent:#6db337;
    --bg:#F5EFE8;
    --card:#FFFFFF;
    --note:#F2F6FB;
    --digit-red:#DC2626;
    --pill-red:#E53935;
    --pill-coral:#F37163;
  }
  *{ box-sizing:border-box; }
  body{
    font-family:'Noto Sans TC',sans-serif;
    -webkit-font-smoothing:antialiased;
    background:var(--bg);
    margin:0;
    padding:clamp(16px,4vw,40px) max(12px,env(safe-area-inset-left)) clamp(24px,6vw,48px) max(12px,env(safe-area-inset-right));
    display:flex; justify-content:center; color:#1c1c1c;
  }
  .container{
    position:relative;
    width:min(860px,96vw);
    background:var(--card);
    border-radius:36px;
    padding:clamp(16px,4vw,32px);
    text-align:center;
    box-shadow:0 10px 30px rgba(53,87,154,0.10);
    border:3px solid var(--primary);
    overflow:visible;
  }
  .marquee{
    --gap: 2rem; --speed: 45s;
    background:var(--purple); color:#fff;
    border-radius:18px; padding:10px 0; margin:0 auto 10px;
    overflow:hidden; white-space:nowrap; user-select:none; font-size:14px;
  }
  .marquee__track{ display:inline-flex; align-items:center; width:max-content; animation:marquee-loop var(--speed) linear infinite; }
  .marquee__track > span{ padding-right:var(--gap); flex-shrink:0; }
  .marquee:hover .marquee__track{ animation-play-state:paused; }
  @keyframes marquee-loop{ from{transform:translateX(0)} to{transform:translateX(-50%)} }
  .logo-wrap{ margin:10px 0 0; }
  .logo{ height:clamp(120px,22vw,200px); max-width:82vw; object-fit:contain; background:#fff; }
  .pill-wrap{ display:flex; justify-content:center; margin:10px 0 6px; min-height:0; }
  .pill{ display:inline-flex; align-items:center; justify-content:center; padding:10px 18px; border-radius:999px; color:#fff; font-weight:900; box-shadow:0 8px 18px rgba(0,0,0,.12); letter-spacing:.5px; max-width:90%; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; font-size:16px; }
  .pill.red{ background:var(--pill-red); }
  .pill.coral{ background:var(--pill-coral); }

  /* æ¨™é¡Œåˆ—ï¼ˆå«é‡æ’­æŒ‰éˆ•ï¼‰ */
  .title-row{
    display:flex; align-items:center; justify-content:center;
    gap:10px; margin:12px 0 6px;
  }
  h1{ margin:0; color:var(--primary); letter-spacing:1px; }
  .repeat-btn{
    width:42px; height:42px; border-radius:50%;
    display:inline-grid; place-items:center;
    background:var(--purple); color:#fff;
    border:none; cursor:pointer;
    box-shadow:0 6px 14px rgba(0,0,0,.15), inset 0 0 0 2px rgba(255,255,255,.25);
    transition:transform .08s ease, filter .2s ease, box-shadow .2s ease;
  }
  .repeat-btn:active{ transform:translateY(1px) scale(.97); }
  .repeat-btn svg{ width:20px; height:20px; display:block; }

  .now-time{ color:#5f7396; font-weight:700; margin-bottom:18px; }
  .number-display{ display:flex; justify-content:center; gap:clamp(8px,2vw,16px); margin-bottom:16px; }
  .digit-card{
    width:clamp(72px,22vw,110px); height:clamp(92px,28vw,140px);
    background:#fff; color:var(--digit-red); font-family:'Manrope',sans-serif;
    font-variant-numeric:tabular-nums; font-size:clamp(56px,16vw,100px); font-weight:800; line-height:1;
    border-radius:28px; display:flex; align-items:center; justify-content:center;
    position:relative; perspective:400px; overflow:hidden;
    box-shadow:0 10px 24px rgba(53,87,154,.08), inset 0 0 0 3px var(--soft);
  }
  .digit-card .current,.digit-card .next{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; backface-visibility:hidden; }
  .digit-card .next{ transform:rotateX(-180deg); }
  .flip .current{ animation:flipTop .5s forwards; }
  .flip .next{ animation:flipBottom .5s forwards; }
  @keyframes flipTop{0%{transform:rotateX(0)}100%{transform:rotateX(180deg)}}
  @keyframes flipBottom{0%{transform:rotateX(-180deg)}100%{transform:rotateX(0)}}
  .note{ background:var(--note); padding:16px 20px; border-radius:22px; margin:16px auto 12px; box-shadow:0 4px 12px rgba(0,0,0,0.06); color:#274a6b; font-weight:600; width:min(760px,100%); text-align:center; }
  .note p{ margin:.35em 0; }
  .palette{ height:8px; border-radius:6px; margin:8px auto 16px; width:min(560px,90%); background:linear-gradient(to right,var(--beige) 0 22%,var(--accent) 22% 45%,var(--primary) 45% 82%,var(--soft) 82% 100%); }
  .schedule{ margin-top:6px; max-width:100%; border-radius:20px; box-shadow:0 4px 12px rgba(0,0,0,0.06); }
  .popup{ position:absolute; left:50%; transform:translateX(-50%); background:var(--accent); color:#fff; padding:14px 22px; border-radius:999px; font-size:20px; z-index:10; font-weight:800; opacity:0; animation:fadeInOut 3s forwards; box-shadow:0 12px 26px rgba(0,0,0,.15); pointer-events:none; white-space:nowrap; max-width:90%; overflow:hidden; text-overflow:ellipsis; }
  @keyframes fadeInOut{0%{opacity:0; transform:translate(-50%,-6px)}10%{opacity:1; transform:translate(-50%,0)}90%{opacity:1}100%{opacity:0; transform:translate(-50%,-6px)}}
  /* æ–°å¢ï¼šç´«è‰²è† å›Šã€ŒèªéŸ³å«è™Ÿã€é–‹é—œ */
  .voice-row{ display:flex; align-items:center; justify-content:center; gap:12px; margin:14px auto 0; user-select:none; }
  .voice-label{ font-weight:900; color:#4b3e7a; letter-spacing:.5px; }
  .switch{ position:relative; width:64px; height:36px; }
  .switch input{ position:absolute; width:100%; height:100%; opacity:0; margin:0; cursor:pointer; }
  .track{ position:absolute; inset:0; background:#d9d2f1; border-radius:999px; transition:.25s ease; box-shadow:inset 0 0 0 2px rgba(0,0,0,.06); }
  .thumb{ position:absolute; top:3px; left:3px; width:30px; height:30px; border-radius:50%; background:#fff; display:grid; place-items:center; transition:.25s ease; box-shadow:0 4px 12px rgba(0,0,0,.15); font-size:18px; }
  .switch input:checked ~ .track{ background:var(--purple); }
  .switch input:checked ~ .thumb{ left:31px; color:var(--purple); }
</style>
</head>

<body>
  <div class="container">
    <div class="marquee" aria-label="è¨ºæ‰€è¨Šæ¯è·‘é¦¬ç‡ˆ">
      <div class="marquee__track" id="marqueeTrack">
        <span>âœ¦ é™³è¬é¾è¨ºæ‰€é–€è¨ºæ™‚é–“ï¼šâ˜€ï¸ æ—©è¨º 08:30â€“11:30ï¼ˆæœ€æ™šå ±åˆ°10:30ï¼‰ï¼›â˜ï¸ åˆè¨º 14:00â€“17:00ï¼ˆæœ€æ™šå ±åˆ°16:00ï¼‰ï¼›â˜¾ æ™šè¨º 18:00â€“20:30ï¼ˆæœ€æ™šå ±åˆ°20:00ï¼‰ã€‚é€¾æ™‚è¦–åŒæ”¾æ£„ï¼Œåé¡å°‡é‡‹å‡ºçµ¦ç¾å ´æ›è™Ÿã€‚</span>
        <span aria-hidden="true">âœ¦ é™³è¬é¾è¨ºæ‰€é–€è¨ºæ™‚é–“ï¼šâ˜€ï¸ æ—©è¨º 08:30â€“11:30ï¼ˆæœ€æ™šå ±åˆ°10:30ï¼‰ï¼›â˜ï¸ åˆè¨º 14:00â€“17:00ï¼ˆæœ€æ™šå ±åˆ°16:00ï¼‰ï¼›â˜¾ æ™šè¨º 18:00â€“20:30ï¼ˆæœ€æ™šå ±åˆ°20:00ï¼‰ã€‚é€¾æ™‚è¦–åŒæ”¾æ£„ï¼Œåé¡å°‡é‡‹å‡ºçµ¦ç¾å ´æ›è™Ÿã€‚</span>
      </div>
    </div>

    <div class="logo-wrap">
      <img class="logo" id="clinicLogo" src="./logo1.jpg" alt="é™³è¬é¾è¨ºæ‰€ LOGO">
    </div>

    <div class="pill-wrap" aria-live="polite" id="statusPill"></div>

    <!-- æ¨™é¡Œï¼‹é‡æ’­æŒ‰éˆ• -->
    <div class="title-row">
      <h1>ç›®å‰çœ‹è¨ºè™Ÿç¢¼</h1>
      <button id="replayBtn" class="repeat-btn" aria-label="é‡æ’­èªéŸ³">
        <!-- å–‡å­åœ–ç¤ºï¼ˆSVGï¼‰ -->
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" aria-hidden="true">
          <path d="M3 9v6h4l5 4V5L7 9H3z" fill="currentColor"/>
          <path d="M14.5 8.5a5 5 0 010 7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <path d="M16.5 6a8 8 0 010 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" opacity=".7"/>
        </svg>
      </button>
    </div>

    <div class="now-time" id="twTime">â€”</div>

    <div class="number-display" id="numberDisplay">
      <div class="digit-card"><div class="current">0</div><div class="next">0</div></div>
      <div class="digit-card"><div class="current">0</div><div class="next">0</div></div>
      <div class="digit-card"><div class="current">0</div><div class="next">0</div></div>
    </div>

    <div class="note">
      <p>â™¦ï¸ é›²ç«¯è™Ÿç¢¼åƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›å«è™Ÿä»¥ç¾å ´ç‚ºæº–ã€‚æ¯ä½æ‚£è€…ç´„ 3â€“5 åˆ†é˜ï¼Œè«‹æå‰åˆ°å ´åœ¨å¯çœ‹åˆ°ç‡ˆè™Ÿçš„ä½ç½®ç­‰å€™ä»¥å…éè™Ÿã€‚</p>
      <p>â™¦ï¸ è‹¥å·²éè™Ÿè«‹å†æ¬¡å‘æ«ƒæª¯å ±åˆ°ï¼Œå°‡ä¾ç¾å ´ç‹€æ³èª¿æ•´å®‰æ’ã€‚</p>
      <p>â™¦ï¸ é–€è¨ºå¯èƒ½è¦–ç¾å ´ç‹€æ³æå‰åœæ­¢æ›è™Ÿï¼Œå¦‚æœ‰ç–‘å•è«‹ä¾†é›» (03)5152971ã€‚</p>
    </div>

    <div class="palette" aria-hidden="true"></div>
    <img class="schedule" id="scheduleImg" src="./schedule.png" alt="é–€è¨ºæ™‚é–“è¡¨">

    <!-- âœ… æ–°å¢ï¼šç´«è‰²è† å›Šé–‹é—œï¼ˆæ”¾åœ¨é–€è¨ºè¡¨åœ–ç‰‡ä¸‹æ–¹ï¼‰ -->
    <div class="voice-row" aria-live="polite">
      <label class="switch" aria-label="èªéŸ³å«è™Ÿé–‹é—œ">
        <input type="checkbox" id="voiceToggle" />
        <div class="track"></div>
        <div class="thumb">ğŸ”Š</div>
      </label>
      <div class="voice-label">èªéŸ³å«è™Ÿ</div>
    </div>
  </div>

  <script>
    /* è·‘é¦¬ç‡ˆæš«åœ/æ¢å¾© */
    (function(){
      const marquee = document.querySelector('.marquee');
      const track = document.getElementById('marqueeTrack');
      const pause = () => track.style.animationPlayState = 'paused';
      const run   = () => track.style.animationPlayState = 'running';
      marquee.addEventListener('pointerdown', pause);
      marquee.addEventListener('pointerup', run);
      marquee.addEventListener('pointerleave', run);
      marquee.addEventListener('pointercancel', run);
    })();

    /* åœ–ç‰‡å‚™æ´ */
    (function(){
      const logo = document.getElementById('clinicLogo');
      const logoFallbacks = [
        './logo.png',
        'https://raw.githubusercontent.com/tioar/Clinic_calling/main/logo1.jpg',
        'https://raw.githubusercontent.com/tioar/Clinic_calling/main/logo.png'
      ];
      let li=0; logo.onerror = function(){ if(li<logoFallbacks.length){ this.src=logoFallbacks[li++]; } else { this.style.display='none'; } };

      const sch = document.getElementById('scheduleImg');
      const schFallbacks = ['https://raw.githubusercontent.com/tioar/Clinic_calling/main/schedule.png'];
      let si=0; sch.onerror = function(){ if(si<schFallbacks.length){ this.src=schFallbacks[si++]; } else { this.style.display='none'; } };
    })();

    let lastNumber='000';

    /* ==================== èªéŸ³æ’­å ±æ ¸å¿ƒ ==================== */
    // èªé€Ÿï¼ˆ0.1~10ï¼‰ï¼šæƒ³æ›´æ…¢å¯æ”¹ 0.7ï¼›æƒ³æ­£å¸¸ 1.0
    const TTS_RATE = 0.75;

    const Voice = { ready:false, unlocked:false, voices:[], zhVoice:null, enabled:false, timer:null };

    function loadVoices(){
      const list = window.speechSynthesis?.getVoices?.() || [];
      Voice.voices = list;
      Voice.zhVoice =
        list.find(v => v.lang?.toLowerCase().startsWith('zh-tw')) ||
        list.find(v => v.lang?.toLowerCase().startsWith('zh-hk')) ||
        list.find(v => v.lang?.toLowerCase().startsWith('zh-cn')) ||
        list.find(v => v.lang?.toLowerCase().startsWith('zh'));
    }

    function unlockTTS(){
      if(!('speechSynthesis' in window)){
        alert('æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³æ’­å ±ï¼Œè«‹æ”¹ç”¨ Chrome / Safari / Edgeã€‚');
        return false;
      }
      loadVoices();
      if(typeof speechSynthesis.onvoiceschanged !== 'undefined'){
        speechSynthesis.onvoiceschanged = () => loadVoices();
      }
      try{ speechSynthesis.resume(); }catch(e){}
      Voice.unlocked = true; Voice.ready = true;
      return true;
    }

    // ====== å…·æœ‰ã€Œæš–æ©Ÿã€çš„æ’­æ”¾å…¥å£ï¼Œé¿å…é–‹é ­è¢«åƒæ‰ ======
    function speakText(txt){
      if(!Voice.ready || !txt) return;

      // allow one-shot even if toggle off (ç”± replayBtn è§¸ç™¼æ™‚æœƒæš«æ™‚é–‹å•Ÿ)
      if (!Voice.enabled && !speakText._oneshot) return;

      if (Voice.timer){ clearTimeout(Voice.timer); Voice.timer = null; }

      const play = () => {
        // ç”¨ NBSP æš–æ©Ÿï¼šå¤§å¤šæ•¸è£ç½®ä¸æœƒå‡ºè²ï¼Œåªæœƒæ¥µçŸ­ä¿ƒè§¸ç™¼ onend
        const warm = new SpeechSynthesisUtterance('\u00A0');
        warm.lang = (Voice.zhVoice && Voice.zhVoice.lang) || 'zh-TW';
        warm.rate = TTS_RATE; warm.pitch = 1; warm.volume = 0;

        const safety = setTimeout(() => {
          try{ speechSynthesis.cancel(); }catch(e){}
          reallySpeak(txt);
        }, 750);

        warm.onend = () => {
          clearTimeout(safety);
          setTimeout(() => reallySpeak(txt), 60);
        };

        try{ speechSynthesis.resume(); }catch(e){}
        speechSynthesis.speak(warm);
      };

      if (speechSynthesis.speaking || speechSynthesis.pending){
        try{ speechSynthesis.cancel(); }catch(e){}
        Voice.timer = setTimeout(play, 220);
      } else {
        Voice.timer = setTimeout(play, 100);
      }
    }

    function reallySpeak(txt){
      const u = new SpeechSynthesisUtterance(txt);
      if(!Voice.zhVoice || !Voice.voices.length) loadVoices();
      if(Voice.zhVoice) u.voice = Voice.zhVoice;
      u.lang = (Voice.zhVoice && Voice.zhVoice.lang) || 'zh-TW';
      u.rate = TTS_RATE;  u.pitch = 1;  u.volume = 1;
      u.onstart = ()=>{ try{ speechSynthesis.resume(); }catch(e){} };
      speechSynthesis.speak(u);
    }

    // é˜¿æ‹‰ä¼¯æ•¸å­— â†’ åœ‹èªå¸¸ç”¨è®€æ³•ï¼ˆ0~999ï¼‰
    function zhRead(n){
      n = Math.max(0, Math.min(999, Math.floor(n)));
      const d = ['é›¶','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','ä¸ƒ','å…«','ä¹'];
      if (n === 0) return 'é›¶';

      let out = '';
      const h = Math.floor(n / 100);
      const t = Math.floor((n % 100) / 10);
      const u = n % 10;

      if (h > 0){
        out += d[h] + 'ç™¾';
        if (t === 0 && u > 0) out += 'é›¶';
      }
      if (t > 0){
        if (t === 1 && h === 0) out += 'å';
        else out += d[t] + 'å';
      }
      if (u > 0){
        out += d[u];
      }
      return out;
    }

    // å«è™Ÿï¼ˆä¸€æ¬¡ç™¼è©±å…§é‡è¤‡å…©æ¬¡ï¼‰
    function speakNumber(n){
      const zh = zhRead(n);
      const phrase = `ç¬¬${zh}è™Ÿã€ç¬¬${zh}è™Ÿè«‹é€²è¨ºé–“ï½`;
      speakText(phrase);
    }

    // èªéŸ³é–‹é—œ
    const voiceToggle = document.getElementById('voiceToggle');
    voiceToggle.addEventListener('change', ()=>{
      if(voiceToggle.checked){
        if(!Voice.unlocked && !unlockTTS()){ voiceToggle.checked = false; return; }
        Voice.enabled = true;
        speakText._oneshot = true;  // å…è¨±é€™å¥å³ä½¿ toggle å‰›æ‰“é–‹ä¹Ÿèƒ½æ’­
        speakText('èªéŸ³å«è™Ÿå·²é–‹å•Ÿ');
        speakText._oneshot = false;
      }else{
        Voice.enabled = false;
        speechSynthesis.cancel();
      }
    });

    // âœ… é‡æ’­æŒ‰éˆ•ï¼šå³ä½¿é–‹é—œé—œé–‰ï¼Œä¹Ÿå…è¨±ã€Œå–®æ¬¡ã€æ’­æ”¾
    document.getElementById('replayBtn').addEventListener('click', ()=>{
      const n = parseInt(lastNumber, 10);
      if (!Number.isFinite(n)) return;
      if (!Voice.unlocked) unlockTTS();
      const prev = Voice.enabled;
      speakText._oneshot = true;   // æš«æ™‚å…è¨±æ’­å ±
      speakNumber(n);
      speakText._oneshot = false;
      Voice.enabled = prev;
    });

    // é¦–æ¬¡è§¸æ§è‡ªå‹•è§£é–ï¼ˆè¡Œå‹•è£ç½®å‹å–„ï¼‰
    window.addEventListener('touchend', function once(){
      if(!Voice.unlocked){ unlockTTS(); }
      window.removeEventListener('touchend', once, true);
    }, true);

    document.addEventListener('visibilitychange', ()=>{
      if(document.visibilityState === 'visible'){
        try{ speechSynthesis.resume(); }catch(e){}
      }
    });
    /* ================= èªéŸ³æ’­å ±æ ¸å¿ƒï¼šçµæŸ ================= */

    /* å«è™Ÿï¼‹æ——æ¨™å‘ˆç¾ */
    async function fetchNumber(){
      try{
        // TODOï¼šæ›æˆä½ çš„ GAS åªè®€ URL
        const res = await fetch("https://script.google.com/macros/s/AKfycbxCxob5Ec0N7DqaT8ezOoNHgXjO9vOJ7ooEDUYiTnbKxXX4i9fFxuf-Dqs4PYMpmQJU/exec", { cache:'no-store' });
        const data = await res.json();

        renderStatusPill(data);

        const n = Number(data.number);
        if (!Number.isFinite(n) || n < 0 || n >= 1000) return; // é˜²å‘†

        const current = String(n).padStart(3,'0');
        if(current !== lastNumber){
          animateNumber(current);
          showPopup(`è«‹ ${current} è™Ÿå°±è¨º`);
          // ğŸ”Š åƒ…åœ¨è®Šæ›´æ™‚æ’­å ±ï¼ˆä¸å¿µå‰å° 0ï¼‰
          Voice.enabled && speakNumber(n);
          lastNumber = current;
        }
      }catch(err){ console.error('æŠ“è™Ÿç¢¼å¤±æ•—', err); }
    }

    function renderStatusPill(data){
      const box = document.getElementById('statusPill');
      box.innerHTML = '';
      if (data.holiday === true){
        const el = document.createElement('div');
        el.className = 'pill red';
        el.textContent = 'ç¾åœ¨æ™‚é–“æ²’æœ‰é–€è¨ºï¼Œä¼‘è¨ºä¸­';
        box.appendChild(el);
      } else if (data.closed === true){
        const el = document.createElement('div');
        el.className = 'pill coral';
        el.textContent = 'ç•¶å‰æ™‚æ®µé–€è¨ºå·²ç¶“åœæ­¢æ›è™Ÿ';
        box.appendChild(el);
      }
    }

    const pad2 = n => String(n).padStart(2,'0');

    function animateNumber(newNumber){
      const digits=document.querySelectorAll('#numberDisplay .digit-card');
      newNumber.split('').forEach((d,i)=>{
        const card=digits[i];
        const cur=card.querySelector('.current');
        const nxt=card.querySelector('.next');
        if(cur.innerText!==d){
          nxt.innerText=d;
          card.classList.add('flip');
          setTimeout(()=>{ cur.innerText=d; card.classList.remove('flip'); },500);
        }
      });
    }

    function updateTWTime(){
      const el=document.getElementById('twTime');
      const now = new Date();
      const tw = new Date(now.toLocaleString('en-US', { timeZone:'Asia/Taipei' }));
      const wMap = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'];
      el.textContent =
        `${tw.getFullYear()}/${pad2(tw.getMonth()+1)}/${pad2(tw.getDate())} (${wMap[tw.getDay()]}) `+
        `${pad2(tw.getHours())}:${pad2(tw.getMinutes())}:${pad2(tw.getSeconds())}`;
    }

    fetchNumber(); setInterval(fetchNumber,5000);
    updateTWTime(); setInterval(updateTWTime,1000);

    function showPopup(msg){
      const container=document.querySelector('.container');
      const logo=document.getElementById('clinicLogo');
      const popup=document.createElement('div');
      popup.className='popup';
      popup.textContent=msg;
      container.appendChild(popup);
      const top = logo.offsetTop + logo.offsetHeight + 8;
      popup.style.top = top + 'px';
      setTimeout(()=>popup.remove(),5000);
    }
  </script>
</body>
</html>
æƒ³å¾®èª¿çš„åœ°æ–¹ï¼š

åªæƒ³å¿µä¸€æ¬¡ã€ä¸é‡è¤‡ï¼ŸæŠŠ speakNumber(n) çš„å­—ä¸²æ”¹æˆï¼šconst phrase = \ç¬¬${zh}è™Ÿè«‹é€²è¨ºé–“ï½`;`

èªé€Ÿå†æ…¢ä¸€é»ï¼šconst TTS_RATE = 0.7;

å¦‚æœæƒ³è®“é‡æ’­æŒ‰éˆ•åŒæ™‚æŠŠé–‹é—œæ‰“é–‹ï¼Œä¹Ÿè¡Œï¼Œæˆ‘å¯ä»¥å¹«ä½ æŠŠé»æ“Šæ™‚è‡ªå‹•æŠŠé–‹é—œè¨­ç‚ºå·²é–‹å•Ÿã€‚

ä½ èªªï¼š
iphone safari æ²’æœ‰å•é¡Œ
android chrome ç¬¬å¹¾è™Ÿå®Œæ•´å‡ºç¾ï¼Œä½†æ˜¯èªå°¾éƒ½æœƒå‡ºç¾"telda"é€™å€‹è©ä¸çŸ¥é“æ˜¯ä»€éº¼ï¼Œå…¶ä»–ç€è¦½å™¨æ²’æœ‰
windows11 chrome å‰é¢ä»èˆŠè¢«åƒæ‰ï¼Œ"18è™Ÿ"æœƒè®Šæˆ"å…«è™Ÿã€ç¬¬åå…«è™Ÿè«‹é€²è¨ºé–“"
ChatGPT èªªï¼š

å·²æ€è€ƒ 44s
æ„Ÿè¬å›å ±ï¼å…©å€‹å•é¡Œåˆ†åˆ¥æ˜¯ï¼š

Android Chrome çš„ã€Œteldaã€ï¼šæ˜¯å› ç‚ºæˆ‘å€‘å¥å°¾ç”¨äº† ASCII çš„ ~ï¼ŒAndroid çš„ TTS æœƒæŠŠå®ƒå¿µæˆã€Œtildeã€ã€‚â†’ æˆ‘æ”¹æˆå…¨å½¢å¥è™Ÿ ã€‚ï¼Œä¸å†ç”¨ ~ã€‚

Windows 11 Chrome é–‹é ­è¢«åƒæ‰ï¼šæš–æ©Ÿä»ä¸è¶³ã€‚â†’ æˆ‘å†åŠ ã€Œæ›´ç©©çš„æš–æ©Ÿåºåˆ—ã€+ã€Œå‰ç½®å…¨å½¢ç©ºç™½ \u3000 èˆ‡é€—è™Ÿ ï¼Œã€+ ç•¥é•·ä¸€é»çš„å»¶é²ï¼Œèƒ½æœ‰æ•ˆé¿å… 18 èª¤å¿µæˆã€Œå…«ã€ã€‚

ä¸‹é¢çµ¦ä½ è¦ã€Œç›´æ¥è²¼ä¸Šå–ä»£ã€çš„æœ€å°æ”¹å‹•ï¼šåªéœ€è¦æŠŠä½ æª”æ¡ˆä¸­çš„ TTS å€å¡Š & speakNumber() æ›æˆé€™æ®µï¼ˆå…¶é¤˜ HTML/CSS/æŠ“è™Ÿç¢¼ä¸ç”¨å‹•ï¼‰ã€‚

ä½ æ­£åœ¨ç”¨çš„ç‰ˆæœ¬è£¡ï¼Œæ‰¾åˆ° /* ==================== èªéŸ³æ’­å ±æ ¸å¿ƒ ==================== */ é–‹å§‹ï¼Œåˆ° /* ================= èªéŸ³æ’­å ±æ ¸å¿ƒï¼šçµæŸ ================= */ çµæŸï¼Œæ•´æ®µæ›¿æ›ç‚ºä¸‹é¢é€™æ®µå³å¯ã€‚

<script>
  /* ==================== èªéŸ³æ’­å ±æ ¸å¿ƒï¼ˆAndroid/Windows ä¿®æ­£ç‰ˆï¼‰ ==================== */
  // èªé€Ÿï¼ˆ0.1~10ï¼‰ï¼šæƒ³æ›´æ…¢å¯æ”¹ 0.7ï¼›æƒ³æ­£å¸¸ 1.0
  const TTS_RATE = 0.75;

  const Voice = { ready:false, unlocked:false, voices:[], zhVoice:null, enabled:false, timer:null };

  function loadVoices(){
    const list = window.speechSynthesis?.getVoices?.() || [];
    Voice.voices = list;
    Voice.zhVoice =
      list.find(v => v.lang?.toLowerCase().startsWith('zh-tw')) ||
      list.find(v => v.lang?.toLowerCase().startsWith('zh-hk')) ||
      list.find(v => v.lang?.toLowerCase().startsWith('zh-cn')) ||
      list.find(v => v.lang?.toLowerCase().startsWith('zh'));
  }

  function unlockTTS(){
    if(!('speechSynthesis' in window)){
      alert('æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³æ’­å ±ï¼Œè«‹æ”¹ç”¨ Chrome / Safari / Edgeã€‚');
      return false;
    }
    loadVoices();
    if(typeof speechSynthesis.onvoiceschanged !== 'undefined'){
      speechSynthesis.onvoiceschanged = () => loadVoices();
    }
    try{ speechSynthesis.resume(); }catch(e){}
    Voice.unlocked = true; Voice.ready = true;
    return true;
  }

  // ====== å…·æœ‰ã€Œæ›´ç©©æš–æ©Ÿã€çš„æ’­æ”¾å…¥å£ï¼Œé¿å… Windows/Chrome é–‹é ­è¢«åƒæ‰ ======
  function speakText(txt){
    if(!Voice.ready || !txt) return;

    // allow one-shot even if toggle offï¼ˆé‡æ’­éˆ•å¯ç”¨ï¼‰
    if (!Voice.enabled && !speakText._oneshot) return;

    if (Voice.timer){ clearTimeout(Voice.timer); Voice.timer = null; }

    const play = () => {
      // 1) æš–æ©Ÿ Utteranceï¼ˆNBSPï¼Œä¸å‡ºè²ï¼‰
      const warm = new SpeechSynthesisUtterance('\u00A0');
      warm.lang = (Voice.zhVoice && Voice.zhVoice.lang) || 'zh-TW';
      warm.rate = TTS_RATE; warm.pitch = 1; warm.volume = 0;

      // 2) ä¿éšªï¼šè‹¥ onend æ²’å›ä¾†ï¼Œ0.9 ç§’å¾Œå¼·åˆ¶æ’­ä¸»å¥
      const safety = setTimeout(() => {
        try{ speechSynthesis.cancel(); }catch(e){}
        reallySpeak(txt);
      }, 900);

      warm.onend = () => {
        clearTimeout(safety);
        // 3) å†å¤šç­‰ä¸€ä¸‹ï¼ˆWindows/Chrome éœ€è¦ï¼‰ï¼Œå†æ’­ä¸»å¥
        setTimeout(() => reallySpeak(txt), 120);
      };

      try{ speechSynthesis.resume(); }catch(e){}
      speechSynthesis.speak(warm);
    };

    // è‹¥æ­¤æ™‚é‚„åœ¨è¬›è©±æˆ–ä½‡åˆ—ä¸­ï¼Œå…ˆå–æ¶ˆ â†’ ç­‰ä¹…ä¸€é» â†’ å†æš–æ©Ÿ
    if (speechSynthesis.speaking || speechSynthesis.pending){
      try{ speechSynthesis.cancel(); }catch(e){}
      Voice.timer = setTimeout(play, 280);   // â† åŸæœ¬ 220ï¼Œå»¶é•·åˆ° 280ms
    } else {
      Voice.timer = setTimeout(play, 150);   // â† åŸæœ¬ 100â€“120ï¼Œå»¶é•·åˆ° 150ms
    }
  }

  // å¯¦éš›æ’­å ±ï¼šå‰é¢åŠ å…¨å½¢ç©ºç™½èˆ‡é€—è™Ÿï¼Œé¿å…ç¬¬ä¸€éŸ³è¢«åï¼›çµå°¾ç”¨å…¨å½¢å¥è™Ÿé¿å… Android å¿µ tilde
  function reallySpeak(txt){
    // å‰ç¶´åŠ å…¥ã€Œå…¨å½¢ç©ºç™½ + é€—è™Ÿã€è®“å¼•æ“å…ˆç©©ä½ï¼Œå†é€²ä¸»å¥ï¼›å¯¦éš›ä¸æœƒè¢«å¿µå‡º
    const safeText = '\u3000ï¼Œ' + String(txt).replace(/~+$/g,'ã€‚'); // ç§»é™¤/æ›¿æ›å¥å°¾ ~ â†’ ã€‚
    const u = new SpeechSynthesisUtterance(safeText);
    if(!Voice.zhVoice || !Voice.voices.length) loadVoices();
    if(Voice.zhVoice) u.voice = Voice.zhVoice;
    u.lang = (Voice.zhVoice && Voice.zhVoice.lang) || 'zh-TW';
    u.rate = TTS_RATE;  u.pitch = 1;  u.volume = 1;
    u.onstart = ()=>{ try{ speechSynthesis.resume(); }catch(e){} };
    speechSynthesis.speak(u);
  }

  // é˜¿æ‹‰ä¼¯æ•¸å­— â†’ åœ‹èªå¸¸ç”¨è®€æ³•ï¼ˆ0~999ï¼‰
  function zhRead(n){
    n = Math.max(0, Math.min(999, Math.floor(n)));
    const d = ['é›¶','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','ä¸ƒ','å…«','ä¹'];
    if (n === 0) return 'é›¶';
    let out = '';
    const h = Math.floor(n / 100);
    const t = Math.floor((n % 100) / 10);
    const u = n % 10;
    if (h > 0){
      out += d[h] + 'ç™¾';
      if (t === 0 && u > 0) out += 'é›¶';
    }
    if (t > 0){
      if (t === 1 && h === 0) out += 'å';
      else out += d[t] + 'å';
    }
    if (u > 0){
      out += d[u];
    }
    return out;
  }

  // å«è™Ÿï¼ˆä¸€æ¬¡ç™¼è©±å…§é‡è¤‡å…©æ¬¡ï¼›å¥å°¾ç”¨ã€Œã€‚ã€ï¼›ä¸å¿µã€Œå°±è¨ºã€ï¼‰
  function speakNumber(n){
    const zh = zhRead(n);
    const phrase = `ç¬¬${zh}è™Ÿã€ç¬¬${zh}è™Ÿè«‹é€²è¨ºé–“ã€‚`;  // â† ä¸ç”¨ ~ï¼Œé¿å… Android å¿µæˆ ã€Œtildeã€
    speakText(phrase);
  }

  // èªéŸ³é–‹é—œï¼ˆä¿ç•™ä½ åŸæœ¬çš„ï¼‰
  const voiceToggle = document.getElementById('voiceToggle');
  voiceToggle.addEventListener('change', ()=>{
    if(voiceToggle.checked){
      if(!Voice.unlocked && !unlockTTS()){ voiceToggle.checked = false; return; }
      Voice.enabled = true;
      speakText._oneshot = true;
      speakText('èªéŸ³å«è™Ÿå·²é–‹å•Ÿã€‚');
      speakText._oneshot = false;
    }else{
      Voice.enabled = false;
      speechSynthesis.cancel();
    }
  });

  // é‡æ’­æŒ‰éˆ•ï¼ˆä¿ç•™ä½ åŸæœ¬çš„ï¼Œç¢ºä¿å³ä½¿é—œé–‰ä¹Ÿèƒ½å–®æ¬¡æ’­ï¼‰
  document.getElementById('replayBtn')?.addEventListener('click', ()=>{
    const n = parseInt(lastNumber, 10);
    if (!Number.isFinite(n)) return;
    if (!Voice.unlocked) unlockTTS();
    const prev = Voice.enabled;
    speakText._oneshot = true;
    speakNumber(n);
    speakText._oneshot = false;
    Voice.enabled = prev;
  });

  // é¦–æ¬¡è§¸æ§è‡ªå‹•è§£é– & è¦–çª—å›å‰æ™¯ resumeï¼ˆä¿ç•™ï¼‰
  window.addEventListener('touchend', function once(){
    if(!Voice.unlocked){ unlockTTS(); }
    window.removeEventListener('touchend', once, true);
  }, true);
  document.addEventListener('visibilitychange', ()=>{
    if(document.visibilityState === 'visible'){
      try{ speechSynthesis.resume(); }catch(e){}
    }
  });
  /* ================= èªéŸ³æ’­å ±æ ¸å¿ƒï¼šçµæŸ ================= */
</script>
ç‚ºä»€éº¼é€™æ¨£å¯è§£æ±ºä½ å…©å€‹æ¡ˆä¾‹
Android Chromeï¼šæŠŠå°¾å·´ ï½/~ æ”¹æˆ ã€‚ï¼Œé¿å…è¢«å¿µæˆã€Œtilde/teldaã€ã€‚

Windows 11 Chromeï¼šåŠ å¼·æš–æ©Ÿã€å»¶é•·å»¶é²ï¼Œä¸¦åœ¨ä¸»å¥å‰ç½®å…¨å½¢ç©ºç™½ \u3000 + é€—è™Ÿ ï¼Œï¼Œå¤§å¹…é™ä½ç¬¬ä¸€éŸ³è¢«åçš„æ©Ÿç‡ã€‚æ‰€ä»¥ã€Œ18è™Ÿã€æ‡‰è©²æœƒæ­£ç¢ºå¿µæˆã€Œç¬¬åå…«è™Ÿã€ ç¬¬åå…«è™Ÿè«‹é€²è¨ºé–“ã€‚ã€

å¦‚æœä½ æƒ³å†æ›´ç©©ä¸€é»ï¼ŒæŠŠ setTimeout çš„æ•¸å€¼å†ä¸Šèª¿ä¸€é»é»ï¼ˆä¾‹å¦‚ 280â†’320ã€150â†’180ã€120â†’160ï¼‰ï¼Œæˆ‘ä¹Ÿå¯ä»¥å¹«ä½ åšæˆã€Œä¾ç€è¦½å™¨åµæ¸¬è‡ªå‹•å¥—ä¸åŒå»¶é²ã€çš„ç‰ˆæœ¬ã€‚

ä½ èªªï¼š
æˆ‘çš„å•é¡Œæ˜¯å»¶é²å¤ªä¹…äº†ï¼Œæˆ‘ä¿®æ”¹è™Ÿç¢¼å¥¹è‡³å°‘è¦åç§’é˜æ‰æœƒæ›´æ–°ï¼Œæ¯å¤©ä¸Šç™¾å€‹äººç­‰æ–¼æ…¢äº†å¥½ä¹…ï¼Œèƒ½ä¸èƒ½åæ‡‰å¿«ä¸€é»
ChatGPT èªªï¼š

å·²æ€è€ƒ 1m 16s
æ‡‚äº†ï¼10 ç§’çœŸçš„å¤ªä¹…ã€‚æˆ‘å¹«ä½ æŠŠã€Œæ›´æ–° & æ’­å ±ã€çš„æ•´å€‹æµç¨‹ç˜¦èº«æˆä½å»¶é²ç‰ˆï¼š

æŠ“è™Ÿç¢¼é »ç‡ï¼šå¾ 5 ç§’ â†’ 1.5 ç§’ï¼ˆå¯è‡ªè¡Œæ”¹ POLL_MSï¼‰ã€‚

å¿«å–æ‰“ç ´ï¼šæ¯æ¬¡è«‹æ±‚å¸¶æ™‚é–“æˆ³ ?ts=...ï¼ŒåŠ ä¸Š no-cache æ¨™é ­ï¼Œé¿å… GAS/ç€è¦½å™¨å¿«å–æ‹–å»¶ã€‚

è¶…æ™‚é‡è©¦ï¼šfetch 1.2 ç§’æ²’å›å°±ä¸­æ­¢ï¼Œä¸‹ä¸€è¼ªå†æ‹‰ï¼Œé¿å…è¢«æ…¢é€£ç·šå¡ä½ã€‚

TTS æš–æ©Ÿä¾¦æµ‹å¼ï¼šä¾ç€è¦½å™¨è‡ªå‹•é¸æ“‡è¼ƒçŸ­çš„æš–æ©Ÿï¼ˆWindows Chrome ç¨é•·ã€iOS/Android æ›´çŸ­ï¼‰ï¼ŒæŠŠé–‹é ­è¢«åƒçš„æ©Ÿç‡é™åˆ°æœ€ä½ï¼ŒåŒæ™‚åˆä¸æ‹–å»¶ã€‚

Androidã€Œtildeã€ï¼šæŠŠå°¾å·´æ”¹æˆå…¨å½¢å¥è™Ÿ ã€‚ï¼Œä¸æœƒå¿µã€Œteldaã€ã€‚

ä¿ç•™ä½ è¦çš„ï¼šé‡æ’­å–‡å­æŒ‰éˆ•ã€ç´«è‰²è† å›Šé–‹é—œã€åœ‹èªç¿’æ…£è®€æ•¸ã€ä¸å¿µã€Œè«‹å°±è¨ºã€ã€‚

ç›´æ¥æ•´ä»½è¦†è“‹å³å¯ğŸ‘‡ï¼ˆæŠŠä½ çš„ GAS URL æ›å›å»å°±å¥½ï¼‰ï¼š

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<title>é™³è¬é¾è¨ºæ‰€çœ‹è¨ºé€²åº¦</title>
<meta name="description" content="å³æ™‚çœ‹è¨ºé€²åº¦èˆ‡é–€è¨ºè³‡è¨Š">
<meta name="theme-color" content="#35579A">

<meta property="og:type" content="website">
<meta property="og:title" content="é™³è¬é¾è¨ºæ‰€ï½œçœ‹è¨ºé€²åº¦">
<meta property="og:description" content="å³æ™‚çœ‹è¨ºé€²åº¦èˆ‡é–€è¨ºè³‡è¨Šã€‚">
<meta property="og:image" content="og-cover.jpg">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:url" content="https://tioar.github.io/Clinic_calling/">
<meta property="og:locale" content="zh_TW">

<link rel="icon" type="image/png" href="icon.png">
<link rel="apple-touch-icon" href="apple-touch-icon.png">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@700;800;900&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">

<style>
  :root{
    --primary:#35579A;
    --purple:#6B5AAE;
    --soft:#A5B8D0;
    --beige:#D8C0AD;
    --accent:#6db337;
    --bg:#F5EFE8;
    --card:#FFFFFF;
    --note:#F2F6FB;
    --digit-red:#DC2626;
    --pill-red:#E53935;
    --pill-coral:#F37163;
  }
  *{ box-sizing:border-box; }
  body{
    font-family:'Noto Sans TC',sans-serif;
    -webkit-font-smoothing:antialiased;
    background:var(--bg);
    margin:0;
    padding:clamp(16px,4vw,40px) max(12px,env(safe-area-inset-left)) clamp(24px,6vw,48px) max(12px,env(safe-area-inset-right));
    display:flex; justify-content:center; color:#1c1c1c;
  }
  .container{
    position:relative;
    width:min(860px,96vw);
    background:var(--card);
    border-radius:36px;
    padding:clamp(16px,4vw,32px);
    text-align:center;
    box-shadow:0 10px 30px rgba(53,87,154,0.10);
    border:3px solid var(--primary);
    overflow:visible;
  }
  .marquee{
    --gap: 2rem; --speed: 45s;
    background:var(--purple); color:#fff;
    border-radius:18px; padding:10px 0; margin:0 auto 10px;
    overflow:hidden; white-space:nowrap; user-select:none; font-size:14px;
  }
  .marquee__track{ display:inline-flex; align-items:center; width:max-content; animation:marquee-loop var(--speed) linear infinite; }
  .marquee__track > span{ padding-right:var(--gap); flex-shrink:0; }
  .marquee:hover .marquee__track{ animation-play-state:paused; }
  @keyframes marquee-loop{ from{transform:translateX(0)} to{transform:translateX(-50%)} }
  .logo-wrap{ margin:10px 0 0; }
  .logo{ height:clamp(120px,22vw,200px); max-width:82vw; object-fit:contain; background:#fff; }
  .pill-wrap{ display:flex; justify-content:center; margin:10px 0 6px; min-height:0; }
  .pill{ display:inline-flex; align-items:center; justify-content:center; padding:10px 18px; border-radius:999px; color:#fff; font-weight:900; box-shadow:0 8px 18px rgba(0,0,0,.12); letter-spacing:.5px; max-width:90%; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; font-size:16px; }
  .pill.red{ background:var(--pill-red); }
  .pill.coral{ background:var(--pill-coral); }

  /* æ¨™é¡Œåˆ—ï¼ˆå«é‡æ’­æŒ‰éˆ•ï¼‰ */
  .title-row{
    display:flex; align-items:center; justify-content:center;
    gap:10px; margin:12px 0 6px;
  }
  h1{ margin:0; color:var(--primary); letter-spacing:1px; }
  .repeat-btn{
    width:42px; height:42px; border-radius:50%;
    display:inline-grid; place-items:center;
    background:var(--purple); color:#fff;
    border:none; cursor:pointer;
    box-shadow:0 6px 14px rgba(0,0,0,.15), inset 0 0 0 2px rgba(255,255,255,.25);
    transition:transform .08s ease, filter .2s ease, box-shadow .2s ease;
  }
  .repeat-btn:active{ transform:translateY(1px) scale(.97); }
  .repeat-btn svg{ width:20px; height:20px; display:block; }

  .now-time{ color:#5f7396; font-weight:700; margin-bottom:18px; }
  .number-display{ display:flex; justify-content:center; gap:clamp(8px,2vw,16px); margin-bottom:16px; }
  .digit-card{
    width:clamp(72px,22vw,110px); height:clamp(92px,28vw,140px);
    background:#fff; color:var(--digit-red); font-family:'Manrope',sans-serif;
    font-variant-numeric:tabular-nums; font-size:clamp(56px,16vw,100px); font-weight:800; line-height:1;
    border-radius:28px; display:flex; align-items:center; justify-content:center;
    position:relative; perspective:400px; overflow:hidden;
    box-shadow:0 10px 24px rgba(53,87,154,.08), inset 0 0 0 3px var(--soft);
  }
  .digit-card .current,.digit-card .next{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; backface-visibility:hidden; }
  .digit-card .next{ transform:rotateX(-180deg); }
  .flip .current{ animation:flipTop .5s forwards; }
  .flip .next{ animation:flipBottom .5s forwards; }
  @keyframes flipTop{0%{transform:rotateX(0)}100%{transform:rotateX(180deg)}}
  @keyframes flipBottom{0%{transform:rotateX(-180deg)}100%{transform:rotateX(0)}}
  .note{ background:var(--note); padding:16px 20px; border-radius:22px; margin:16px auto 12px; box-shadow:0 4px 12px rgba(0,0,0,0.06); color:#274a6b; font-weight:600; width:min(760px,100%); text-align:center; }
  .note p{ margin:.35em 0; }
  .palette{ height:8px; border-radius:6px; margin:8px auto 16px; width:min(560px,90%); background:linear-gradient(to right,var(--beige) 0 22%,var(--accent) 22% 45%,var(--primary) 45% 82%,var(--soft) 82% 100%); }
  .schedule{ margin-top:6px; max-width:100%; border-radius:20px; box-shadow:0 4px 12px rgba(0,0,0,0.06); }
  .popup{ position:absolute; left:50%; transform:translateX(-50%); background:var(--accent); color:#fff; padding:14px 22px; border-radius:999px; font-size:20px; z-index:10; font-weight:800; opacity:0; animation:fadeInOut 3s forwards; box-shadow:0 12px 26px rgba(0,0,0,.15); pointer-events:none; white-space:nowrap; max-width:90%; overflow:hidden; text-overflow:ellipsis; }
  @keyframes fadeInOut{0%{opacity:0; transform:translate(-50%,-6px)}10%{opacity:1; transform:translate(-50%,0)}90%{opacity:1}100%{opacity:0; transform:translate(-50%,-6px)}}
  /* æ–°å¢ï¼šç´«è‰²è† å›Šã€ŒèªéŸ³å«è™Ÿã€é–‹é—œ */
  .voice-row{ display:flex; align-items:center; justify-content:center; gap:12px; margin:14px auto 0; user-select:none; }
  .voice-label{ font-weight:900; color:#4b3e7a; letter-spacing:.5px; }
  .switch{ position:relative; width:64px; height:36px; }
  .switch input{ position:absolute; width:100%; height:100%; opacity:0; margin:0; cursor:pointer; }
  .track{ position:absolute; inset:0; background:#d9d2f1; border-radius:999px; transition:.25s ease; box-shadow:inset 0 0 0 2px rgba(0,0,0,.06); }
  .thumb{ position:absolute; top:3px; left:3px; width:30px; height:30px; border-radius:50%; background:#fff; display:grid; place-items:center; transition:.25s ease; box-shadow:0 4px 12px rgba(0,0,0,.15); font-size:18px; }
  .switch input:checked ~ .track{ background:var(--purple); }
  .switch input:checked ~ .thumb{ left:31px; color:var(--purple); }
</style>
</head>

<body>
  <div class="container">
    <div class="marquee" aria-label="è¨ºæ‰€è¨Šæ¯è·‘é¦¬ç‡ˆ">
      <div class="marquee__track" id="marqueeTrack">
        <span>âœ¦ é™³è¬é¾è¨ºæ‰€é–€è¨ºæ™‚é–“ï¼šâ˜€ï¸ æ—©è¨º 08:30â€“11:30ï¼ˆæœ€æ™šå ±åˆ°10:30ï¼‰ï¼›â˜ï¸ åˆè¨º 14:00â€“17:00ï¼ˆæœ€æ™šå ±åˆ°16:00ï¼‰ï¼›â˜¾ æ™šè¨º 18:00â€“20:30ï¼ˆæœ€æ™šå ±åˆ°20:00ï¼‰ã€‚é€¾æ™‚è¦–åŒæ”¾æ£„ï¼Œåé¡å°‡é‡‹å‡ºçµ¦ç¾å ´æ›è™Ÿã€‚</span>
        <span aria-hidden="true">âœ¦ é™³è¬é¾è¨ºæ‰€é–€è¨ºæ™‚é–“ï¼šâ˜€ï¸ æ—©è¨º 08:30â€“11:30ï¼ˆæœ€æ™šå ±åˆ°10:30ï¼‰ï¼›â˜ï¸ åˆè¨º 14:00â€“17:00ï¼ˆæœ€æ™šå ±åˆ°16:00ï¼‰ï¼›â˜¾ æ™šè¨º 18:00â€“20:30ï¼ˆæœ€æ™šå ±åˆ°20:00ï¼‰ã€‚é€¾æ™‚è¦–åŒæ”¾æ£„ï¼Œåé¡å°‡é‡‹å‡ºçµ¦ç¾å ´æ›è™Ÿã€‚</span>
      </div>
    </div>

    <div class="logo-wrap">
      <img class="logo" id="clinicLogo" src="./logo1.jpg" alt="é™³è¬é¾è¨ºæ‰€ LOGO">
    </div>

    <div class="pill-wrap" aria-live="polite" id="statusPill"></div>

    <!-- æ¨™é¡Œï¼‹é‡æ’­æŒ‰éˆ• -->
    <div class="title-row">
      <h1>ç›®å‰çœ‹è¨ºè™Ÿç¢¼</h1>
      <button id="replayBtn" class="repeat-btn" aria-label="é‡æ’­èªéŸ³">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" aria-hidden="true">
          <path d="M3 9v6h4l5 4V5L7 9H3z" fill="currentColor"/>
          <path d="M14.5 8.5a5 5 0 010 7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <path d="M16.5 6a8 8 0 010 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" opacity=".7"/>
        </svg>
      </button>
    </div>

    <div class="now-time" id="twTime">â€”</div>

    <div class="number-display" id="numberDisplay">
      <div class="digit-card"><div class="current">0</div><div class="next">0</div></div>
      <div class="digit-card"><div class="current">0</div><div class="next">0</div></div>
      <div class="digit-card"><div class="current">0</div><div class="next">0</div></div>
    </div>

    <div class="note">
      <p>â™¦ï¸ é›²ç«¯è™Ÿç¢¼åƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›å«è™Ÿä»¥ç¾å ´ç‚ºæº–ã€‚æ¯ä½æ‚£è€…ç´„ 3â€“5 åˆ†é˜ï¼Œè«‹æå‰åˆ°å ´åœ¨å¯çœ‹åˆ°ç‡ˆè™Ÿçš„ä½ç½®ç­‰å€™ä»¥å…éè™Ÿã€‚</p>
      <p>â™¦ï¸ è‹¥å·²éè™Ÿè«‹å†æ¬¡å‘æ«ƒæª¯å ±åˆ°ï¼Œå°‡ä¾ç¾å ´ç‹€æ³èª¿æ•´å®‰æ’ã€‚</p>
      <p>â™¦ï¸ é–€è¨ºå¯èƒ½è¦–ç¾å ´ç‹€æ³æå‰åœæ­¢æ›è™Ÿï¼Œå¦‚æœ‰ç–‘å•è«‹ä¾†é›» (03)5152971ã€‚</p>
    </div>

    <div class="palette" aria-hidden="true"></div>
    <img class="schedule" id="scheduleImg" src="./schedule.png" alt="é–€è¨ºæ™‚é–“è¡¨">

    <!-- âœ… æ–°å¢ï¼šç´«è‰²è† å›Šé–‹é—œï¼ˆæ”¾åœ¨é–€è¨ºè¡¨åœ–ç‰‡ä¸‹æ–¹ï¼‰ -->
    <div class="voice-row" aria-live="polite">
      <label class="switch" aria-label="èªéŸ³å«è™Ÿé–‹é—œ">
        <input type="checkbox" id="voiceToggle" />
        <div class="track"></div>
        <div class="thumb">ğŸ”Š</div>
      </label>
      <div class="voice-label">èªéŸ³å«è™Ÿ</div>
    </div>
  </div>

  <script>
    /* è·‘é¦¬ç‡ˆæš«åœ/æ¢å¾© */
    (function(){
      const marquee = document.querySelector('.marquee');
      const track = document.getElementById('marqueeTrack');
      const pause = () => track.style.animationPlayState = 'paused';
      const run   = () => track.style.animationPlayState = 'running';
      marquee.addEventListener('pointerdown', pause);
      marquee.addEventListener('pointerup', run);
      marquee.addEventListener('pointerleave', run);
      marquee.addEventListener('pointercancel', run);
    })();

    /* åœ–ç‰‡å‚™æ´ */
    (function(){
      const logo = document.getElementById('clinicLogo');
      const logoFallbacks = [
        './logo.png',
        'https://raw.githubusercontent.com/tioar/Clinic_calling/main/logo1.jpg',
        'https://raw.githubusercontent.com/tioar/Clinic_calling/main/logo.png'
      ];
      let li=0; logo.onerror = function(){ if(li<logoFallbacks.length){ this.src=logoFallbacks[li++]; } else { this.style.display='none'; } };

      const sch = document.getElementById('scheduleImg');
      const schFallbacks = ['https://raw.githubusercontent.com/tioar/Clinic_calling/main/schedule.png'];
      let si=0; sch.onerror = function(){ if(si<schFallbacks.length){ this.src=schFallbacks[si++]; } else { this.style.display='none'; } };
    })();

    let lastNumber='000';

    /* ==================== ä½å»¶é²ï¼šæŠ“è™Ÿç¢¼è¨­å®š ==================== */
    const POLL_MS = 1500;   // â† æŠ“è™Ÿç¢¼é »ç‡ï¼ˆ1.5sï¼‰
    const FETCH_TIMEOUT = 1200; // â† å–®æ¬¡è«‹æ±‚æœ€é•· 1.2s

    /* ==================== èªéŸ³æ’­å ±æ ¸å¿ƒï¼ˆå‹•æ…‹æš–æ©Ÿï¼‰ ==================== */
    const TTS_RATE = 0.75;  // èªé€Ÿï¼ˆ0.1~10ï¼‰

    // ä¾ç€è¦½å™¨å¾®èª¿æš–æ©Ÿå»¶é²
    const UA = navigator.userAgent.toLowerCase();
    const isWinChrome = UA.includes('windows') && UA.includes('chrome') && !UA.includes('edg');
    const isAndroidChrome = UA.includes('android') && UA.includes('chrome');
    const isIOS = /iphone|ipad|ipod/.test(UA);

    const WARM_CANCEL_DELAY = isWinChrome ? 220 : 120;
    const WARM_PLAY_DELAY   = isWinChrome ? 100 : 60;
    const WARM_SAFETY_MS    = isWinChrome ? 800 : 650;

    const Voice = { ready:false, unlocked:false, voices:[], zhVoice:null, enabled:false, timer:null };

    function loadVoices(){
      const list = window.speechSynthesis?.getVoices?.() || [];
      Voice.voices = list;
      Voice.zhVoice =
        list.find(v => v.lang?.toLowerCase().startsWith('zh-tw')) ||
        list.find(v => v.lang?.toLowerCase().startsWith('zh-hk')) ||
        list.find(v => v.lang?.toLowerCase().startsWith('zh-cn')) ||
        list.find(v => v.lang?.toLowerCase().startsWith('zh'));
    }
    function unlockTTS(){
      if(!('speechSynthesis' in window)){
        alert('æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³æ’­å ±ï¼Œè«‹æ”¹ç”¨ Chrome / Safari / Edgeã€‚');
        return false;
      }
      loadVoices();
      if(typeof speechSynthesis.onvoiceschanged !== 'undefined'){
        speechSynthesis.onvoiceschanged = () => loadVoices();
      }
      try{ speechSynthesis.resume(); }catch(e){}
      Voice.unlocked = true; Voice.ready = true;
      return true;
    }

    function speakText(txt){
      if(!Voice.ready || !txt) return;
      if (!Voice.enabled && !speakText._oneshot) return;
      if (Voice.timer){ clearTimeout(Voice.timer); Voice.timer = null; }

      const play = () => {
        const warm = new SpeechSynthesisUtterance('\u00A0'); // NBSP æš–æ©Ÿï¼ˆç„¡è²ï¼‰
        warm.lang = (Voice.zhVoice && Voice.zhVoice.lang) || 'zh-TW';
        warm.rate = TTS_RATE; warm.pitch = 1; warm.volume = 0;

        const safety = setTimeout(() => {
          try{ speechSynthesis.cancel(); }catch(e){}
          reallySpeak(txt);
        }, WARM_SAFETY_MS);

        warm.onend = () => {
          clearTimeout(safety);
          setTimeout(() => reallySpeak(txt), WARM_PLAY_DELAY);
        };

        try{ speechSynthesis.resume(); }catch(e){}
        speechSynthesis.speak(warm);
      };

      if (speechSynthesis.speaking || speechSynthesis.pending){
        try{ speechSynthesis.cancel(); }catch(e){}
        Voice.timer = setTimeout(play, WARM_CANCEL_DELAY);
      } else {
        Voice.timer = setTimeout(play, WARM_PLAY_DELAY);
      }
    }

    function reallySpeak(txt){
      // é¿å… Android å¿µ tildeï¼šæŠŠå°¾å·´ ~/ï½ æ”¹æˆå…¨å½¢å¥è™Ÿ
      const safeTail = String(txt).replace(/[~ï½]+$/g,'ã€‚');
      // åœ¨ Windows Chrome å¶ç™¼åé ­æ™‚ï¼šå‰ç¶´å…¨å½¢ç©ºç™½+é€—è™Ÿï¼›iOS/Android å¯çœç•¥
      const prefix = isWinChrome ? '\u3000ï¼Œ' : '';
      const u = new SpeechSynthesisUtterance(prefix + safeTail);
      if(!Voice.zhVoice || !Voice.voices.length) loadVoices();
      if(Voice.zhVoice) u.voice = Voice.zhVoice;
      u.lang = (Voice.zhVoice && Voice.zhVoice.lang) || 'zh-TW';
      u.rate = TTS_RATE;  u.pitch = 1;  u.volume = 1;
      u.onstart = ()=>{ try{ speechSynthesis.resume(); }catch(e){} };
      speechSynthesis.speak(u);
    }

    // é˜¿æ‹‰ä¼¯æ•¸å­— â†’ åœ‹èªå¸¸ç”¨è®€æ³•ï¼ˆ0~999ï¼‰
    function zhRead(n){
      n = Math.max(0, Math.min(999, Math.floor(n)));
      const d = ['é›¶','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','ä¸ƒ','å…«','ä¹'];
      if (n === 0) return 'é›¶';
      let out = '';
      const h = Math.floor(n / 100);
      const t = Math.floor((n % 100) / 10);
      const u = n % 10;
      if (h > 0){
        out += d[h] + 'ç™¾';
        if (t === 0 && u > 0) out += 'é›¶';
      }
      if (t > 0){
        if (t === 1 && h === 0) out += 'å';
        else out += d[t] + 'å';
      }
      if (u > 0){
        out += d[u];
      }
      return out;
    }

    // å«è™Ÿï¼ˆä¸€æ¬¡ç™¼è©±å…§é‡è¤‡å…©æ¬¡ï¼›çµå°¾å…¨å½¢å¥è™Ÿï¼›ä¸å¿µã€Œå°±è¨ºã€ï¼‰
    function speakNumber(n){
      const zh = zhRead(n);
      const phrase = `ç¬¬${zh}è™Ÿã€ç¬¬${zh}è™Ÿè«‹é€²è¨ºé–“ã€‚`;
      speakText(phrase);
    }

    // èªéŸ³é–‹é—œ
    const voiceToggle = document.getElementById('voiceToggle');
    voiceToggle.addEventListener('change', ()=>{
      if(voiceToggle.checked){
        if(!Voice.unlocked && !unlockTTS()){ voiceToggle.checked = false; return; }
        Voice.enabled = true;
        speakText._oneshot = true;
        speakText('èªéŸ³å«è™Ÿå·²é–‹å•Ÿã€‚');
        speakText._oneshot = false;
      }else{
        Voice.enabled = false;
        speechSynthesis.cancel();
      }
    });

    // é‡æ’­æŒ‰éˆ•ï¼šå³ä½¿é–‹é—œé—œé–‰ï¼Œä¹Ÿå…è¨±ã€Œå–®æ¬¡ã€æ’­æ”¾
    document.getElementById('replayBtn').addEventListener('click', ()=>{
      const n = parseInt(lastNumber, 10);
      if (!Number.isFinite(n)) return;
      if (!Voice.unlocked) unlockTTS();
      const prev = Voice.enabled;
      speakText._oneshot = true;
      speakNumber(n);
      speakText._oneshot = false;
      Voice.enabled = prev;
    });

    // è¡Œå‹•è£ç½®å‹å–„è§£é– & è¦–çª—å›å‰æ™¯ resume
    window.addEventListener('touchend', function once(){
      if(!Voice.unlocked){ unlockTTS(); }
      window.removeEventListener('touchend', once, true);
    }, true);
    document.addEventListener('visibilitychange', ()=>{
      if(document.visibilityState === 'visible'){
        try{ speechSynthesis.resume(); }catch(e){}
      }
    });

    /* ==================== ä½å»¶é²ï¼šæŠ“è™Ÿç¢¼æµç¨‹ ==================== */
    const GAS_URL = "https://script.google.com/macros/s/AKfycbxCxob5Ec0N7DqaT8ezOoNHgXjO9vOJ7ooEDUYiTnbKxXX4i9fFxuf-Dqs4PYMpmQJU/exec"; // â† æ›æˆä½ çš„

    async function fetchNumber(){
      const ctrl = new AbortController();
      const t = setTimeout(()=>ctrl.abort(), FETCH_TIMEOUT);
      try{
        // åŠ ä¸Š ts æ‰“ç ´å¿«å–ï¼›no-cache æ¨™é ­é¿å…ä¸­é–“ä»£ç†å¿«å–
        const res = await fetch(`${GAS_URL}?ts=${Date.now()}`, {
          cache:'no-store',
          headers:{ 'pragma':'no-cache', 'cache-control':'no-cache' },
          signal: ctrl.signal
        });
        clearTimeout(t);
        if(!res.ok) throw new Error(res.statusText);
        const data = await res.json();

        renderStatusPill(data);

        const n = Number(data.number);
        if (!Number.isFinite(n) || n < 0 || n >= 1000) return; // é˜²å‘†

        const current = String(n).padStart(3,'0');
        if(current !== lastNumber){
          animateNumber(current);
          showPopup(`è«‹ ${current} è™Ÿå°±è¨º`);
          if (Voice.enabled) speakNumber(n);
          lastNumber = current;
        }
      }catch(err){
        clearTimeout(t);
        // å¿½ç•¥è¶…æ™‚/çŸ­æš«éŒ¯èª¤ï¼Œä¸‹å€‹è¼ªæ¬¡å†æŠ“
        // console.warn('æŠ“è™Ÿç¢¼å»¶é²æˆ–å¤±æ•—ï¼š', err?.message || err);
      }
    }

    function renderStatusPill(data){
      const box = document.getElementById('statusPill');
      box.innerHTML = '';
      if (data.holiday === true){
        const el = document.createElement('div');
        el.className = 'pill red';
        el.textContent = 'ç¾åœ¨æ™‚é–“æ²’æœ‰é–€è¨ºï¼Œä¼‘è¨ºä¸­';
        box.appendChild(el);
      } else if (data.closed === true){
        const el = document.createElement('div');
        el.className = 'pill coral';
        el.textContent = 'ç•¶å‰æ™‚æ®µé–€è¨ºå·²ç¶“åœæ­¢æ›è™Ÿ';
        box.appendChild(el);
      }
    }

    const pad2 = n => String(n).padStart(2,'0');

    function animateNumber(newNumber){
      const digits=document.querySelectorAll('#numberDisplay .digit-card');
      newNumber.split('').forEach((d,i)=>{
        const card=digits[i];
        const cur=card.querySelector('.current');
        const nxt=card.querySelector('.next');
        if(cur.innerText!==d){
          nxt.innerText=d;
          card.classList.add('flip');
          setTimeout(()=>{ cur.innerText=d; card.classList.remove('flip'); },500);
        }
      });
    }

    function updateTWTime(){
      const el=document.getElementById('twTime');
      const now = new Date();
      const tw = new Date(now.toLocaleString('en-US', { timeZone:'Asia/Taipei' }));
      const wMap = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'];
      el.textContent =
        `${tw.getFullYear()}/${pad2(tw.getMonth()+1)}/${pad2(tw.getDate())} (${wMap[tw.getDay()]}) `+
        `${pad2(tw.getHours())}:${pad2(tw.getMinutes())}:${pad2(tw.getSeconds())}`;
    }

    // é–‹å§‹è¼ªè©¢ï¼ˆä½å»¶é²ï¼‰
    fetchNumber();
    setInterval(fetchNumber, POLL_MS);
    updateTWTime();
    setInterval(updateTWTime, 1000);

    function showPopup(msg){
      const container=document.querySelector('.container');
      const logo=document.getElementById('clinicLogo');
      const popup=document.createElement('div');
      popup.className='popup';
      popup.textContent=msg;
      container.appendChild(popup);
      const top = logo.offsetTop + logo.offsetHeight + 8;
      popup.style.top = top + 'px';
      setTimeout(()=>popup.remove(),3000);
    }
  </script>
</body>
</html>
æƒ³å†æ›´å¿«ï¼Ÿ
æŠŠ POLL_MS å†é™åˆ° 1000ï¼ˆ1 ç§’ï¼‰ï¼Œæˆ– 800ï¼ˆ0.8 ç§’ï¼‰ã€‚

å¦‚æœæœ‰æ¬Šé™æ”¹å¾Œç«¯ï¼Œæ”¹ç”¨ Firebase Realtime Database / Firestore onSnapshot æˆ– Server-Sent Events (é•·è¼ªè©¢)ï¼Œå°±èƒ½å³æ™‚æ¨é€ï¼ˆæˆ‘å¯ä»¥å¹«ä½ æŠŠ GAS æ›æˆ Firebaseï¼Œå‰ç«¯æ”¹ 10 è¡Œå°±å³æ™‚äº†ï¼‰ã€‚

ç›®å‰é€™ç‰ˆåœ¨ Android/Windows/iOS éƒ½æœƒå¿«å¾ˆå¤šï¼›è‹¥é‚„è¦ºå¾—æ…¢ï¼Œå›å ±ä½ çš„ GAS å›æ‡‰æ™‚é–“ï¼ˆå¤§æ¦‚å¹¾ç™¾æ¯«ç§’æˆ–å¹¾ç§’ï¼‰ï¼Œæˆ‘å†å¹«ä½ å¾€ç¶²è·¯å±¤å„ªåŒ–ã€‚




æœªé¸æ“‡ä»»ä½•æª”æ¡ˆæœªé¸æ“‡ä»»ä½•æª”æ¡ˆ
ChatGPT å¯èƒ½æœƒå‡ºéŒ¯ã€‚è«‹æŸ¥æ ¸é‡è¦è³‡è¨Šã€‚
