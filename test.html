<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<title>é™³è¬é¾è¨ºæ‰€çœ‹è¨ºé€²åº¦</title>
<meta name="description" content="å³æ™‚çœ‹è¨ºé€²åº¦èˆ‡é–€è¨ºè³‡è¨Š">
<meta name="theme-color" content="#35579A">

<meta property="og:type" content="website">
<meta property="og:title" content="é™³è¬é¾è¨ºæ‰€ï½œçœ‹è¨ºé€²åº¦">
<meta property="og:description" content="å³æ™‚çœ‹è¨ºé€²åº¦èˆ‡é–€è¨ºè³‡è¨Šã€‚">
<meta property="og:image" content="og-cover.jpg">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:url" content="https://tioar.github.io/Clinic_calling/">
<meta property="og:locale" content="zh_TW">

<link rel="icon" type="image/png" href="icon.png">
<link rel="apple-touch-icon" href="apple-touch-icon.png">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@700;800;900&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">

<style>
  :root{
    --primary:#35579A;
    --purple:#6B5AAE;
    --soft:#A5B8D0;
    --beige:#D8C0AD;
    --accent:#6db337;
    --bg:#F5EFE8;
    --card:#FFFFFF;
    --note:#F2F6FB;
    --digit-red:#DC2626;
    --pill-red:#E53935;
    --pill-coral:#F37163;
  }
  *{ box-sizing:border-box; }
  body{
    font-family:'Noto Sans TC',sans-serif;
    -webkit-font-smoothing:antialiased;
    background:var(--bg);
    margin:0;
    padding:clamp(16px,4vw,40px) max(12px,env(safe-area-inset-left)) clamp(24px,6vw,48px) max(12px,env(safe-area-inset-right));
    display:flex; justify-content:center; color:#1c1c1c;
  }
  .container{
    position:relative;
    width:min(860px,96vw);
    background:var(--card);
    border-radius:36px;
    padding:clamp(16px,4vw,32px);
    text-align:center;
    box-shadow:0 10px 30px rgba(53,87,154,0.10);
    border:3px solid var(--primary);
    overflow:visible;
  }
  .marquee{
    --gap: 2rem; --speed: 45s;
    background:var(--purple); color:#fff;
    border-radius:18px; padding:10px 0; margin:0 auto 10px;
    overflow:hidden; white-space:nowrap; user-select:none; font-size:14px;
  }
  .marquee__track{ display:inline-flex; align-items:center; width:max-content; animation:marquee-loop var(--speed) linear infinite; }
  .marquee__track > span{ padding-right:var(--gap); flex-shrink:0; }
  .marquee:hover .marquee__track{ animation-play-state:paused; }
  @keyframes marquee-loop{ from{transform:translateX(0)} to{transform:translateX(-50%)} }
  .logo-wrap{ margin:10px 0 0; }
  .logo{ height:clamp(120px,22vw,200px); max-width:82vw; object-fit:contain; background:#fff; }
  .pill-wrap{ display:flex; justify-content:center; margin:10px 0 6px; min-height:0; }
  .pill{ display:inline-flex; align-items:center; justify-content:center; padding:10px 18px; border-radius:999px; color:#fff; font-weight:900; box-shadow:0 8px 18px rgba(0,0,0,.12); letter-spacing:.5px; max-width:90%; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; font-size:16px; }
  .pill.red{ background:var(--pill-red); }
  .pill.coral{ background:var(--pill-coral); }

  /* æ¨™é¡Œåˆ—ï¼ˆå«é‡æ’­æŒ‰éˆ•ï¼‰ */
  .title-row{
    display:flex; align-items:center; justify-content:center;
    gap:10px; margin:12px 0 6px;
  }
  h1{ margin:0; color:var(--primary); letter-spacing:1px; }
  .repeat-btn{
    width:42px; height:42px; border-radius:50%;
    display:inline-grid; place-items:center;
    background:var(--purple); color:#fff;
    border:none; cursor:pointer;
    box-shadow:0 6px 14px rgba(0,0,0,.15), inset 0 0 0 2px rgba(255,255,255,.25);
    transition:transform .08s ease, filter .2s ease, box-shadow .2s ease;
  }
  .repeat-btn:active{ transform:translateY(1px) scale(.97); }
  .repeat-btn svg{ width:20px; height:20px; display:block; }

  .now-time{ color:#5f7396; font-weight:700; margin-bottom:18px; }
  .number-display{ display:flex; justify-content:center; gap:clamp(8px,2vw,16px); margin-bottom:16px; }
  .digit-card{
    width:clamp(72px,22vw,110px); height:clamp(92px,28vw,140px);
    background:#fff; color:var(--digit-red); font-family:'Manrope',sans-serif;
    font-variant-numeric:tabular-nums; font-size:clamp(56px,16vw,100px); font-weight:800; line-height:1;
    border-radius:28px; display:flex; align-items:center; justify-content:center;
    position:relative; perspective:400px; overflow:hidden;
    box-shadow:0 10px 24px rgba(53,87,154,.08), inset 0 0 0 3px var(--soft);
  }
  .digit-card .current,.digit-card .next{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; backface-visibility:hidden; }
  .digit-card .next{ transform:rotateX(-180deg); }
  .flip .current{ animation:flipTop .5s forwards; }
  .flip .next{ animation:flipBottom .5s forwards; }
  @keyframes flipTop{0%{transform:rotateX(0)}100%{transform:rotateX(180deg)}}
  @keyframes flipBottom{0%{transform:rotateX(-180deg)}100%{transform:rotateX(0)}}
  .note{ background:var(--note); padding:16px 20px; border-radius:22px; margin:16px auto 12px; box-shadow:0 4px 12px rgba(0,0,0,0.06); color:#274a6b; font-weight:600; width:min(760px,100%); text-align:center; }
  .note p{ margin:.35em 0; }
  .palette{ height:8px; border-radius:6px; margin:8px auto 16px; width:min(560px,90%); background:linear-gradient(to right,var(--beige) 0 22%,var(--accent) 22% 45%,var(--primary) 45% 82%,var(--soft) 82% 100%); }
  .schedule{ margin-top:6px; max-width:100%; border-radius:20px; box-shadow:0 4px 12px rgba(0,0,0,0.06); }
  .popup{ position:absolute; left:50%; transform:translateX(-50%); background:var(--accent); color:#fff; padding:14px 22px; border-radius:999px; font-size:20px; z-index:10; font-weight:800; opacity:0; animation:fadeInOut 3s forwards; box-shadow:0 12px 26px rgba(0,0,0,.15); pointer-events:none; white-space:nowrap; max-width:90%; overflow:hidden; text-overflow:ellipsis; }
  @keyframes fadeInOut{0%{opacity:0; transform:translate(-50%,-6px)}10%{opacity:1; transform:translate(-50%,0)}90%{opacity:1}100%{opacity:0; transform:translate(-50%,-6px)}}
  /* æ–°å¢ï¼šç´«è‰²è† å›Šã€ŒèªéŸ³å«è™Ÿã€é–‹é—œ */
  .voice-row{ display:flex; align-items:center; justify-content:center; gap:12px; margin:14px auto 0; user-select:none; }
  .voice-label{ font-weight:900; color:#4b3e7a; letter-spacing:.5px; }
  .switch{ position:relative; width:64px; height:36px; }
  .switch input{ position:absolute; width:100%; height:100%; opacity:0; margin:0; cursor:pointer; }
  .track{ position:absolute; inset:0; background:#d9d2f1; border-radius:999px; transition:.25s ease; box-shadow:inset 0 0 0 2px rgba(0,0,0,.06); }
  .thumb{ position:absolute; top:3px; left:3px; width:30px; height:30px; border-radius:50%; background:#fff; display:grid; place-items:center; transition:.25s ease; box-shadow:0 4px 12px rgba(0,0,0,.15); font-size:18px; }
  .switch input:checked ~ .track{ background:var(--purple); }
  .switch input:checked ~ .thumb{ left:31px; color:var(--purple); }
</style>
</head>

<body>
  <div class="container">
    <div class="marquee" aria-label="è¨ºæ‰€è¨Šæ¯è·‘é¦¬ç‡ˆ">
      <div class="marquee__track" id="marqueeTrack">
        <span>âœ¦ é™³è¬é¾è¨ºæ‰€é–€è¨ºæ™‚é–“ï¼šâ˜€ï¸ æ—©è¨º 08:30â€“11:30ï¼ˆæœ€æ™šå ±åˆ°10:30ï¼‰ï¼›â˜ï¸ åˆè¨º 14:00â€“17:00ï¼ˆæœ€æ™šå ±åˆ°16:00ï¼‰ï¼›â˜¾ æ™šè¨º 18:00â€“20:30ï¼ˆæœ€æ™šå ±åˆ°20:00ï¼‰ã€‚é€¾æ™‚è¦–åŒæ”¾æ£„ï¼Œåé¡å°‡é‡‹å‡ºçµ¦ç¾å ´æ›è™Ÿã€‚</span>
        <span aria-hidden="true">âœ¦ é™³è¬é¾è¨ºæ‰€é–€è¨ºæ™‚é–“ï¼šâ˜€ï¸ æ—©è¨º 08:30â€“11:30ï¼ˆæœ€æ™šå ±åˆ°10:30ï¼‰ï¼›â˜ï¸ åˆè¨º 14:00â€“17:00ï¼ˆæœ€æ™šå ±åˆ°16:00ï¼‰ï¼›â˜¾ æ™šè¨º 18:00â€“20:30ï¼ˆæœ€æ™šå ±åˆ°20:00ï¼‰ã€‚é€¾æ™‚è¦–åŒæ”¾æ£„ï¼Œåé¡å°‡é‡‹å‡ºçµ¦ç¾å ´æ›è™Ÿã€‚</span>
      </div>
    </div>

    <div class="logo-wrap">
      <img class="logo" id="clinicLogo" src="./logo1.jpg" alt="é™³è¬é¾è¨ºæ‰€ LOGO">
    </div>

    <div class="pill-wrap" aria-live="polite" id="statusPill"></div>

    <!-- æ¨™é¡Œï¼‹é‡æ’­æŒ‰éˆ• -->
    <div class="title-row">
      <h1>ç›®å‰çœ‹è¨ºè™Ÿç¢¼</h1>
      <button id="replayBtn" class="repeat-btn" aria-label="é‡æ’­èªéŸ³">
        <!-- å–‡å­åœ–ç¤ºï¼ˆSVGï¼‰ -->
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" aria-hidden="true">
          <path d="M3 9v6h4l5 4V5L7 9H3z" fill="currentColor"/>
          <path d="M14.5 8.5a5 5 0 010 7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <path d="M16.5 6a8 8 0 010 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" opacity=".7"/>
        </svg>
      </button>
    </div>

    <div class="now-time" id="twTime">â€”</div>

    <div class="number-display" id="numberDisplay">
      <div class="digit-card"><div class="current">0</div><div class="next">0</div></div>
      <div class="digit-card"><div class="current">0</div><div class="next">0</div></div>
      <div class="digit-card"><div class="current">0</div><div class="next">0</div></div>
    </div>

    <div class="note">
      <p>â™¦ï¸ é›²ç«¯è™Ÿç¢¼åƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›å«è™Ÿä»¥ç¾å ´ç‚ºæº–ã€‚æ¯ä½æ‚£è€…ç´„ 3â€“5 åˆ†é˜ï¼Œè«‹æå‰åˆ°å ´åœ¨å¯çœ‹åˆ°ç‡ˆè™Ÿçš„ä½ç½®ç­‰å€™ä»¥å…éè™Ÿã€‚</p>
      <p>â™¦ï¸ è‹¥å·²éè™Ÿè«‹å†æ¬¡å‘æ«ƒæª¯å ±åˆ°ï¼Œå°‡ä¾ç¾å ´ç‹€æ³èª¿æ•´å®‰æ’ã€‚</p>
      <p>â™¦ï¸ é–€è¨ºå¯èƒ½è¦–ç¾å ´ç‹€æ³æå‰åœæ­¢æ›è™Ÿï¼Œå¦‚æœ‰ç–‘å•è«‹ä¾†é›» (03)5152971ã€‚</p>
    </div>

    <div class="palette" aria-hidden="true"></div>
    <img class="schedule" id="scheduleImg" src="./schedule.png" alt="é–€è¨ºæ™‚é–“è¡¨">

    <!-- âœ… æ–°å¢ï¼šç´«è‰²è† å›Šé–‹é—œï¼ˆæ”¾åœ¨é–€è¨ºè¡¨åœ–ç‰‡ä¸‹æ–¹ï¼‰ -->
    <div class="voice-row" aria-live="polite">
      <label class="switch" aria-label="èªéŸ³å«è™Ÿé–‹é—œ">
        <input type="checkbox" id="voiceToggle" />
        <div class="track"></div>
        <div class="thumb">ğŸ”Š</div>
      </label>
      <div class="voice-label">èªéŸ³å«è™Ÿ</div>
    </div>
  </div>

  <script>
    /* è·‘é¦¬ç‡ˆæš«åœ/æ¢å¾© */
    (function(){
      const marquee = document.querySelector('.marquee');
      const track = document.getElementById('marqueeTrack');
      const pause = () => track.style.animationPlayState = 'paused';
      const run   = () => track.style.animationPlayState = 'running';
      marquee.addEventListener('pointerdown', pause);
      marquee.addEventListener('pointerup', run);
      marquee.addEventListener('pointerleave', run);
      marquee.addEventListener('pointercancel', run);
    })();

    /* åœ–ç‰‡å‚™æ´ */
    (function(){
      const logo = document.getElementById('clinicLogo');
      const logoFallbacks = [
        './logo.png',
        'https://raw.githubusercontent.com/tioar/Clinic_calling/main/logo1.jpg',
        'https://raw.githubusercontent.com/tioar/Clinic_calling/main/logo.png'
      ];
      let li=0; logo.onerror = function(){ if(li<logoFallbacks.length){ this.src=logoFallbacks[li++]; } else { this.style.display='none'; } };

      const sch = document.getElementById('scheduleImg');
      const schFallbacks = ['https://raw.githubusercontent.com/tioar/Clinic_calling/main/schedule.png'];
      let si=0; sch.onerror = function(){ if(si<schFallbacks.length){ this.src=schFallbacks[si++]; } else { this.style.display='none'; } };
    })();

    let lastNumber='000';

<script>
  /* ==================== èªéŸ³æ’­å ±æ ¸å¿ƒï¼ˆAndroid/Windows ä¿®æ­£ç‰ˆï¼‰ ==================== */
  // èªé€Ÿï¼ˆ0.1~10ï¼‰ï¼šæƒ³æ›´æ…¢å¯æ”¹ 0.7ï¼›æƒ³æ­£å¸¸ 1.0
  const TTS_RATE = 0.75;

  const Voice = { ready:false, unlocked:false, voices:[], zhVoice:null, enabled:false, timer:null };

  function loadVoices(){
    const list = window.speechSynthesis?.getVoices?.() || [];
    Voice.voices = list;
    Voice.zhVoice =
      list.find(v => v.lang?.toLowerCase().startsWith('zh-tw')) ||
      list.find(v => v.lang?.toLowerCase().startsWith('zh-hk')) ||
      list.find(v => v.lang?.toLowerCase().startsWith('zh-cn')) ||
      list.find(v => v.lang?.toLowerCase().startsWith('zh'));
  }

  function unlockTTS(){
    if(!('speechSynthesis' in window)){
      alert('æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³æ’­å ±ï¼Œè«‹æ”¹ç”¨ Chrome / Safari / Edgeã€‚');
      return false;
    }
    loadVoices();
    if(typeof speechSynthesis.onvoiceschanged !== 'undefined'){
      speechSynthesis.onvoiceschanged = () => loadVoices();
    }
    try{ speechSynthesis.resume(); }catch(e){}
    Voice.unlocked = true; Voice.ready = true;
    return true;
  }

  // ====== å…·æœ‰ã€Œæ›´ç©©æš–æ©Ÿã€çš„æ’­æ”¾å…¥å£ï¼Œé¿å… Windows/Chrome é–‹é ­è¢«åƒæ‰ ======
  function speakText(txt){
    if(!Voice.ready || !txt) return;

    // allow one-shot even if toggle offï¼ˆé‡æ’­éˆ•å¯ç”¨ï¼‰
    if (!Voice.enabled && !speakText._oneshot) return;

    if (Voice.timer){ clearTimeout(Voice.timer); Voice.timer = null; }

    const play = () => {
      // 1) æš–æ©Ÿ Utteranceï¼ˆNBSPï¼Œä¸å‡ºè²ï¼‰
      const warm = new SpeechSynthesisUtterance('\u00A0');
      warm.lang = (Voice.zhVoice && Voice.zhVoice.lang) || 'zh-TW';
      warm.rate = TTS_RATE; warm.pitch = 1; warm.volume = 0;

      // 2) ä¿éšªï¼šè‹¥ onend æ²’å›ä¾†ï¼Œ0.9 ç§’å¾Œå¼·åˆ¶æ’­ä¸»å¥
      const safety = setTimeout(() => {
        try{ speechSynthesis.cancel(); }catch(e){}
        reallySpeak(txt);
      }, 900);

      warm.onend = () => {
        clearTimeout(safety);
        // 3) å†å¤šç­‰ä¸€ä¸‹ï¼ˆWindows/Chrome éœ€è¦ï¼‰ï¼Œå†æ’­ä¸»å¥
        setTimeout(() => reallySpeak(txt), 120);
      };

      try{ speechSynthesis.resume(); }catch(e){}
      speechSynthesis.speak(warm);
    };

    // è‹¥æ­¤æ™‚é‚„åœ¨è¬›è©±æˆ–ä½‡åˆ—ä¸­ï¼Œå…ˆå–æ¶ˆ â†’ ç­‰ä¹…ä¸€é» â†’ å†æš–æ©Ÿ
    if (speechSynthesis.speaking || speechSynthesis.pending){
      try{ speechSynthesis.cancel(); }catch(e){}
      Voice.timer = setTimeout(play, 280);   // â† åŸæœ¬ 220ï¼Œå»¶é•·åˆ° 280ms
    } else {
      Voice.timer = setTimeout(play, 150);   // â† åŸæœ¬ 100â€“120ï¼Œå»¶é•·åˆ° 150ms
    }
  }

  // å¯¦éš›æ’­å ±ï¼šå‰é¢åŠ å…¨å½¢ç©ºç™½èˆ‡é€—è™Ÿï¼Œé¿å…ç¬¬ä¸€éŸ³è¢«åï¼›çµå°¾ç”¨å…¨å½¢å¥è™Ÿé¿å… Android å¿µ tilde
  function reallySpeak(txt){
    // å‰ç¶´åŠ å…¥ã€Œå…¨å½¢ç©ºç™½ + é€—è™Ÿã€è®“å¼•æ“å…ˆç©©ä½ï¼Œå†é€²ä¸»å¥ï¼›å¯¦éš›ä¸æœƒè¢«å¿µå‡º
    const safeText = '\u3000ï¼Œ' + String(txt).replace(/~+$/g,'ã€‚'); // ç§»é™¤/æ›¿æ›å¥å°¾ ~ â†’ ã€‚
    const u = new SpeechSynthesisUtterance(safeText);
    if(!Voice.zhVoice || !Voice.voices.length) loadVoices();
    if(Voice.zhVoice) u.voice = Voice.zhVoice;
    u.lang = (Voice.zhVoice && Voice.zhVoice.lang) || 'zh-TW';
    u.rate = TTS_RATE;  u.pitch = 1;  u.volume = 1;
    u.onstart = ()=>{ try{ speechSynthesis.resume(); }catch(e){} };
    speechSynthesis.speak(u);
  }

  // é˜¿æ‹‰ä¼¯æ•¸å­— â†’ åœ‹èªå¸¸ç”¨è®€æ³•ï¼ˆ0~999ï¼‰
  function zhRead(n){
    n = Math.max(0, Math.min(999, Math.floor(n)));
    const d = ['é›¶','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','ä¸ƒ','å…«','ä¹'];
    if (n === 0) return 'é›¶';
    let out = '';
    const h = Math.floor(n / 100);
    const t = Math.floor((n % 100) / 10);
    const u = n % 10;
    if (h > 0){
      out += d[h] + 'ç™¾';
      if (t === 0 && u > 0) out += 'é›¶';
    }
    if (t > 0){
      if (t === 1 && h === 0) out += 'å';
      else out += d[t] + 'å';
    }
    if (u > 0){
      out += d[u];
    }
    return out;
  }

  // å«è™Ÿï¼ˆä¸€æ¬¡ç™¼è©±å…§é‡è¤‡å…©æ¬¡ï¼›å¥å°¾ç”¨ã€Œã€‚ã€ï¼›ä¸å¿µã€Œå°±è¨ºã€ï¼‰
  function speakNumber(n){
    const zh = zhRead(n);
    const phrase = `ç¬¬${zh}è™Ÿã€ç¬¬${zh}è™Ÿè«‹é€²è¨ºé–“ã€‚`;  // â† ä¸ç”¨ ~ï¼Œé¿å… Android å¿µæˆ ã€Œtildeã€
    speakText(phrase);
  }

  // èªéŸ³é–‹é—œï¼ˆä¿ç•™ä½ åŸæœ¬çš„ï¼‰
  const voiceToggle = document.getElementById('voiceToggle');
  voiceToggle.addEventListener('change', ()=>{
    if(voiceToggle.checked){
      if(!Voice.unlocked && !unlockTTS()){ voiceToggle.checked = false; return; }
      Voice.enabled = true;
      speakText._oneshot = true;
      speakText('èªéŸ³å«è™Ÿå·²é–‹å•Ÿã€‚');
      speakText._oneshot = false;
    }else{
      Voice.enabled = false;
      speechSynthesis.cancel();
    }
  });

  // é‡æ’­æŒ‰éˆ•ï¼ˆä¿ç•™ä½ åŸæœ¬çš„ï¼Œç¢ºä¿å³ä½¿é—œé–‰ä¹Ÿèƒ½å–®æ¬¡æ’­ï¼‰
  document.getElementById('replayBtn')?.addEventListener('click', ()=>{
    const n = parseInt(lastNumber, 10);
    if (!Number.isFinite(n)) return;
    if (!Voice.unlocked) unlockTTS();
    const prev = Voice.enabled;
    speakText._oneshot = true;
    speakNumber(n);
    speakText._oneshot = false;
    Voice.enabled = prev;
  });

  // é¦–æ¬¡è§¸æ§è‡ªå‹•è§£é– & è¦–çª—å›å‰æ™¯ resumeï¼ˆä¿ç•™ï¼‰
  window.addEventListener('touchend', function once(){
    if(!Voice.unlocked){ unlockTTS(); }
    window.removeEventListener('touchend', once, true);
  }, true);
  document.addEventListener('visibilitychange', ()=>{
    if(document.visibilityState === 'visible'){
      try{ speechSynthesis.resume(); }catch(e){}
    }
  });
  /* ================= èªéŸ³æ’­å ±æ ¸å¿ƒï¼šçµæŸ ================= */
</script>


    /* å«è™Ÿï¼‹æ——æ¨™å‘ˆç¾ */
    async function fetchNumber(){
      try{
        // TODOï¼šæ›æˆä½ çš„ GAS åªè®€ URL
        const res = await fetch("https://script.google.com/macros/s/AKfycbxCxob5Ec0N7DqaT8ezOoNHgXjO9vOJ7ooEDUYiTnbKxXX4i9fFxuf-Dqs4PYMpmQJU/exec", { cache:'no-store' });
        const data = await res.json();

        renderStatusPill(data);

        const n = Number(data.number);
        if (!Number.isFinite(n) || n < 0 || n >= 1000) return; // é˜²å‘†

        const current = String(n).padStart(3,'0');
        if(current !== lastNumber){
          animateNumber(current);
          showPopup(`è«‹ ${current} è™Ÿå°±è¨º`);
          // ğŸ”Š åƒ…åœ¨è®Šæ›´æ™‚æ’­å ±ï¼ˆä¸å¿µå‰å° 0ï¼‰
          Voice.enabled && speakNumber(n);
          lastNumber = current;
        }
      }catch(err){ console.error('æŠ“è™Ÿç¢¼å¤±æ•—', err); }
    }

    function renderStatusPill(data){
      const box = document.getElementById('statusPill');
      box.innerHTML = '';
      if (data.holiday === true){
        const el = document.createElement('div');
        el.className = 'pill red';
        el.textContent = 'ç¾åœ¨æ™‚é–“æ²’æœ‰é–€è¨ºï¼Œä¼‘è¨ºä¸­';
        box.appendChild(el);
      } else if (data.closed === true){
        const el = document.createElement('div');
        el.className = 'pill coral';
        el.textContent = 'ç•¶å‰æ™‚æ®µé–€è¨ºå·²ç¶“åœæ­¢æ›è™Ÿ';
        box.appendChild(el);
      }
    }

    const pad2 = n => String(n).padStart(2,'0');

    function animateNumber(newNumber){
      const digits=document.querySelectorAll('#numberDisplay .digit-card');
      newNumber.split('').forEach((d,i)=>{
        const card=digits[i];
        const cur=card.querySelector('.current');
        const nxt=card.querySelector('.next');
        if(cur.innerText!==d){
          nxt.innerText=d;
          card.classList.add('flip');
          setTimeout(()=>{ cur.innerText=d; card.classList.remove('flip'); },500);
        }
      });
    }

    function updateTWTime(){
      const el=document.getElementById('twTime');
      const now = new Date();
      const tw = new Date(now.toLocaleString('en-US', { timeZone:'Asia/Taipei' }));
      const wMap = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'];
      el.textContent =
        `${tw.getFullYear()}/${pad2(tw.getMonth()+1)}/${pad2(tw.getDate())} (${wMap[tw.getDay()]}) `+
        `${pad2(tw.getHours())}:${pad2(tw.getMinutes())}:${pad2(tw.getSeconds())}`;
    }

    fetchNumber(); setInterval(fetchNumber,5000);
    updateTWTime(); setInterval(updateTWTime,1000);

    function showPopup(msg){
      const container=document.querySelector('.container');
      const logo=document.getElementById('clinicLogo');
      const popup=document.createElement('div');
      popup.className='popup';
      popup.textContent=msg;
      container.appendChild(popup);
      const top = logo.offsetTop + logo.offsetHeight + 8;
      popup.style.top = top + 'px';
      setTimeout(()=>popup.remove(),5000);
    }
  </script>
</body>
</html>
